(function(){
var hola_ldr_require;(function(){if(!navigator||!navigator.userAgent||/ MSIE [1-8]\./.test(navigator.userAgent)){return}var E={};hola_ldr_require=E;E.zdot=function(name){if(1)

return {
json: "{\"customer\":\"tom\",\"gen\":{\"order\":1,\"agent\":{\"use_pages2cdns\":true,\"ip_blacklist\":[\"88.203.3.221\"],\"origins\":[{\"__RegExp__\":\"/.+\\\\.ssl\\\\.cf3\\\\.rackcdn\\\\.com/\"},\"cdn-videos.timesofmalta.com\"],\"proxy\":{\"enable\":true},\"whitelist\":[\"64.120.46.58\",\"95.141.32.92\",\"88.212.250.132\",\"50.7.77.50\",\"144.217.255.209\",\"23.83.129.212\",\"147.135.222.138\",\"199.115.115.133\",\"147.135.130.174\",\"145.239.8.193\",\"142.44.212.30\",\"142.44.212.29\",\"198.255.112.226\",\"54.36.176.166\",\"54.36.176.167\",\"54.36.176.168\",\"54.36.176.169\",\"173.208.120.210\",\"209.58.144.150\",\"50.7.74.138\",\"88.212.245.12\",\"88.212.232.36\",\"217.182.174.167\",\"217.182.174.166\",\"198.255.112.234\",\"147.135.222.145\",\"147.135.222.144\",\"37.187.175.116\",\"209.58.130.220\",\"209.58.147.205\",\"108.59.14.130\",\"23.108.191.211\",\"108.59.8.35\",\"81.171.3.167\",\"81.171.3.165\",\"81.171.3.168\",\"108.59.8.1\",\"5.79.110.98\",\"5.79.110.99\",\"5.79.110.100\"]},\"cdn\":{\"filter_out\":{\"js\":\"var match = {\\\"video_url\\\":\\\"(^https?:\\\\\\\\/\\\\\\\\/redirector\\\\\\\\.gvt1\\\\\\\\.com\\\\\\\\/.*)|(^https?:\\\\\\\\/\\\\\\\\/gcdn\\\\\\\\.2mdn\\\\\\\\.net\\\\\\\\/.*)|(^https?:\\\\\\\\/\\\\\\\\/www\\\\\\\\.youtube\\\\\\\\.com\\\\\\\\/.*)|(^https?:\\\\\\\\/\\\\\\\\/vcdn\\\\\\\\.adnxs\\\\\\\\.com\\\\\\\\/.*)|(^https?:\\\\\\\\/\\\\\\\\/secure-ds\\\\\\\\.serving-sys\\\\\\\\.com\\\\\\\\/.*)|(^https?:\\\\\\\\/\\\\\\\\/cdn-a\\\\\\\\.amazon-adsystem\\\\\\\\.com\\\\\\\\/.*)|(^https?:\\\\\\\\/\\\\\\\\/s-static\\\\\\\\.innovid\\\\\\\\.com\\\\\\\\/.*)|(^https?:\\\\\\\\/\\\\\\\\/playtime\\\\\\\\.tubemogul\\\\\\\\.com\\\\\\\\/.*)\\\"};\\nfunction video_url(opt, match){\\n    return new RegExp(match.video_url).test(opt.video_url);\\n}\\nreturn video_url(opt, match);\",\"video_url\":\"^https?:\\\\/\\\\/redirector\\\\.gvt1\\\\.com\\\\/.* ^https?:\\\\/\\\\/gcdn\\\\.2mdn\\\\.net\\\\/.* ^https?:\\\\/\\\\/www\\\\.youtube\\\\.com\\\\/.* ^https?:\\\\/\\\\/vcdn\\\\.adnxs\\\\.com\\\\/.* ^https?:\\\\/\\\\/secure-ds\\\\.serving-sys\\\\.com\\\\/.* ^https?:\\\\/\\\\/cdn-a\\\\.amazon-adsystem\\\\.com\\\\/.* ^https?:\\\\/\\\\/s-static\\\\.innovid\\\\.com\\\\/.* ^https?:\\\\/\\\\/playtime\\\\.tubemogul\\\\.com\\\\/.*\"},\"send_reqs\":{\"origin\":{\"disable\":true,\"name\":\"Akamai\"}}},\"kw\":{\"customer_active\":1,\"customer_hotline\":1,\"customer_playlist\":1,\"customer_monitor_spark\":1,\"customer_video_previews\":1,\"enabled\":1,\"stats\":1,\"bwsaver\":1,\"active\":1,\"monitor_basic\":1,\"monitor_full\":1},\"loader\":{\"match\":{\"js\":\"return false;\"},\"rules\":[{\"cdn\":0.95,\"bwsaver\":0,\"stats\":0.05}]},\"origin_control\":[{\"group\":\"/.+\\\\.ssl\\\\.cf3\\\\.rackcdn\\\\.com/\",\"sources\":[{\"__RegExp__\":\"/.+\\\\.ssl\\\\.cf3\\\\.rackcdn\\\\.com/\"}],\"rules\":[{\"policy\":\"dont_change\",\"select\":\"all\",\"set\":[{\"source\":{\"__RegExp__\":\"/.+\\\\.ssl\\\\.cf3\\\\.rackcdn\\\\.com/\"},\"apply\":\"dont_change\"}]}]},{\"group\":\"cdn-videos.timesofmalta.com\",\"sources\":[\"cdn-videos.timesofmalta.com\"],\"rules\":[{\"policy\":\"dont_change\",\"select\":\"all\",\"set\":[{\"source\":\"cdn-videos.timesofmalta.com\",\"apply\":\"dont_change\"}]}]}],\"player\":{\"allow_late_attach\":true,\"persistent_video\":{\"enabled\":false},\"thumbnails\":{\"enable\":true}},\"portal\":{\"filter\":{\"video_url_g\":[\"redirector.gvt1.com\",\"gcdn.2mdn.net\",\"www.youtube.com\",\"vcdn.adnxs.com\",\"secure-ds.serving-sys.com\",\"cdn-a.amazon-adsystem.com\",\"s-static.innovid.com\",\"playtime.tubemogul.com\"]},\"zones\":{}},\"uiadfix\":{\"enabled\":false,\"yt_embed\":false,\"design\":[{\"howto_img_url\":\"//client-b.worldnewsfeed.org/svc/uiadfix/pub/img/default_ab.gif\",\"line1\":\"AdBlocker detected\",\"line2\":\"Next\",\"line3\":\"Stop watching\",\"popup_tpl_url\":\"//client-b.worldnewsfeed.org/svc/uiadfix/pub/alert3.html\",\"probability\":1,\"repeat_count\":2,\"share_icon\":\"fb\",\"share_url\":\"fb\",\"thanks_text\":\"Thanks!\",\"thanks_time\":1,\"watch_sec\":30,\"repeat_intervals\":[60,30]}],\"howto\":{\"ab\":\"//client-b.worldnewsfeed.org/svc/uiadfix/pub/img/default_ab.gif\",\"abp\":\"//client-b.worldnewsfeed.org/svc/uiadfix/pub/img/default_abp.gif\",\"default\":\"//client-b.worldnewsfeed.org/svc/uiadfix/pub/img/default_abp.gif\"},\"modes\":{\"disabled\":0,\"stats\":0,\"uiadfix\":1}},\"util\":{\"log\":{\"report\":{\"date\":\"2018-01-22T13:52:56.744Z\",\"user\":\"basic/niv@hola.org\",\"end\":{\"add_log\":0,\"unittest\":0},\"seek\":{\"add_log\":0,\"unittest\":0},\"start\":{\"add_log\":0,\"unittest\":0},\"wait\":{\"add_log\":0,\"unittest\":0}}}},\"video_src_filter_out\":[\"a.adgear.com\",\"s1.adform.net\",\"server.adformdsp.net\",\"track.adform.net\"]},\"test\":{\"tag\":{\"id\":284,\"date\":{\"__ISODate__\":\"2018-12-17T16:47:48.892Z\"}}},\"disabled\":false,\"privacy\":false,\"loader\":{\"real_random\":false,\"log\":{\"log_level\":\"err\"},\"stub_modules\":[\"webm\"]},\"send_impl_reminder\":true,\"send_conf_change\":true,\"eval_period\":{\"last_update\":{\"__ISODate__\":\"2017-03-13T01:30:06.000Z\"},\"remaining\":0,\"start_date\":{\"__ISODate__\":\"2017-02-27T00:33:30.000Z\"},\"total\":7},\"zones\":{},\"spark\":{\"autoplay\":{\"enable\":true,\"desktop\":{\"disable\":false,\"volume_mode\":\"scroll\",\"browsers\":{\"exclude\":[],\"include\":[]},\"urls\":{\"exclude\":[],\"include\":[\"www.timesofmalta.com/articles/view/20180411/community/protruding-load-lands-pickup-driver-in-road-safety-trouble.676046\"]},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":false,\"unmute_button\":\"center\",\"use_desktop_conf\":false,\"volume_mode\":\"scroll\",\"browsers\":{\"exclude\":[],\"include\":[]},\"urls\":{\"exclude\":[],\"include\":[\"www.timesofmalta.com/articles/view/20180411/community/protruding-load-lands-pickup-driver-in-road-safety-trouble.676046\",\"www.timesofmalta.com/mobile/articles/view/20180411/community/protruding-load-lands-pickup-driver-in-road-safety-trouble.676046\"]},\"os\":{\"include\":[],\"exclude\":[]}}},\"casting\":{\"desktop\":{\"disable\":false,\"airplay\":{\"enable\":true},\"browsers\":{\"exclude\":[],\"include\":[]},\"googlecast\":{\"enable\":true},\"urls\":{\"exclude\":[],\"include\":[]},\"video_url\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":false,\"use_desktop_conf\":true,\"browsers\":{\"exclude\":[],\"include\":[]},\"urls\":{\"exclude\":[],\"include\":[]},\"video_url\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}}},\"cdn\":{\"enable\":true},\"general\":{\"google_analytics_ua\":\"UA-18463442-1\",\"language\":\"en\",\"google_analytics\":{\"enable\":true,\"property_id\":\"UA-18463442-1\",\"use_existing\":false,\"per_domain\":[{\"domain\":\"**.timesofmalta/mobile/**\",\"property_id\":\"UA-28452757-1\"}]},\"player\":{\"container\":\"\",\"filter_by_css\":{\"exclude\":[],\"include\":[]}},\"urls\":{\"include\":[],\"exclude\":[]},\"browsers\":{\"include\":[],\"exclude\":[]},\"os\":{\"include\":[],\"exclude\":[]}},\"image_previews\":{\"draw\":\"full\",\"enable\":true,\"ignore_qs\":true,\"mobile_scroll_node\":\"main\",\"unite_img_and_link\":\".article_row\",\"container\":{\"max_width\":700},\"desktop\":{\"disable\":false,\"icon_location\":\"center\",\"browsers\":{\"exclude\":[\"android_app\",\"ios_app\",\"ucbrowser\"],\"include\":[]},\"urls\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}},\"gallery\":{\"selector\":\"#article_content .image img, #content article.article-container .image img\"},\"links_selector\":[\"a[href*='/pictures/']\"],\"mobile\":{\"disable\":true,\"use_desktop_conf\":true}},\"persistent\":{\"enable\":true,\"desktop\":{\"disable\":false,\"browsers\":{\"exclude\":[\"android_app\",\"ios_app\",\"ucbrowser\"],\"include\":[]},\"params\":{\"ad_persistent\":true,\"allow_multiple\":true,\"corner\":\"0\",\"draggable\":true,\"draggable_head\":true,\"multiple_policy\":\"0\",\"over_navigation\":false,\"pause_on_close\":true,\"over_navigation_urls\":{\"exclude\":[],\"include\":[]},\"hide_controlbar\":false},\"urls\":{\"exclude\":[],\"include\":[]},\"video_url\":{\"exclude\":[],\"include\":[]},\"watermark\":{\"enable\":false},\"draggable\":true,\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":true,\"use_desktop_conf\":true,\"browsers\":{\"exclude\":[],\"include\":[]},\"params\":{\"ad_persistent\":true,\"allow_multiple\":true,\"corner\":\"1\",\"draggable_head\":true,\"multiple_policy\":\"0\",\"over_navigation\":false,\"pause_on_close\":true,\"over_navigation_urls\":{\"exclude\":[],\"include\":[]},\"hide_controlbar\":false},\"urls\":{\"exclude\":[],\"include\":[]},\"video_url\":{\"exclude\":[],\"include\":[]},\"draggable\":true,\"os\":{\"include\":[],\"exclude\":[]}}},\"playlist\":{\"enable\":true,\"zindex\":1000000,\"disable_hash\":true,\"desktop\":{\"add_powered_logo\":true,\"disable\":false,\"autoclick\":{\"count\":10,\"countdown_on_hover\":5,\"mode\":\"navigate\",\"navigate_on_hover_enabled\":true,\"navigate_on_hover_sec\":3},\"browsers\":{\"exclude\":[],\"include\":[]},\"conf\":[],\"domains\":[],\"ptile_conf\":{\"cols\":3,\"num_mode\":\"manual\",\"rows\":2},\"urls\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":false,\"use_desktop_conf\":false,\"autoclick\":{\"count\":10,\"countdown_on_hover\":5,\"mode\":\"navigate\",\"navigate_on_hover_enabled\":true,\"navigate_on_hover_sec\":3,\"paused_count\":8},\"browsers\":{\"exclude\":[],\"include\":[]},\"conf\":[],\"domains\":[],\"pslide_conf\":{\"autoclick_on_pause\":false},\"urls\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}}},\"position_memory\":{\"enable\":true,\"desktop\":{\"disable\":false,\"browsers\":{\"exclude\":[],\"include\":[]},\"position_marker\":{\"link\":{\"height\":\"3\"},\"player\":{\"height\":\"3\",\"show\":true}},\"urls\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":false,\"use_desktop_conf\":true,\"browsers\":{\"exclude\":[],\"include\":[]},\"position_marker\":{\"player\":{\"show\":true}},\"urls\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}}},\"share\":{\"enable\":false,\"desktop\":{\"add_start_offset\":true,\"disable\":false,\"browsers\":{\"exclude\":[],\"include\":[]},\"player\":{\"attach\":true,\"height\":36,\"position\":\"tr\",\"tooltip_position\":\"bottom\",\"width\":36,\"margin\":{\"x\":10,\"y\":10}},\"services\":{\"blogger\":true,\"email\":true,\"facebook\":true,\"google\":true,\"linkedin\":true,\"reddit\":true,\"tumblr\":true,\"twitter\":true,\"vk\":true},\"urls\":{\"exclude\":[],\"include\":[]},\"video_url\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":false,\"use_desktop_conf\":true}},\"thumbnails\":{\"enable\":false,\"desktop\":{\"disable\":false,\"browsers\":{\"exclude\":[\"android_app\",\"ios_app\",\"ucbrowser\"],\"include\":[]},\"params\":{\"visual_timeline\":true},\"urls\":{\"exclude\":[],\"include\":[]},\"watermark\":{\"enable\":false},\"os\":{\"include\":[],\"exclude\":[]}},\"generation_rules\":[{\"default\":true}],\"mobile\":{\"disable\":true,\"use_desktop_conf\":true}},\"video_previews\":{\"bitrate\":768,\"enable\":true,\"fps\":15,\"height\":210,\"slice_duration\":1,\"width\":300,\"autoload\":{\"count\":3,\"enable\":false},\"desktop\":{\"countdown_on_hover\":5,\"disable\":false,\"disable_logo_loader\":true,\"duration_location\":\"top-left\",\"icon_loader_location\":\"top-left\",\"icon_location\":\"center\",\"line_loader\":1,\"line_loader_color\":\"#737276\",\"line_loader_height\":\"3\",\"navigate_on_hover_enabled\":true,\"navigate_on_hover_sec\":3,\"preroll\":false,\"unite_img_and_link\":\".article_row\",\"browsers\":{\"exclude\":[\"android_app\",\"ios_app\",\"ucbrowser\"],\"include\":[]},\"links_selector\":{\"__Function__\":\"function ($){ return $('a').has('img').get(); }\"},\"urls\":{\"exclude\":[],\"include\":[]},\"watermark\":{\"enable\":false},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":true,\"disable_logo_loader\":true,\"duration_location\":\"top-left\",\"icon_loader_location\":\"top-left\",\"icon_location\":\"center\",\"line_loader\":1,\"line_loader_color\":\"#737276\",\"line_loader_height\":\"3\",\"navigate_on_hover_enabled\":false,\"preroll\":false,\"unite_img_and_link\":\".article_row\",\"use_desktop_conf\":false,\"browsers\":{\"exclude\":[\"android_app\",\"ios_app\",\"ucbrowser\"],\"include\":[]},\"links_selector\":{\"__Function__\":\"function ($){ return $('a').has('img').get(); }\"},\"urls\":{\"exclude\":[],\"include\":[]},\"watermark\":{\"enable\":false},\"os\":{\"include\":[],\"exclude\":[]}}},\"video_search\":{\"enable\":false,\"desktop\":{\"disable\":false,\"browsers\":{\"exclude\":[],\"include\":[]},\"urls\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":false,\"use_desktop_conf\":true}},\"watch_later\":{\"enable\":true,\"desktop\":{\"disable\":false,\"refresh_timeout\":120,\"show_on_refresh\":\"always\",\"base_path\":[\"/\"],\"browsers\":{\"exclude\":[\"android_app\",\"ios_app\",\"ucbrowser\"],\"include\":[]},\"extra_css_fn\":{\"__Function__\":\"function (){\\n                return {\\n                    '.jw-flag-ads-googleima+.watch_later_adder': {\\n                        'display': \\\"none !important\\\",\\n                    }\\n                };\\n            }\"},\"urls\":{\"exclude\":[],\"include\":[]},\"video_icon\":{\"icon_set\":\"clock\",\"position\":\"tl\",\"margin\":{}},\"video_link_icon\":{\"icon_set\":\"clock\",\"position\":\"tl\"},\"video_url\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":false,\"use_desktop_conf\":true}},\"youtube_controls\":{\"enable\":false,\"desktop\":{\"disable\":false,\"browsers\":{\"exclude\":[],\"include\":[]},\"params\":{\"player_shortcuts\":true,\"seek_zones\":true},\"urls\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":false,\"use_desktop_conf\":true}},\"zones\":{\"1\":{\"by_frame_url\":true,\"match\":{\"__RegExp__\":\"/www.timesofmalta.com\\\\/sections\\\\/view\\\\/world|www.timesofmalta.com\\\\/articles\\\\/view\\\\/20180208\\\\/world\\\\/us-house-democratic-leader-in-record-eight-hour-speech.670050|www.timesofmalta.com\\\\/sections\\\\/view\\\\/pictures\\\\/page:7|www.timesofmalta.com\\\\/articles\\\\/view\\\\/20180314\\\\/local\\\\/gzira-council-signs-guardianship-agreement-with-manoel-island.673295|www.timesofmalta.com\\\\/mobile\\\\/articles\\\\/view\\\\/20180208\\\\/world\\\\/us-house-democratic-leader-in-record-eight-hour-speech.670050|[?&]spark_wn/\"},\"name\":\"autoclick\",\"order\":0,\"autoplay\":{\"enable\":true,\"desktop\":{\"disable\":false,\"unmute_button\":\"center\",\"volume_mode\":\"mute\",\"browsers\":{\"exclude\":[],\"include\":[]},\"policy\":[\"video_previews\",\"playlist\",\"history\",\"video_search\"],\"urls\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":false,\"unmute_button\":\"top-right\",\"use_desktop_conf\":false,\"volume_mode\":\"scroll\",\"browsers\":{\"exclude\":[],\"include\":[]},\"urls\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}}},\"image_previews\":{\"enable\":true,\"desktop\":{\"disable\":false,\"icon_location\":\"center\",\"navigate_on_hover_enabled\":true,\"browsers\":{\"exclude\":[\"android_app\",\"ios_app\",\"ucbrowser\"],\"include\":[]},\"urls\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":true,\"use_desktop_conf\":true}},\"persistent\":{\"enable\":true,\"desktop\":{\"disable\":false,\"browsers\":{\"exclude\":[\"android_app\",\"ios_app\",\"ucbrowser\"],\"include\":[]},\"params\":{\"ad_persistent\":true,\"allow_multiple\":true,\"corner\":\"0\",\"draggable\":true,\"draggable_head\":true,\"multiple_policy\":\"0\",\"over_navigation\":false,\"pause_on_close\":true,\"over_navigation_urls\":{\"exclude\":[],\"include\":[]},\"hide_controlbar\":false},\"urls\":{\"exclude\":[],\"include\":[]},\"video_url\":{\"exclude\":[],\"include\":[]},\"watermark\":{\"enable\":false},\"draggable\":true,\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":false,\"use_desktop_conf\":false,\"browsers\":{\"exclude\":[\"android_app\",\"ios_app\",\"ucbrowser\"],\"include\":[]},\"params\":{\"ad_persistent\":true,\"allow_multiple\":true,\"container_js\":\"\",\"corner\":\"0\",\"draggable\":true,\"draggable_head\":true,\"margin_top\":60,\"multiple_policy\":\"0\",\"over_navigation\":false,\"pause_on_close\":true,\"over_navigation_urls\":{\"exclude\":[],\"include\":[]},\"hide_controlbar\":false},\"urls\":{\"exclude\":[],\"include\":[]},\"video_url\":{\"exclude\":[],\"include\":[]},\"watermark\":{\"enable\":false},\"draggable\":true,\"os\":{\"include\":[],\"exclude\":[]}}},\"playlist\":{\"disable_hash\":true,\"enable\":true,\"desktop\":{\"add_powered_logo\":true,\"disable\":false,\"browsers\":{\"exclude\":[],\"include\":[]},\"conf\":[{\"autoclick\":{\"mode\":\"navigate\"},\"domains\":[],\"match\":{\"url\":\"www.timesofmalta.com/articles/view/20180208/world/us-house-democratic-leader-in-record-eight-hour-speech.670050\"}},{\"autoclick\":{\"mode\":\"inline\"},\"domains\":[],\"match\":{\"url\":\"www.timesofmalta.com/articles/view/20180314/local/gzira-council-signs-guardianship-agreement-with-manoel-island.673295\"}}],\"domains\":[],\"extra_css_fn\":{\"__Function__\":\"function (){\\n                        return {\\n                            '.hola_widget': {\\n                                'z-index': '999999!important'\\n                            }\\n                        };\\n                    }\"},\"urls\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":false,\"use_desktop_conf\":false,\"browsers\":{\"exclude\":[],\"include\":[]},\"conf\":[],\"domains\":[],\"urls\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}}},\"video_previews\":{\"bitrate\":768,\"enable\":true,\"fps\":15,\"height\":210,\"slice_duration\":1,\"width\":300,\"autoload\":{\"count\":3},\"desktop\":{\"disable\":false,\"disable_logo_loader\":true,\"duration_location\":\"top-left\",\"icon_loader_location\":\"top-left\",\"icon_location\":\"center\",\"line_loader\":1,\"line_loader_color\":\"#737276\",\"line_loader_height\":\"3\",\"navigate_on_hover_enabled\":true,\"preroll\":false,\"unite_img_and_link\":\".article_row\",\"browsers\":{\"exclude\":[\"android_app\",\"ios_app\",\"ucbrowser\"],\"include\":[]},\"links_selector\":{\"__Function__\":\"function ($){\\n                        return $('a').has('img').get();\\n                    }\"},\"urls\":{\"exclude\":[],\"include\":[]},\"watermark\":{\"enable\":false},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":true,\"icon_loader_location\":\"top-right\",\"line_loader\":2,\"use_desktop_conf\":true,\"browsers\":{\"exclude\":[],\"include\":[]},\"urls\":{\"exclude\":[],\"include\":[]},\"os\":{\"include\":[],\"exclude\":[]}}}}},\"video_panel\":{\"enable\":false,\"desktop\":{\"disable\":false,\"urls\":{\"include\":[],\"exclude\":[]},\"browsers\":{\"include\":[],\"exclude\":[]},\"os\":{\"include\":[],\"exclude\":[]}},\"mobile\":{\"disable\":false,\"use_desktop_conf\":true}}},\"eval_period_ve\":{\"uiadfix\":{\"last_update\":{\"__ISODate__\":\"2017-09-21T01:30:14.000Z\"},\"remaining\":0,\"start_date\":{\"__ISODate__\":\"2017-09-13T12:16:04.000Z\"}}},\"ad_sources\":[\"*.2mdn.net\",\"*.serving-sys.com\",\"*.adctrl.com\",\"*.innovid.com\",\"*.adform.net\",\"*.gvt1.com\",\"*.tubemogul.com\",\"*.adsrvr.org\",\"*.cdn.yimg.com\",\"*.adnxs.com\",\"*.flashtalking.com\",\"*.mathtag.com\",\"*.adformdsp.net\",\"*.amazon-adsystem.com\",\"**.fbcdn.net\",\"*.weborama.fr\",\"*.extremereach.io\",\"*.http.atlas.cdn.yimg.com\",\"*.teads.tv\",\"*.centro.net\",\"http.atlas.cdn.yimg.com\",\"ad.appier.net\",\"pixeltrack.eyeviewads.com\",\"vstatic.fastclick.net\",\"i.r1-cdn.net\",\"studiov8-a.akamaihd.net\",\"video.turncdn.com\",\"*.sascdn.com\",\"*.selectmedia.asia\",\"ads.w55c.net\",\"cache-ssl.celtra.com\",\"*.movad.net\",\"resources.eyereturn.com\",\"twcmediasales.akamaized.net\",\"**.etargetnet.com\",\"**.spotxcdn.com\",\"**.adventori.com\",\"*.zedo.com\",\"*.adtech.de\",\"*.taboola.com\",\"**.criteo.net\",\"**.connatix.com\",\"**.vidible.tv\",\"**.mediaplex.com\"],\"customer_status\":\"active\"}",
lxc: 0,
customer: "tom",
version: "1.119.92",
qs_ver: 'ver=1.119.92',
disabled: !!+false,
host: 've-cdn.h-cdn.com',
tpl: "/svc/preview/pub/image_preview.js?minify=true&snapshot=&host=ve-cdn.h-cdn.com&percent=undefined",
}[name];
return{}[name]};var console=window.console;function ie9_console(){if(console)return;console={log:function(){},error:function(){}}}ie9_console();function escape_qs(param,opt){opt=opt||{};var qs=opt.qs||"";var sep=qs||opt.amp?"&":"";if(!param)return qs;var uri_comp=encodeURIComponent;var uri_comp_val=uri_comp;for(var i in param){var val=param[i];if(val===undefined)continue;var key=uri_comp(i);qs+=sep;if(val===null)qs+=key;else if(Array.isArray(val)){if(!val.length)continue;qs+=val.map(function(val){return key+"="+uri_comp_val(val)}).join("&")}else qs+=key+"="+uri_comp_val(val);sep="&"}return qs}function send_beacon(url,data){if(navigator&&navigator.sendBeacon){if(navigator.sendBeacon(url,to_form_data(data)))return}var is_xdr=window.XDomainRequest!==undefined;var xhr=is_xdr?new XDomainRequest:new XMLHttpRequest;xhr.open("POST",url);if(window.FormData&&!is_xdr)data=to_form_data(data);else{data=escape_qs(data);if(!is_xdr){xhr.setRequestHeader("Accept","*/*");xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8")}else{return}}xhr.send(data)}function to_form_data(o){var data=new FormData;for(var k in o)data.append(k,o[k]);return data}function perr_raw(opt){var data={},qs={},zone,ver,hola_mode;if(window.hola_cdn){zone=window.hola_cdn.zone;ver=window.hola_cdn.ver;hola_mode=window.hola_cdn.mode}qs.browser=window.chrome?"chrome":"other";qs.id=opt.id;qs.ver=ver;data.build="platform: "+navigator.platform+"\n"+"user_agent: "+navigator.userAgent;data.is_json=1;data.info=opt.info||{};data.info.customer=customer;data.info.zone=zone;data.info.hola_mode=hola_mode;data.info.location_url=location.href;data.info.referrer=document.referrer;data.info=JSON.stringify(data.info);data.bt=opt.bt;var protocol=window&&window.location&&window.location.protocol;protocol=!protocol||!protocol.startsWith("http")?"http:":protocol;var url=protocol+"//perr.h-cdn.com/be_client_cgi/perr?"+escape_qs(qs);send_beacon(url,data)}function array_reduce(callback){if(this===null){throw new TypeError("Array.prototype.reduce called on null or"+" undefined")}if(typeof callback!=="function")throw new TypeError(callback+" is not a function");var t=Object(this),len=t.length>>>0,k=0,value;if(arguments.length==2)value=arguments[1];else{while(k<len&&!(k in t))k++;if(k>=len)throw new TypeError("Reduce of empty array with no initial value");value=t[k++]}for(;k<len;k++){if(k in t)value=callback(value,t[k],k,t)}return value}function fix_obj_props(obj,prop,test,fix){if(!obj[prop]||!test()){if(!fix)return;obj[prop]=fix}Object.defineProperty(obj,prop,{writable:false})}var site_errors,hola_errors,js_errors,ldr_errors,is_loader;var customer=E.zdot("customer"),tpl=E.zdot("tpl");is_loader=/^\/svc\/cdn\/pub\/loader.js/.test(tpl);if(is_loader){window.addEventListener("error",function(e){try{var send_perr;js_errors=(js_errors||0)+1;if(e.error){if(/\.h-cdn.com/.test(e.filename)){hola_errors=(hola_errors||0)+1;send_perr=hola_errors==1}else site_errors=(site_errors||0)+1}if(send_perr){perr_raw({id:"www_cdn_db_hola_js_error",bt:(e.error||{}).stack,info:{filename:e.filename,err:""+e.error,hola_errors:hola_errors,js_errors:js_errors,site_errors:site_errors,ldr_errors:ldr_errors}})}}catch(err){console.error("ldr_require error handler error",err);ldr_errors=(ldr_errors||0)+1}})}fix_obj_props(Array.prototype,"reduce",function(){return[].reduce(String,1)==1},array_reduce);if(window.Prototype){delete Object.prototype.toJSON;delete Array.prototype.toJSON;delete String.prototype.toJSON;delete Number.prototype.toJSON;for(var p in[])Object.defineProperty(Array.prototype,p,{enumerable:false})}E.module_registry={};E.aliases={};E.config=function(config){if(config.map!==undefined)E.aliases=config.map};function init_module(module,req){if(module.inited==true)return module.init;var args=get_args(module);if(module.inited==true)return module.init;module.init=typeof module.init!=="function"?module.init:module.init.apply(null,args);if(module.init instanceof Object){for(var prop in module.exports){if(module.exports.hasOwnProperty(prop))module.init[prop]=module.exports[prop]}}else if(!module.init){console.error("empty module: "+req);ldr_errors=(ldr_errors||0)+1}else module.init=module.exports;module.inited=true;return module.init}function get_args(requirments){var args=[];var reqs=Array.isArray(requirments)?requirments:requirments.reqs;for(var i=0,len=reqs.length;i<len;i++){var req=reqs[i];switch(req){case"exports":if(!requirments.exports)throw new Error("ldr_require: invalid dependence!");args.push(requirments.exports);break;default:var module=E.module_registry[req]||(E.aliases[req]?E.module_registry[E.aliases[req]]:undefined);if(!module)throw new Error("ldr_require: missing module: "+req);args.push(init_module(module,req));break}}return args}E.define=function(name,requirements,init){if(typeof name!="string")throw new Error("ldr_require: module name is needed");if(init===undefined&&!Array.isArray(requirements)){init=requirements;requirements=[]}E.module_registry[name]={init:init,reqs:requirements,inited:false,exports:{}}};E.specified=function(name){return!!E.module_registry[name]};E.require=function(requirements,fn){fn.apply(null,get_args(requirements))};if(is_loader)window.hola_cdn_require=E.require})();function define(name,deps,init){if(hola_ldr_require)return hola_ldr_require.define(name,deps,init)}define.amd=true;function require(reqs,fn){if(hola_ldr_require)return hola_ldr_require.require(reqs,fn)}require.config=function(){return require};require.specified=function(name){return hola_ldr_require.specified(name)};require.zdot=function(name){return hola_ldr_require.zdot(name)};define("/svc/preview/pub/ldr_require.js",function(){});
(function(){var __hola_stub_define;var is_node_ff=typeof module=="object"&&module.exports;if(!is_node_ff)define=define||self.define;else define=function(setup){module.exports=setup()};define("/util/es6_shim.js",[],function(){var E={t:{}};function add_prop(obj,prop,fn){if(obj[prop])return;Object.defineProperty(obj,prop,{enumerable:false,writable:true,configurable:true,value:fn})}E.t.object_assign=function(obj){for(var i=1;i<arguments.length;i++){var source=arguments[i];if(!source)continue;for(var prop in source){if(source.hasOwnProperty(prop))obj[prop]=source[prop]}}return obj};add_prop(Object,"assign",E.t.object_assign);E.t.object_values=function(obj){if(obj==null)throw new TypeError("Cannot convert undefined or null to object");var res=[];for(var prop in obj){if(obj.hasOwnProperty(prop))res.push(obj[prop])}return res};add_prop(Object,"values",E.t.object_values);E.t.object_entries=function(obj){if(obj==null)throw new TypeError("Cannot convert undefined or null to object");var res=[];for(var prop in obj){if(obj.hasOwnProperty(prop))res.push([prop,obj[prop]])}return res};add_prop(Object,"entries",E.t.object_entries);var can_set_proto={__proto__:[]}instanceof Array;E.t.object_setPrototypeOf=function(obj,proto){if(can_set_proto)obj.__proto__=proto;else{for(var prop in proto)obj[prop]=proto[prop]}return true};add_prop(Object,"setPrototypeOf",E.t.object_setPrototypeOf);E.t.string_startsWith=function(head){head=""+head;return!head||this.slice(0,head.length)===head};add_prop(String.prototype,"startsWith",E.t.string_startsWith);E.t.string_endsWith=function(tail){tail=""+tail;return!tail||this.slice(-tail.length)==tail};add_prop(String.prototype,"endsWith",E.t.string_endsWith);E.t.string_includes=function(search,index){return this.indexOf(search,index)>=0};add_prop(String.prototype,"includes",E.t.string_includes);E.t.string_repeat=function(n){var s="";for(var i=0;i<n;i++)s+=this;return s};add_prop(String.prototype,"repeat",E.t.string_repeat);E.t.string_trimLeft=function(){return this.replace(/^\s+/,"")};add_prop(String.prototype,"trimLeft",E.t.string_trimLeft);E.t.string_trimRight=function(){return this.replace(/\s+$/,"")};add_prop(String.prototype,"trimRight",E.t.string_trimRight);E.t.string_padStart=function(len,val){val=val||" ";var l=len-this.length;return l<=0?this:val.repeat(Math.ceil(l/val.length)).slice(0,l)+this};add_prop(String.prototype,"padStart",E.t.string_padStart);E.t.string_padEnd=function(len,val){val=val||" ";var l=len-this.length;return l<=0?this:this+val.repeat(Math.ceil(l/val.length)).slice(0,l)};add_prop(String.prototype,"padEnd",E.t.string_padEnd);E.t.array_includes=function(search,index){return this.indexOf(search,index)>=0};add_prop(Array.prototype,"includes",E.t.array_includes);E.t.array_find=function(fn,this_arg){var a=this,value;for(var i=0;i<a.length;i++){value=a[i];if(i in a&&fn.call(this_arg,value,i,a))return value}};add_prop(Array.prototype,"find",E.t.array_find);E.t.array_findIndex=function(fn,this_arg){var a=this,value;for(var i=0;i<a.length;i++){value=a[i];if(i in a&&fn.call(this_arg,value,i,a))return i}return-1};add_prop(Array.prototype,"findIndex",E.t.array_findIndex);E.t.array_of=function(){return Array.prototype.slice.call(arguments)};add_prop(Array,"of",E.t.array_of);E.t.array_from=function(a,fn,_this){a=Array.prototype.slice.call(a);return!fn?a:a.map(fn,_this)};add_prop(Array,"from",E.t.array_from);E.t.arraybuffer_slice=function(begin,end){begin=begin|0;end=(end==null?this.byteLength:end)|0;if(begin<0)begin+=this.byteLength;if(end<0)end+=this.byteLength;begin=Math.min(Math.max(0,begin),this.byteLength);end=Math.min(Math.max(0,end),this.byteLength);if(end-begin<=0)return new ArrayBuffer(0);var result=new ArrayBuffer(end-begin);var resultBytes=new Uint8Array(result);var sourceBytes=new Uint8Array(this,begin,end-begin);resultBytes.set(sourceBytes);return result};if(typeof ArrayBuffer!="undefined")add_prop(ArrayBuffer.prototype,"slice",E.t.arraybuffer_slice);add_prop(Number,"EPSILON",Math.pow(2,-52));E.t.number_isFinite=function(x){return typeof x=="number"&&isFinite(x)};add_prop(Number,"isFinite",E.t.number_isFinite);E.t.math_sign=function(x){x=+x;return x!==x?NaN:!x?x:x<0?-1:1};add_prop(Math,"sign",E.t.math_sign);E.t.math_trunc=function(x){x=+x;return x!==x?NaN:x<0?Math.ceil(x):Math.floor(x)};add_prop(Math,"trunc",E.t.math_trunc);E.t.math_imul=function(x,y){var hix=x>>>16&65535;var lox=x&65535;var hiy=y>>>16&65535;var loy=y&65535;return lox*loy+(hix*loy+lox*hiy<<16>>>0)|0};add_prop(Math,"imul",E.t.math_imul);function ie9_console(){if(typeof window!="object")return;if(window.console){if(!window.console.debug)window.console.debug=window.console.info;return}var console=window.console={};["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profiles","profileEnd","show","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"].forEach(function(p){console[p]=function(){}});["memory"].forEach(function(p){console[p]={}})}ie9_console();function ie9_location_origin(){if(typeof window!="object"||!window.location||"origin"in window.location){return}var location=window.location;var default_ports={"http:":80,"https:":443};var port=location.port;if(default_ports[location.protocol]==port)port=null;location.origin=location.protocol+"//"+location.hostname+(port?":"+port:"")}ie9_location_origin();function element_matches(){if(typeof Element!="object"&&typeof Element!="function"||Element.prototype.matches){return}Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector;if(Element.prototype.matches)return;Element.prototype.matches=function(s){var matches=(this.document||this.ownerDocument).querySelectorAll(s);var i=matches.length;while(--i>=0&&matches.item(i)!==this);return i>-1}}element_matches();function ie_edge_closest(){if(typeof Element!="object"&&typeof Element!="function"||Element.prototype.closest){return}Element.prototype.closest=function(selector){var el=this;while(el){if(el.matches(selector))return el;el=el.parentElement}return null}}ie_edge_closest();E.t.function_name=function(){var n=this.toString().match(/^function\s+([^\s(]+)/);return n&&n[1]||""};function ie_function_name(){if(ie_function_name.name=="ie_function_name")return;Object.defineProperty(Function.prototype,"name",{enumerable:false,configurable:false,get:E.t.function_name})}ie_function_name();function android18_animFrame(){if(typeof window!="object"||window.requestAnimationFrame)return;var start=Date.now();window.requestAnimationFrame=function(cb){setTimeout(function(){cb(Date.now()-start)},16)}}android18_animFrame();return E})})();
(function(){var __hola_stub_define;var is_node_ff=typeof module=="object"&&module.exports;if(!is_node_ff)define=define||self.define;else define=require("./require_node.js").define(module,"../");define("/util/array.js",[],function(){var E={};var proto_slice=Array.prototype.slice;E.copy=function(a){switch(a.length){case 0:return[];case 1:return[a[0]];case 2:return[a[0],a[1]];case 3:return[a[0],a[1],a[2]];case 4:return[a[0],a[1],a[2],a[3]];case 5:return[a[0],a[1],a[2],a[3],a[4]];default:return proto_slice.call(a)}};E.push=function(a){for(var i=1;i<arguments.length;i++){var arg=arguments[i];if(Array.isArray(arg))a.push.apply(a,arg);else a.push(arg)}return a.length};E.unshift=function(a){for(var i=arguments.length-1;i>0;i--){var arg=arguments[i];if(Array.isArray(arg))a.unshift.apply(a,arg);else a.unshift(arg)}return a.length};E.slice=function(args,from,to){return Array.prototype.slice.call(args,from,to)};E.compact=function(a){return E.compact_self(a.slice())};E.compact_self=function(a){var i,j,n=a.length;for(i=0;i<n&&a[i];i++);if(i==n)return a;for(j=i;i<n;i++){if(!a[i])continue;a[j++]=a[i]}a.length=j;return a};E.flatten_shallow=function(a){return Array.prototype.concat.apply([],a)};E.flatten=function(a){var _a=[],i;for(i=0;i<a.length;i++){if(Array.isArray(a[i]))Array.prototype.push.apply(_a,E.flatten(a[i]));else _a.push(a[i])}return _a};E.unique=function(a){var _a=[];for(var i=0;i<a.length;i++){if(!_a.includes(a[i]))_a.push(a[i])}return _a};E.to_nl=function(a,sep){if(!a||!a.length)return"";if(sep===undefined)sep="\n";return a.join(sep)+sep};E.sed=function(a,regex,replace){var _a=new Array(a.length),i;for(i=0;i<a.length;i++)_a[i]=a[i].replace(regex,replace);return _a};E.grep=function(a,regex,replace){var _a=[],i;for(i=0;i<a.length;i++){if(a[i].search(regex)<0)continue;if(replace!==undefined)_a.push(a[i].replace(regex,replace));else _a.push(a[i])}return _a};E.rm_elm=function(a,elm){var i=a.indexOf(elm);if(i<0)return;a.splice(i,1);return elm};E.rm_elm_tail=function(a,elm){var i=a.length-1;if(elm===a[i]){a.pop();return elm}if((i=a.lastIndexOf(elm,i-1))<0)return;a.splice(i,1);return elm};E.add_elm=function(a,elm){if(a.includes(elm))return;a.push(elm);return elm};E.split_every=function(a,n){var ret=[];for(var i=0;i<a.length;i+=n)ret.push(a.slice(i,i+n));return ret};E.split_at=function(a,delim){var ret=[];delim=delim||"";for(var i=0;i<a.length;i++){var chunk=[];for(;i<a.length&&a[i]!=delim;i++)chunk.push(a[i]);if(chunk.length)ret.push(chunk)}return ret};E.rotate=function(a,n){if(a&&a.length>1&&(n=n%a.length))E.unshift(a,a.splice(n));return a};E.move=function(a,from,to,n){return Array.prototype.splice.apply(a,[to,n].concat(a.slice(from,from+n)))};E.to_array=function(v){return Array.isArray(v)?v:v==null?[]:[v]};var proto={};proto.sed=function(regex,replace){return E.sed(this,regex,replace)};proto.grep=function(regex,replace){return E.grep(this,regex,replace)};proto.to_nl=function(sep){return E.to_nl(this,sep)};proto.push_a=function(){return E.push.apply(null,[this].concat(Array.from(arguments)))};proto.unshift_a=function(){return E.unshift.apply(null,[this].concat(Array.from(arguments)))};var installed;E.prototype_install=function(){if(installed)return;installed=true;for(var i in proto){Object.defineProperty(Array.prototype,i,{value:proto[i],configurable:true,enumerable:false,writable:true})}};E.prototype_uninstall=function(){if(!installed)return;installed=false;for(var i in proto)delete Array.prototype[i]};return E})})();
(function(){var __hola_stub_define,node_util;var is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";var is_ff_addon=typeof module=="object"&&module.uri&&!module.uri.indexOf("resource://");if(is_ff_addon)define=require("./require_node.js").define(module,"../");else if(is_rn){define=require("./require_node.js").define(module,"../",require("/util/array.js"))}else if(!is_node)define=define||self.define;else{node_util=require("util");define=require("./require_node.js").define(module,"../")}define("/util/util.js",["/util/array.js"],function(array){var E={};E._is_mocha=undefined;E.is_mocha=function(){if(E._is_mocha!==undefined)return E._is_mocha;if(typeof process!="undefined"&&typeof process.env!="undefined")return E._is_mocha=process.env.IS_MOCHA||false;return E._is_mocha=false};E.is_lxc=function(){return is_node&&+process.env.LXC};E.f_mset=function(flags,mask,bits){return flags&~mask|bits};E.f_lset=function(flags,bits,logic){return E.f_mset(flags,bits,logic?bits:0)};E.f_meq=function(flags,mask,bits){return(flags&mask)==bits};E.f_eq=function(flags,bits){return(flags&bits)==bits};E.f_cmp=function(f1,f2,mask){return(f1&mask)==(f2&mask)};E.xor=function(a,b){return!a!=!b};E.div_ceil=function(a,b){return Math.floor((a+b-1)/b)};E.ceil_mul=function(a,b){return E.div_ceil(a,b)*b};E.floor_mul=function(a,b){return Math.floor(a/b)*b};E.range=function(x,a,b){return x>=a&&x<=b};E.range.ii=function(x,a,b){return x>=a&&x<=b};E.range.ie=function(x,a,b){return x>=a&&x<b};E.range.ei=function(x,a,b){return x>a&&x<=b};E.range.ee=function(x,a,b){return x>a&&x<b};E.clamp=function(lower_bound,value,upper_bound){if(value<lower_bound)return lower_bound;if(value<upper_bound)return value;return upper_bound};E.revcmp=function(a,b){return a>b?-1:a<b?1:0};E.union_with=function(fn){var res={},args;if(arguments.length==2&&typeof arguments[1]=="object")args=arguments[1];else args=array.slice(arguments,1);for(var i=0;i<args.length;++i){for(var key in args[i]){var arg=args[i];res[key]=res.hasOwnProperty(key)?fn(res[key],arg[key]):arg[key]}}return res};function _clone_deep(obj){var i,n,ret;if(obj instanceof Array){ret=new Array(obj.length);n=obj.length;for(i=0;i<n;i++)ret[i]=obj[i]instanceof Object?_clone_deep(obj[i]):obj[i];return ret}else if(obj instanceof Date)return new Date(obj);else if(obj instanceof RegExp)return new RegExp(obj);else if(obj instanceof Function)return obj;ret={};for(i in obj)ret[i]=obj[i]instanceof Object?_clone_deep(obj[i]):obj[i];return ret}E.clone_deep=function(obj){if(!(obj instanceof Object))return obj;return _clone_deep(obj)};E.extend=function(obj){for(var i=1;i<arguments.length;i++){var source=arguments[i];if(!source)continue;for(var prop in source)obj[prop]=source[prop]}return obj};function is_object(obj){return obj&&obj.constructor==Object}E.extend_deep=function(obj){if(!is_object(obj))return obj;for(var i=1;i<arguments.length;i++){var source=arguments[i];if(!source)continue;for(var prop in source){if(is_object(source[prop])&&is_object(obj[prop]))E.extend_deep(obj[prop],source[prop]);else obj[prop]=source[prop]}}return obj};E.extend_deep_del_null=function(obj){for(var i=1;i<arguments.length;i++){var source=arguments[i];if(!source)continue;for(var prop in source){if(is_object(source[prop])){if(!is_object(obj[prop]))obj[prop]={};E.extend_deep_del_null(obj[prop],source[prop])}else if(source[prop]==null)delete obj[prop];else obj[prop]=source[prop]}}return obj};E.defaults=function(obj){if(!obj)obj={};for(var i=1;i<arguments.length;i++){var source=arguments[i];if(obj===undefined)continue;for(var prop in source){if(obj[prop]===undefined)obj[prop]=source[prop]}}return obj};E.defaults_deep=function(obj){if(obj!==undefined&&!is_object(obj))return obj;for(var i=1;i<arguments.length;i++){var source=arguments[i];if(obj===undefined)obj=E.clone_deep(source);else if(is_object(source)){for(var prop in source){var s=source[prop],d=obj[prop];if(d===undefined)obj[prop]=E.clone_deep(s);else E.defaults_deep(d,s)}}}return obj};E.clone=function(obj){if(!(obj instanceof Object))return obj;if(obj instanceof Array){var a=new Array(obj.length);for(var i=0;i<obj.length;i++)a[i]=obj[i];return a}return E.extend({},obj)};E.freeze_deep=function(obj){if(typeof obj=="object"){for(var prop in obj){if(obj.hasOwnProperty(prop))E.freeze_deep(obj[prop])}}return Object.freeze(obj)};E.equal_deep=function(a,b){var i;if(a===b)return true;if(!a||!b||a.constructor!==b.constructor)return false;if(a instanceof Function||a instanceof RegExp)return a.toString()==b.toString();if(a instanceof Date)return+a==+b;if(Array.isArray(a)){if(a.length!=b.length)return false;for(i=0;i<a.length;i++){if(!E.equal_deep(a[i],b[i]))return false}return true}if(is_object(a)){var a_keys=Object.keys(a),b_keys=Object.keys(b);if(a_keys.length!=b_keys.length)return false;for(i=0;i<a_keys.length;i++){var key=a_keys[i];if(!E.equal_deep(a[key],b[key]))return false}return true}return false};E.map_obj=function(obj,fn){var ret={};for(var i in obj)ret[i]=fn(obj[i],i,obj);return ret};E.sort_obj=function(obj,fn){if(obj instanceof Array||!(obj instanceof Object))return obj;var ret={},keys=Object.keys(obj).sort(fn);for(var i=0;i<keys.length;i++)ret[keys[i]]=E.sort_obj(obj[keys[i]],fn);return ret};E.forEach=function(obj,fn,_this){for(var i in obj)fn.call(_this,obj[i],i,obj)};E.find=function(obj,fn,_this){for(var i in obj){if(fn.call(_this,obj[i],i,obj))return obj[i]}};E.find_prop=function(obj,prop,val){return E.find(obj,function(o){return o[prop]===val})};E.isspace=function(c){return/\s/.test(c)};E.isdigit=function(c){return c>="0"&&c<="9"};E.isalpha=function(c){return c>="a"&&c<="z"||c>="A"&&c<="Z"};E.isalnum=function(c){return E.isdigit(c)||E.isalpha(c)};E.obj_pluck=function(obj,prop){var val=obj[prop];delete obj[prop];return val};E.proto_keys=function(proto){var keys=[];for(var i in proto)keys.push(i);return keys};E.values=function(obj){var values=[];for(var i in obj)values.push(obj[i]);return values};E.path=function(path){if(Array.isArray(path))return path;path=""+path;if(!path)return[];return path.split(".")};E.get=function(o,path,def){path=E.path(path);for(var i=0;i<path.length;i++){if(!o||typeof o!="object"&&typeof o!="function"||!(path[i]in o)){return def}o=o[path[i]]}return o};E.set=function(o,path,value){path=E.path(path);for(var i=0;i<path.length-1;i++){var p=path[i];o=o[p]||(o[p]={})}o[path[path.length-1]]=value};E.unset=function(o,path){path=E.path(path);for(var i=0;i<path.length-1;i++){var p=path[i];if(!o[p])return;o=o[p]}delete o[path[path.length-1]]};var has_unique={};E.has=function(o,path){return E.get(o,path,has_unique)!==has_unique};E.own=function(o,prop){return Object.prototype.hasOwnProperty.call(o,prop)};E.bool_lookup=function(a,split){var ret={},i;if(typeof a=="string")a=a.split(split||/\s/);for(i=0;i<a.length;i++)ret[a[i]]=true;return ret};E.clone_inplace=function(dst,src){if(dst===src)return dst;if(Array.isArray(dst)){for(var i=0;i<src.length;i++)dst[i]=src[i];dst.splice(src.length)}else if(typeof dst=="object"){for(var k in src)dst[k]=src[k];for(k in dst){if(!src.hasOwnProperty(k))delete dst[k]}}return dst};if(node_util&&node_util.inherits)E.inherits=node_util.inherits;else{E.inherits=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}E.inherit_init=function(obj,ctor,params){var orig_proto=Object.getPrototypeOf(obj);var ctor_proto=Object.assign({},ctor.prototype);Object.setPrototypeOf(ctor_proto,orig_proto);Object.setPrototypeOf(obj,ctor_proto);return ctor.apply(obj,params)};E.pick=function(obj){var i,o={};for(i=1;i<arguments.length;i++){if(E.own(obj,arguments[i]))o[arguments[i]]=obj[arguments[i]]}return o};E.omit=function(obj,omit){var i,o={};obj=Object(obj);for(i in obj){if(!omit.includes(i))o[i]=obj[i]}return o};return E})})();
(function(){var __hola_stub_define,hash,assert,zerr,vm;var is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";var is_ff_addon=typeof module=="object"&&module.uri&&!module.uri.indexOf("resource://");if(!is_node){if(is_ff_addon)define=require("./require_node.js").define(module,"../");else if(is_rn){define=require("./require_node.js").define(module,"../",require("/util/util.js"))}else define=define||self.define;assert=function(){};if(!is_ff_addon&&!is_rn&&self.hola&&self.hola.zerr)zerr=self.hola.zerr;else{zerr=function(){console.log.apply(console,arguments)};zerr.perr=zerr}}else{require("./config.js");zerr=require("./zerr.js");hash=require("crypto");assert=require("assert");vm=require("vm");define=require("./require_node.js").define(module,"../")}define("/util/conv.js",["/util/util.js"],function(zutil){var E={};var has_map=typeof Map=="function"&&Map.prototype.get&&Map.prototype.set;has_map=0;E.cache_str_map_fn=function(fn){var cache=new Map;return function(s){s=""+s;var v=cache.get(s);if(v!==undefined||cache.has(s))return v;cache.set(s,v=fn(s));return v}};E.cache_str_obj_fn=function(fn){var cache={};return function(s){if(s in cache)return cache[s];return cache[s]=fn(s)}};E.cache_str_fn=has_map?E.cache_str_map_fn:E.cache_str_obj_fn;E.cache_str_fn2=function(fn){var cache={};return function(s1,s2){var cache2=cache[s1]=cache[s1]||{};if(s2 in cache2)return cache2[s2];return cache2[s2]=fn(s1,s2)}};E.o=function(oct_str){return parseInt(oct_str,8)};E.md5=function(buf,hash_len,encoding){return hash.createHash("md5").update(buf,encoding||"utf8").digest("hex").slice(0,hash_len)};E.md5_zero=function(key,hash_len){assert(hash_len<=32,"invalid hash len"+hash_len);if(!key||!key.length)return"0".repeat(hash_len);return E.md5(key,hash_len)};E.md5_etag=function(buf){return E.md5(buf,8)};E.inet_ntoa_t=function(ip){return((ip&4278190080)>>>24)+"."+((ip&16711680)>>>16)+"."+((ip&65280)>>>8)+"."+(ip&255)};E.inet_addr=function(ip){var parts=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/.exec(ip);if(parts===null)return null;if(parts[1]>255||parts[2]>255||parts[3]>255||parts[4]>255)return null;return(parts[1]<<24)+(parts[2]<<16)+(parts[3]<<8)+(parts[4]|0)>>>0};function flags_to_str_once(flags,conv){var f='var s = "";\n';f+='if (!flags) return "";\n';for(var i in conv){if(!conv.hasOwnProperty(i))continue;f+="if (flags & "+conv[i]+") "+"{ s += "+JSON.stringify(i.toLowerCase())+'+" ";'+" flags &= ~"+conv[i]+"; }\n"}f+="if (flags && conv.__conv_to_str.err) "+"conv.__conv_to_str.err(flags, conv);\n";f+="return s.slice(0, -1);\n";var func=new Function(["flags","conv"],f);Object.defineProperty(conv,"__conv_to_str",{enumerable:false,writable:true});conv.__conv_to_str=func;func.err=function(_flags,_conv){zerr.perr("flags_str_invalid","flags "+_flags+" "+JSON.stringify(_conv).slice(0,30))};return conv.__conv_to_str(flags,conv)}E.flags_to_str=function(flags,conv){if(conv.__conv_to_str)return conv.__conv_to_str(flags,conv);return flags_to_str_once(flags,conv)};function flags_from_str_once(s,conv){var f="var flags = 0, a, i;\n";f+="if (!s) return 0;\n";f+="s = s.toUpperCase();\n";f+='a = s.split(",");\n';f+="for (i=0; i<a.length; i++)\n";f+="{\n";f+="    if (!conv[a[i]])\n";f+="    {\n";f+="        if (flags && conv.__conv_from_str.err) "+"conv.__conv_from_str.err(flags, conv);\n";f+="        return -1;\n";f+="    }\n";f+="    flags |= conv[a[i]];\n";f+="}\n";f+="return flags;\n";var func=new Function(["s","conv"],f);Object.defineProperty(conv,"__conv_from_str",{enumerable:false,writable:true});conv.__conv_from_str=func;func.err=function(_s,_conv){zerr.perr("flags_str_invalid","flags "+_s+" "+JSON.stringify(_conv).slice(0,30))};return conv.__conv_from_str(s,conv)}E.flags_from_str=function(s,conv){if(conv.__conv_from_str)return conv.__conv_from_str(s,conv);return flags_from_str_once(s,conv)};E.scale_vals={1e3:[{s:"",n:1},{s:"K",n:1e3},{s:"M",n:1e6},{s:"G",n:1e9},{s:"T",n:1e12},{s:"P",n:1e15}],1024:[{s:"",n:1},{s:"K",n:1024},{s:"M",n:Math.pow(1024,2)},{s:"G",n:Math.pow(1024,3)},{s:"T",n:Math.pow(1024,4)},{s:"P",n:Math.pow(1024,5)}]};E.scaled_number=function(num,opt){opt=opt||{};var sign="",per=opt.per,scale=opt.scale;var base=opt.base==1024?1024:1e3,ratio=opt.ratio||1;var units=opt.units===undefined||opt.units;function _per(){return per?E.fmt_per(per):""}if(num<0){sign="-";num=-num}if(num===undefined)return"";if(isNaN(num))return opt.nan||"x";if(num==Infinity)return sign+"∞";var scale_vals=E.scale_vals[base],i=0;if(scale==null)for(;i<scale_vals.length-1&&num>=scale_vals[i+1].n*ratio;i++);else i=scale_vals.findIndex(function(_scale){return _scale.s==scale});if(per=="ms"&&i){per="s";i--;num=num/1e3}scale=scale_vals[i];if(opt.is_scale)return scale.n;num/=scale.n;if(num<.001)return"0"+_per();if(num>=base-1)num=Math.trunc(num);var str=num.toFixed(num<1?3:num<10?2:num<100?1:0);return sign+str.replace(/((\.\d*[1-9])|\.)0*$/,"$2")+(units?(opt.space?" ":"")+scale.s:"")+_per()};E.scaled_bytes=function(num,opt){return E.scaled_number(num,Object.assign({base:1e3},opt))};E.fmt_currency=function(amount,digits,currency_sign){if(amount===undefined)return;if(digits===undefined)digits=2;if(currency_sign===undefined)currency_sign="$";var sign=amount<0?"-":"";amount=Math.abs(amount);amount=(+amount).toLocaleString("en-GB",{useGrouping:true,maximumFractionDigits:digits})||amount;return sign+currency_sign+amount};E.fmt_per=function(per){if(!per)return"";switch(per){case"s":case"ms":return per;case"%":case"%%":return"%";default:return"/"+per[0]}};E.parse_function=function(f){var m=/^function\s*([\w$]+)?\s*\(\n?([\s\w$,]*?)(\s*\/\*`*\*\/)?\)\s*\{\n?([\s\S]*?)\n?\}$/.exec(f);return{name:m[1]||null,args:m[2]?m[2].split(/\s*,\s*/):[],body:m[4]}};function date_stringify(d){return{__ISODate__:d.toISOString()}}var pos_inf={__Infinity__:1};var neg_inf={__Infinity__:-1};function replace_inf(k,v){switch(v){case Infinity:return pos_inf;case-Infinity:return neg_inf;default:return v}}E.JSON_stringify=function(obj,opt){var s,prev_date,_date,prev_func,prev_re;var date_class,func_class,re_class;opt=opt||{};if(opt.date)_date=typeof opt.date=="function"?opt.date:date_stringify;if(opt.mongo)_date=date_stringify;if(_date){date_class=opt.vm_context?vm.runInContext("Date",opt.vm_context):Date;prev_date=date_class.prototype.toJSON;date_class.prototype.toJSON=function(){return _date(this)}}if(opt.func){func_class=opt.vm_context?vm.runInContext("Function",opt.vm_context):Function;prev_func=func_class.prototype.toJSON;func_class.prototype.toJSON=function(){return{__Function__:this.toString()}}}if(opt.re){re_class=opt.vm_context?vm.runInContext("RegExp",opt.vm_context):RegExp;prev_re=re_class.prototype.toJSON;Object.defineProperty(re_class.prototype,"toJSON",{value:function(){return{__RegExp__:this.toString()}},writable:true})}var opt_replacer=opt.replacer;var replacer=opt_replacer;if(opt.inf){if(opt_replacer&&typeof opt_replacer=="function"){replacer=function(k,v){if(this==pos_inf||this==neg_inf)return v;return opt_replacer.call(this,k,replace_inf.call(this,k,v))}}else if(opt_replacer&&Array.isArray(opt_replacer)){replacer=function(k,v){if(v==obj||this==pos_inf||this==neg_inf)return v;if(opt_replacer.includes(k))return replace_inf.call(this,k,v)}}else replacer=replace_inf}try{s=JSON.stringify(obj,replacer,opt.spaces)}finally{if(_date)date_class.prototype.toJSON=prev_date;if(opt.func)func_class.prototype.toJSON=prev_func;if(opt.re)re_class.prototype.toJSON=prev_re}if(opt.mongo)s=s.replace(/\{"__ISODate__":("[0-9TZ:.-]+")\}/g,"ISODate($1)");return s};function parse_leaf(v,opt){if(!v||typeof v!="object"||Object.keys(v).length!=1)return v;if(v.__ISODate__&&opt.date)return new Date(v.__ISODate__);if(v.__Function__&&opt.func){if(vm)return vm.runInThisContext("("+v.__Function__+")");return new Function("","return ("+v.__Function__+");")()}if(v.__RegExp__&&opt.re){var parsed=/^\/(.*)\/(\w*)$/.exec(v.__RegExp__);if(!parsed)throw new Error("failed parsing regexp");return new RegExp(parsed[1],parsed[2])}if(v.__Infinity__&&opt.inf)return v.__Infinity__<0?-Infinity:Infinity;return v}function parse_obj(v,opt){if(!v||typeof v!="object")return v;if(Array.isArray(v)){for(var i=0;i<v.length;i++)v[i]=parse_obj(v[i],opt);return v}var v2=parse_leaf(v,opt);if(v2!==v)return v2;for(var key in v)v[key]=parse_obj(v[key],opt);return v}E.JSON_parse=function(s,opt){opt=Object.assign({date:true,re:true,func:true,inf:true},opt);return JSON.parse(s,function(k,v){return parse_leaf(v,opt)})};E.JSON_parse_obj=function(v,opt){opt=Object.assign({date:true,re:true,func:true,inf:true},opt);return parse_obj(v,opt)};E.hex2bin=function(hex,opt){var byte_array=opt&&opt.byte_array;var bin=byte_array?new Uint8Array:[];var re=/('.)|([0-9a-f][0-9a-f]?)|\s+|[.-]|(.)/gi;var m,v;for(re.lastIndex=0;m=re.exec(hex);){if(m[1])v=m[1].charCodeAt(1);else if(m[2])v=parseInt(m[2],16);else if(m[3])return null;else continue;bin.push(v)}return bin};E.bin2hex=function(arr){var s="",v,i;for(i=0;i<arr.length;i++){v=(arr[i]&255).toString(16).toUpperCase();s+=(v.length<2?"0":"")+v+" "}return s.trim()};E.str2bin=function(s,offset){var len;if(!s||!(len=s.length))return;offset=offset||0;var arr=new Uint8Array(len-offset);for(var i=offset,j=0;i<len;i++,j++)arr[j]=s.charCodeAt(i);return arr};E.tab2sp=function(line){var added=0;return line.replace(/\t/g,function(m,offset,str){var insert=8-(added+offset)%8;added+=insert-1;return" ".repeat(insert)})};E.str2utf8bin=function(s){if(!s||!s.length)return;var arr=new Uint8Array(s.length*3);var len=s.length,i=0,j=0,c,extra;while(i<len){c=s.charCodeAt(i++);if(c>=55296&&c<=56319&&i<len){extra=s.charCodeAt(i++);if((extra&64512)==56320)c=((c&1023)<<10)+(extra&1023)+65536;else i--}if((c&4294967168)==0)arr[j++]=c;else{if((c&4294965248)==0)arr[j++]=c>>6&31|192;else if((c&4294901760)==0){arr[j++]=c>>12&15|224;arr[j++]=c>>6&63|128}else if((c&4292870144)==0){arr[j++]=c>>18&7|240;arr[j++]=c>>12&63|128;arr[j++]=c>>6&63|128}arr[j++]=c&63|128}}return arr.slice(0,j)};E.utf8bin2str=function(arr,offset,len){if(arr.byteLength&&!arr.length)arr=new Uint8Array(arr);var out="",i=offset||0,cp;var c,char2,char3,char4;len=len?i+len:arr.length;while(i<len){c=arr[i++];switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:out+=String.fromCharCode(c);break;case 12:case 13:char2=arr[i++];out+=String.fromCharCode((c&31)<<6|char2&63);break;case 14:char2=arr[i++];char3=arr[i++];out+=String.fromCharCode((c&15)<<12|(char2&63)<<6|(char3&63)<<0);break;case 15:char2=arr[i++];char3=arr[i++];char4=arr[i++];cp=(c&3)<<18|(char2&63)<<12|(char3&63)<<6|char4&63;cp-=65536;out+=String.fromCharCode(55296|cp>>10);out+=String.fromCharCode(56320|cp&1023);break}}return out};return E})})();
(function(){var __hola_stub_define;var is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";var is_ff_addon=typeof module=="object"&&module.uri&&!module.uri.indexOf("resource://");var qs;if(is_rn)define=require("./require_node.js").define(module,"../");else if(!is_node&&!is_ff_addon)define=define||self.define;else{define=require("./require_node.js").define(module,"../");var _require=require;qs=_require(is_ff_addon?"sdk/querystring":"querystring")}define("/util/url.js",[],function(){var assign=Object.assign;var E={};E.add_proto=function(url){if(!url.match(/^([a-z0-9]+:)?\/\//i))url="http://"+url;return url};E.rel_proto_to_abs=function(url){var proto=is_node?"http:":location.protocol;return url.replace(/^\/\//,proto+"//")};E.get_top_level_domain=function(host){var n=host.match(/\.([^.]+)$/);return n?n[1]:""};E.get_host=function(url){var n=url.match(/^(https?:)?\/\/([^\/]+)\/.*$/);return n?n[2]:""};E.get_host_without_tld=function(host){return host.replace(/^([^.]+)\.[^.]{2,3}(\.[^.]{2,3})?$/,"$1")};var generic_2ld={com:1,biz:1,net:1,org:1,xxx:1,edu:1,gov:1,ac:1,co:1,or:1,ne:1,kr:1,jp:1,jpn:1,cn:1};E.get_root_domain=function(domain){if(E.is_ip(domain))return domain;var s=domain.split("."),root=s,len=s.length;if(len>2){var hd=0;if(s[len-1]=="hola"){hd=2;if(s[len-2].match(/^\d+$/))hd=3}if(generic_2ld[s[len-2-hd]])root=s.slice(-3-hd,len-hd);else root=s.slice(-2-hd,len-hd)}return root.join(".")};E.get_domain_email=function(email){var match=email.toLowerCase().match(/^[a-z0-9_\.\-\+]+@(.*)$/);return match&&match[1]};E.get_root_domain_email=function(email){var domain=E.get_domain_email(email);return domain&&E.get_root_domain(domain)};E.get_path=function(url){var n=url.match(/^https?:\/\/[^\/]+(\/.*$)/);return n?n[1]:""};E.get_proto=function(url){var n=url.match(/^([a-z0-9]+):\/\//);return n?n[1]:""};E.get_host_gently=function(url){var n=url.match(/^(?:(?:[a-z0-9]+?:)?\/\/)?([^\/]+)/);return n?n[1]:""};E.is_ip=function(host){var m=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/.exec(host);if(!m)return false;for(var i=1;i<=4;i++){if(+m[i]>255)return false}return true};E.is_ip_mask=function(host){var m=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/.exec(host);if(!m)return false;if(E.ip2num(host)==0)return false;var final=false;var check_num_mask=function(num){var arr=(num>>>0).toString(2).split(""),final=false;for(var i=0;i<arr.length;i++){if(final&&arr[i]=="1")return false;if(!final&&arr[i]=="0")final=true}return true};for(var i=1;i<=4;i++){if(+m[i]>255)return false;if(final&&+m[i]>0)return false;if(!final&&+m[i]<255){if(!check_num_mask(+m[i]))return false;final=true}}return!!final};E.ip2num=function(ip){var num=0;ip.split(".").forEach(function(octet){num<<=8;num+=+octet});return num>>>0};E.num2ip=function(num){return(num>>>24)+"."+(num>>16&255)+"."+(num>>8&255)+"."+(num&255)};E.is_ip_subnet=function(host){var m=/(.+?)\/(\d+)$/.exec(host);return m&&E.is_ip(m[1])&&+m[2]<=32};E.is_ip_netmask=function(host){var ips=host.split("/");if(ips.length!=2||!E.is_ip(ips[0])||!E.is_ip_mask(ips[1]))return false;return true};E.is_ip_range=function(host){var ips=host.split("-");if(ips.length!=2||!E.is_ip(ips[0])||!E.is_ip(ips[1]))return false;return E.ip2num(ips[0])<E.ip2num(ips[1])};E.is_ip_port=function(host){var m=/(.+?)(?::(\d{1,5}))?$/.exec(host);return m&&E.is_ip(m[1])&&!(+m[2]>65535)};E.is_valid_url=function(url){return/^(https?:\/\/)?([a-z0-9-]+\.)+[a-z0-9-]+(\/.*)?$/i.test(url)};E.is_valid_domain=function(domain){return/^([a-z0-9]([a-z0-9-_]*[a-z0-9])?\.)+[a-z]{2,63}$/.test(domain)};E.is_hola_domain=function(domain){return domain.search(/^(.*\.)?(hola\.org|holacdn\.com|h-cdn\.com)$/)!=-1};E.is_valid_email=function(email){var n=email.toLowerCase().match(/^[a-z0-9_\.\-\+]+@(.*)$/);return!!(n&&E.is_valid_domain(n[1]))};E.is_ip_in_range=function(ips_range,ip){if(!E.is_ip_range(ips_range)||!E.is_ip(ip))return false;var ips=ips_range.split("-");var min_ip=E.ip2num(ips[0]),max_ip=E.ip2num(ips[1]);var num_ip=E.ip2num(ip);return num_ip>=min_ip&&num_ip<=max_ip};E.is_ip_local=function(ip){return E.is_ip_in_range("10.0.0.0-10.255.255.255",ip)||E.is_ip_in_range("172.16.0.0-172.31.255.255",ip)||E.is_ip_in_range("192.168.0.0-192.168.255.255",ip)||E.is_ip_in_range("169.254.0.0-169.254.255.255",ip)};E.host_lookup=function(lookup,host){var pos;while(1){if(host in lookup)return lookup[host];if((pos=host.indexOf("."))<0)return;host=host.slice(pos+1)}};E.uri_obj_href=function(uri){return(uri.protocol||"")+(uri.slashes?"//":"")+(uri.host?(uri.auth?uri.auth+"@":"")+uri.host:"")+uri.path+(uri.hash||"")};var protocol_re=/^((?:about|http|https|file|ftp|ws|wss):)?(\/\/)?/i;var host_section_re=/^(.*?)(?:[\/?#]|$)/;var host_re=/^(?:(([^:@]*):?([^:@]*))?@)?([^:]*)(?::(\d*))?/;var path_section_re=/^([^?#]*)(\?[^#]*)?(#.*)?$/;var path_re_loose=/^(\/(?:.(?![^\/]*\.[^\/.]+$))*\/?)?([^\/]*?(?:\.([^.]+))?)$/;var path_re_strict=/^(\/(?:.(?![^\/]*(?:\.[^\/.]+)?$))*\/?)?([^\/]*?(?:\.([^.]+))?)$/;E.parse=function(url,strict){function re(expr,str){var m;try{m=expr.exec(str)}catch(e){m=null}if(!m)return m;for(var i=0;i<m.length;i++)m[i]=m[i]===undefined?null:m[i];return m}url=url||location.href;var m,uri={orig:url},remaining=url;if(!(m=re(protocol_re,remaining)))return{};uri.protocol=m[1];if(uri.protocol!==null)uri.protocol=uri.protocol.toLowerCase();uri.slashes=!!m[2];if(!uri.protocol&&!uri.slashes){uri.protocol="http:";uri.slashes=true}remaining=remaining.slice(m[0].length);if(!(m=re(host_section_re,remaining)))return{};uri.authority=m[1];remaining=remaining.slice(m[1].length);if(!(m=re(host_re,uri.authority)))return{};uri.auth=m[1];uri.user=m[2];uri.password=m[3];uri.hostname=m[4];uri.port=m[5];if(uri.hostname!==null){uri.hostname=uri.hostname.toLowerCase();uri.host=uri.hostname+(uri.port?":"+uri.port:"")}if(!(m=re(path_section_re,remaining)))return{};uri.relative=m[0];uri.pathname=m[1];uri.search=m[2];uri.query=uri.search?uri.search.substring(1):null;uri.hash=m[3];if(!(m=re(strict?path_re_strict:path_re_loose,uri.pathname)))return{};uri.directory=m[1];uri.file=m[2];uri.ext=m[3];if(uri.file=="."+uri.ext)uri.ext=null;if(!uri.pathname)uri.pathname="/";uri.path=uri.pathname+(uri.search||"");uri.href=E.uri_obj_href(uri);return uri};E.qs_parse=function(q,bin,safe){var obj={};q=q.length?q.split("&"):[];var len=q.length;var unescape_val=bin?function(val){return qs.unescapeBuffer(val,true).toString("binary")}:safe?function(val){try{return decodeURIComponent(val.replace(/\+/g," "))}catch(e){return val}}:function(val){return decodeURIComponent(val.replace(/\+/g," "))};for(var i=0;i<len;++i){var x=q[i];var idx=x.indexOf("=");var kstr=idx>=0?x.substr(0,idx):x;var vstr=idx>=0?x.substr(idx+1):"";var k=unescape_val(kstr);var v=unescape_val(vstr);if(obj[k]===undefined)obj[k]=v;else if(Array.isArray(obj[k]))obj[k].push(v);else obj[k]=[obj[k],v]}return obj};function token_regex(s,end){return end?"^"+s+"$":s}E.http_glob_host=function(host,end){var port="";var parts=host.split(":");host=parts[0];if(parts.length>1)port=":"+parts[1].replace("*","[0-9]+");var n=host.match(/^(|.*[^*])(\*+)$/);if(n){host=E.http_glob_host(n[1])+(n[2].length==1?"[^./]+":"[^/]"+(n[1]?"*":"+"));return token_regex(host+port,end)}host=host.replace(/\*\*\./,"**").replace(/\*\./,"*").replace(/\./g,"\\.").replace(/\*\*/g,"(([^./]+\\.)+)?").replace(/\*/g,"[^./]+\\.");return token_regex(host+port,end)};E.http_glob_path=function(path,end){if(path[0]=="*")return E.http_glob_path("/"+path,end);var n=path.match(/^(|.*[^*])(\*+)([^*^\/]*)$/);if(n){path=E.http_glob_path(n[1])+(n[2].length==1?"[^/]+":".*")+E.http_glob_path(n[3]);return token_regex(path,end)}path=path.replace(/\*\*\//,"**").replace(/\*\//,"*").replace(/\//g,"\\/").replace(/\./g,"\\.").replace(/\*\*/g,"(([^/]+\\/)+)?").replace(/\*/g,"[^/]+\\/");return token_regex(path,end)};E.http_glob_url=function(url,end){var n=url.match(/^((.*):\/\/)?([^\/]+)(\/.*)?$/);if(!n)return null;var prot=n[1]?n[2]:"*";var host=n[3];var path=n[4]||"**";if(prot=="*")prot="https?";host=E.http_glob_host(host);path=E.http_glob_path(path);return token_regex(prot+":\\/\\/"+host+path,end)};E.root_url_cmp=function(a,b){var a_s=a.match(/^[*.]*([^*]+)$/);var b_s=b.match(/^[*.]*([^*]+)$/);if(!a_s&&!b_s)return false;var re,s;if(a_s&&b_s&&a_s[1].length>b_s[1].length||a_s&&!b_s){s=a_s[1];re=b}else{s=b_s[1];re=a}s=E.add_proto(s)+"/";if(!(re=E.http_glob_url(re,1)))return false;try{re=new RegExp(re)}catch(e){return false}return re.test(s)};E.qs_strip=function(url){return/^[^?#]*/.exec(url)[0]};function qs_str(qs){var q=[];for(var k in qs){(Array.isArray(qs[k])?qs[k]:[qs[k]]).forEach(function(v){q.push(encodeURIComponent(k)+"="+encodeURIComponent(v))})}return q.join("&")}E.qs_add=function(url,qs){var u=E.parse(url),q=assign(u.query?E.qs_parse(u.query):{},qs);u.path=u.pathname+"?"+qs_str(q);return E.uri_obj_href(u)};E.qs_parse_url=function(url){return E.qs_parse(url.replace(/(^.*\?)|(^[^\?]*$)/,""))};return E})})();
(function(global){var __hola_stub_define;var is_node_ff=typeof module=="object"&&module.exports;if(!is_node_ff)define=define||self.define;else define=function(name,setup){module.exports=setup()};define("/svc/cdn/pub/typedarray_shim.js",[],function(){var E={};if(is_node_ff||typeof ArrayBuffer!="undefined")return E;var MAX_ARRAY_LENGTH=1e5;function Type(v){switch(typeof v){case"undefined":return"undefined";case"boolean":return"boolean";case"number":return"number";case"string":return"string";default:return v===null?"null":"object"}}function Class(v){return Object.prototype.toString.call(v).replace(/^\[object *|\]$/g,"")}function IsCallable(o){return typeof o==="function"}function ToObject(v){if(v===null||v===undefined)throw TypeError();return Object(v)}function ToInt32(v){return v>>0}function ToUint32(v){return v>>>0}var LN2=Math.LN2,abs=Math.abs,floor=Math.floor,log=Math.log,max=Math.max,min=Math.min,pow=Math.pow,round=Math.round;(function(){var orig=Object.defineProperty;var dom_only=!function(){try{return Object.defineProperty({},"x",{})}catch(_){return false}}();if(!orig||dom_only){Object.defineProperty=function(o,prop,desc){if(orig)try{return orig(o,prop,desc)}catch(_){}if(o!==Object(o))throw TypeError("Object.defineProperty called on non-object");if(Object.prototype.__defineGetter__&&"get"in desc)Object.prototype.__defineGetter__.call(o,prop,desc.get);if(Object.prototype.__defineSetter__&&"set"in desc)Object.prototype.__defineSetter__.call(o,prop,desc.set);if("value"in desc)o[prop]=desc.value;return o}}})();function makeArrayAccessors(obj){if(obj.length>MAX_ARRAY_LENGTH)throw RangeError("Array too large for polyfill");function makeArrayAccessor(index){Object.defineProperty(obj,index,{get:function(){return obj._getter(index)},set:function(v){obj._setter(index,v)},enumerable:true,configurable:false})}var i;for(i=0;i<obj.length;i+=1){makeArrayAccessor(i)}}function as_signed(value,bits){var s=32-bits;return value<<s>>s}function as_unsigned(value,bits){var s=32-bits;return value<<s>>>s}function packI8(n){return[n&255]}function unpackI8(bytes){return as_signed(bytes[0],8)}function packU8(n){return[n&255]}function unpackU8(bytes){return as_unsigned(bytes[0],8)}function packU8Clamped(n){n=round(Number(n));return[n<0?0:n>255?255:n&255]}function packI16(n){return[n&255,n>>8&255]}function unpackI16(bytes){return as_signed(bytes[1]<<8|bytes[0],16)}function packU16(n){return[n&255,n>>8&255]}function unpackU16(bytes){return as_unsigned(bytes[1]<<8|bytes[0],16)}function packI32(n){return[n&255,n>>8&255,n>>16&255,n>>24&255]}function unpackI32(bytes){return as_signed(bytes[3]<<24|bytes[2]<<16|bytes[1]<<8|bytes[0],32)}function packU32(n){return[n&255,n>>8&255,n>>16&255,n>>24&255]}function unpackU32(bytes){return as_unsigned(bytes[3]<<24|bytes[2]<<16|bytes[1]<<8|bytes[0],32)}function packIEEE754(v,ebits,fbits){var bias=(1<<ebits-1)-1;function roundToEven(n){var w=floor(n),f=n-w;if(f<.5)return w;if(f>.5)return w+1;return w%2?w+1:w}var s,e,f;if(v!==v){e=(1<<ebits)-1;f=pow(2,fbits-1);s=0}else if(v===Infinity||v===-Infinity){e=(1<<ebits)-1;f=0;s=v<0?1:0}else if(v===0){e=0;f=0;s=1/v===-Infinity?1:0}else{s=v<0;v=abs(v);if(v>=pow(2,1-bias)){e=min(floor(log(v)/LN2),1023);var significand=v/pow(2,e);if(significand<1){e-=1;significand*=2}if(significand>=2){e+=1;significand/=2}var d=pow(2,fbits);f=roundToEven(significand*d)-d;e+=bias;if(f/d>=1){e+=1;f=0}if(e>2*bias){e=(1<<ebits)-1;f=0}}else{e=0;f=roundToEven(v/pow(2,1-bias-fbits))}}var bits=[],i;for(i=fbits;i;i-=1){bits.push(f%2?1:0);f=floor(f/2)}for(i=ebits;i;i-=1){bits.push(e%2?1:0);e=floor(e/2)}bits.push(s?1:0);bits.reverse();var str=bits.join("");var bytes=[];while(str.length){bytes.unshift(parseInt(str.substring(0,8),2));str=str.substring(8)}return bytes}function unpackIEEE754(bytes,ebits,fbits){var bits=[],i,j,b,str,bias,s,e,f;for(i=0;i<bytes.length;++i){b=bytes[i];for(j=8;j;j-=1){bits.push(b%2?1:0);b=b>>1}}bits.reverse();str=bits.join("");bias=(1<<ebits-1)-1;s=parseInt(str.substring(0,1),2)?-1:1;e=parseInt(str.substring(1,1+ebits),2);f=parseInt(str.substring(1+ebits),2);if(e===(1<<ebits)-1){return f!==0?NaN:s*Infinity}else if(e>0){return s*pow(2,e-bias)*(1+f/pow(2,fbits))}else if(f!==0){return s*pow(2,-(bias-1))*(f/pow(2,fbits))}else{return s<0?-0:0}}function unpackF64(b){return unpackIEEE754(b,11,52)}function packF64(v){return packIEEE754(v,11,52)}function unpackF32(b){return unpackIEEE754(b,8,23)}function packF32(v){return packIEEE754(v,8,23)}(function(){function ArrayBuffer(length){length=ToInt32(length);if(length<0)throw RangeError("ArrayBuffer size is not a small enough positive integer.");Object.defineProperty(this,"byteLength",{value:length});Object.defineProperty(this,"_bytes",{value:Array(length)});for(var i=0;i<length;i+=1)this._bytes[i]=0}global.ArrayBuffer=global.ArrayBuffer||ArrayBuffer;function $TypedArray$(){if(!arguments.length||typeof arguments[0]!=="object"){return function(length){length=ToInt32(length);if(length<0)throw RangeError("length is not a small enough positive integer.");Object.defineProperty(this,"length",{value:length});Object.defineProperty(this,"byteLength",{value:length*this.BYTES_PER_ELEMENT});Object.defineProperty(this,"buffer",{value:new ArrayBuffer(this.byteLength)});Object.defineProperty(this,"byteOffset",{value:0})}.apply(this,arguments)}if(arguments.length>=1&&Type(arguments[0])==="object"&&arguments[0]instanceof $TypedArray$){return function(typedArray){if(this.constructor!==typedArray.constructor)throw TypeError();var byteLength=typedArray.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new ArrayBuffer(byteLength)});Object.defineProperty(this,"byteLength",{value:byteLength});Object.defineProperty(this,"byteOffset",{value:0});Object.defineProperty(this,"length",{value:typedArray.length});for(var i=0;i<this.length;i+=1)this._setter(i,typedArray._getter(i))}.apply(this,arguments)}if(arguments.length>=1&&Type(arguments[0])==="object"&&!(arguments[0]instanceof $TypedArray$)&&!(arguments[0]instanceof ArrayBuffer||Class(arguments[0])==="ArrayBuffer")){return function(array){var byteLength=array.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new ArrayBuffer(byteLength)});Object.defineProperty(this,"byteLength",{value:byteLength});Object.defineProperty(this,"byteOffset",{value:0});Object.defineProperty(this,"length",{value:array.length});for(var i=0;i<this.length;i+=1){var s=array[i];this._setter(i,Number(s))}}.apply(this,arguments)}if(arguments.length>=1&&Type(arguments[0])==="object"&&(arguments[0]instanceof ArrayBuffer||Class(arguments[0])==="ArrayBuffer")){return function(buffer,byteOffset,length){var byteLength;byteOffset=ToUint32(byteOffset);if(byteOffset>buffer.byteLength)throw RangeError("byteOffset out of range");if(byteOffset%this.BYTES_PER_ELEMENT)throw RangeError("buffer length minus the byteOffset is not a multiple of the element size.");if(length===undefined){byteLength=buffer.byteLength-byteOffset;if(byteLength%this.BYTES_PER_ELEMENT)throw RangeError("length of buffer minus byteOffset not a multiple of the element size");length=byteLength/this.BYTES_PER_ELEMENT}else{length=ToUint32(length);byteLength=length*this.BYTES_PER_ELEMENT}if(byteOffset+byteLength>buffer.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:buffer});Object.defineProperty(this,"byteLength",{value:byteLength});Object.defineProperty(this,"byteOffset",{value:byteOffset});Object.defineProperty(this,"length",{value:length})}.apply(this,arguments)}throw TypeError()}Object.defineProperty($TypedArray$,"from",{value:function(iterable){return new this(iterable)}});Object.defineProperty($TypedArray$,"of",{value:function(){return new this(arguments)}});var $TypedArrayPrototype$={};$TypedArray$.prototype=$TypedArrayPrototype$;Object.defineProperty($TypedArray$.prototype,"_getter",{value:function(index){if(arguments.length<1)throw SyntaxError("Not enough arguments");index=ToUint32(index);if(index>=this.length)return undefined;var bytes=[],i,o;for(i=0,o=this.byteOffset+index*this.BYTES_PER_ELEMENT;i<this.BYTES_PER_ELEMENT;i+=1,o+=1){bytes.push(this.buffer._bytes[o])}return this._unpack(bytes)}});Object.defineProperty($TypedArray$.prototype,"get",{value:$TypedArray$.prototype._getter});Object.defineProperty($TypedArray$.prototype,"_setter",{value:function(index,value){if(arguments.length<2)throw SyntaxError("Not enough arguments");index=ToUint32(index);if(index>=this.length)return;var bytes=this._pack(value),i,o;for(i=0,o=this.byteOffset+index*this.BYTES_PER_ELEMENT;i<this.BYTES_PER_ELEMENT;i+=1,o+=1){this.buffer._bytes[o]=bytes[i]}}});Object.defineProperty($TypedArray$.prototype,"constructor",{value:$TypedArray$});Object.defineProperty($TypedArray$.prototype,"copyWithin",{value:function(target,start){var end=arguments[2];var o=ToObject(this);var lenVal=o.length;var len=ToUint32(lenVal);len=max(len,0);var relativeTarget=ToInt32(target);var to;if(relativeTarget<0)to=max(len+relativeTarget,0);else to=min(relativeTarget,len);var relativeStart=ToInt32(start);var from;if(relativeStart<0)from=max(len+relativeStart,0);else from=min(relativeStart,len);var relativeEnd;if(end===undefined)relativeEnd=len;else relativeEnd=ToInt32(end);var final_;if(relativeEnd<0)final_=max(len+relativeEnd,0);else final_=min(relativeEnd,len);var count=min(final_-from,len-to);var direction;if(from<to&&to<from+count){direction=-1;from=from+count-1;to=to+count-1}else{direction=1}while(count>0){o._setter(to,o._getter(from));from=from+direction;to=to+direction;count=count-1}return o}});Object.defineProperty($TypedArray$.prototype,"every",{value:function(callbackfn){if(this===undefined||this===null)throw TypeError();var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();var thisArg=arguments[1];for(var i=0;i<len;i++){if(!callbackfn.call(thisArg,t._getter(i),i,t))return false}return true}});Object.defineProperty($TypedArray$.prototype,"fill",{value:function(value){var start=arguments[1],end=arguments[2];var o=ToObject(this);var lenVal=o.length;var len=ToUint32(lenVal);len=max(len,0);var relativeStart=ToInt32(start);var k;if(relativeStart<0)k=max(len+relativeStart,0);else k=min(relativeStart,len);var relativeEnd;if(end===undefined)relativeEnd=len;else relativeEnd=ToInt32(end);var final_;if(relativeEnd<0)final_=max(len+relativeEnd,0);else final_=min(relativeEnd,len);while(k<final_){o._setter(k,value);k+=1}return o}});Object.defineProperty($TypedArray$.prototype,"filter",{value:function(callbackfn){if(this===undefined||this===null)throw TypeError();var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();var res=[];var thisp=arguments[1];for(var i=0;i<len;i++){var val=t._getter(i);if(callbackfn.call(thisp,val,i,t))res.push(val)}return new this.constructor(res)}});Object.defineProperty($TypedArray$.prototype,"find",{value:function(predicate){var o=ToObject(this);var lenValue=o.length;var len=ToUint32(lenValue);if(!IsCallable(predicate))throw TypeError();var t=arguments.length>1?arguments[1]:undefined;var k=0;while(k<len){var kValue=o._getter(k);var testResult=predicate.call(t,kValue,k,o);if(Boolean(testResult))return kValue;++k}return undefined}});Object.defineProperty($TypedArray$.prototype,"findIndex",{value:function(predicate){var o=ToObject(this);var lenValue=o.length;var len=ToUint32(lenValue);if(!IsCallable(predicate))throw TypeError();var t=arguments.length>1?arguments[1]:undefined;var k=0;while(k<len){var kValue=o._getter(k);var testResult=predicate.call(t,kValue,k,o);if(Boolean(testResult))return k;++k}return-1}});Object.defineProperty($TypedArray$.prototype,"forEach",{value:function(callbackfn){if(this===undefined||this===null)throw TypeError();var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();var thisp=arguments[1];for(var i=0;i<len;i++)callbackfn.call(thisp,t._getter(i),i,t)}});Object.defineProperty($TypedArray$.prototype,"indexOf",{value:function(searchElement){if(this===undefined||this===null)throw TypeError();var t=Object(this);var len=ToUint32(t.length);if(len===0)return-1;var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!==n){n=0}else if(n!==0&&n!==1/0&&n!==-(1/0)){n=(n>0||-1)*floor(abs(n))}}if(n>=len)return-1;var k=n>=0?n:max(len-abs(n),0);for(;k<len;k++){if(t._getter(k)===searchElement){return k}}return-1}});Object.defineProperty($TypedArray$.prototype,"join",{value:function(separator){if(this===undefined||this===null)throw TypeError();var t=Object(this);var len=ToUint32(t.length);var tmp=Array(len);for(var i=0;i<len;++i)tmp[i]=t._getter(i);return tmp.join(separator===undefined?",":separator)}});Object.defineProperty($TypedArray$.prototype,"lastIndexOf",{value:function(searchElement){if(this===undefined||this===null)throw TypeError();var t=Object(this);var len=ToUint32(t.length);if(len===0)return-1;var n=len;if(arguments.length>1){n=Number(arguments[1]);if(n!==n){n=0}else if(n!==0&&n!==1/0&&n!==-(1/0)){n=(n>0||-1)*floor(abs(n))}}var k=n>=0?min(n,len-1):len-abs(n);for(;k>=0;k--){if(t._getter(k)===searchElement)return k}return-1}});Object.defineProperty($TypedArray$.prototype,"map",{value:function(callbackfn){if(this===undefined||this===null)throw TypeError();var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();var res=[];res.length=len;var thisp=arguments[1];for(var i=0;i<len;i++)res[i]=callbackfn.call(thisp,t._getter(i),i,t);return new this.constructor(res)}});Object.defineProperty($TypedArray$.prototype,"reduce",{value:function(callbackfn){if(this===undefined||this===null)throw TypeError();var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();if(len===0&&arguments.length===1)throw TypeError();var k=0;var accumulator;if(arguments.length>=2){accumulator=arguments[1]}else{accumulator=t._getter(k++)}while(k<len){accumulator=callbackfn.call(undefined,accumulator,t._getter(k),k,t);k++}return accumulator}});Object.defineProperty($TypedArray$.prototype,"reduceRight",{value:function(callbackfn){if(this===undefined||this===null)throw TypeError();var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();if(len===0&&arguments.length===1)throw TypeError();var k=len-1;var accumulator;if(arguments.length>=2){accumulator=arguments[1]}else{accumulator=t._getter(k--)}while(k>=0){accumulator=callbackfn.call(undefined,accumulator,t._getter(k),k,t);k--}return accumulator}});Object.defineProperty($TypedArray$.prototype,"reverse",{value:function(){if(this===undefined||this===null)throw TypeError();var t=Object(this);var len=ToUint32(t.length);var half=floor(len/2);for(var i=0,j=len-1;i<half;++i,--j){var tmp=t._getter(i);t._setter(i,t._getter(j));t._setter(j,tmp)}return t}});Object.defineProperty($TypedArray$.prototype,"set",{value:function(index,value){if(arguments.length<1)throw SyntaxError("Not enough arguments");var array,sequence,offset,len,i,s,d,byteOffset,byteLength,tmp;if(typeof arguments[0]==="object"&&arguments[0].constructor===this.constructor){array=arguments[0];offset=ToUint32(arguments[1]);if(offset+array.length>this.length){throw RangeError("Offset plus length of array is out of range")}byteOffset=this.byteOffset+offset*this.BYTES_PER_ELEMENT;byteLength=array.length*this.BYTES_PER_ELEMENT;if(array.buffer===this.buffer){tmp=[];for(i=0,s=array.byteOffset;i<byteLength;i+=1,s+=1){tmp[i]=array.buffer._bytes[s]}for(i=0,d=byteOffset;i<byteLength;i+=1,d+=1){this.buffer._bytes[d]=tmp[i]}}else{for(i=0,s=array.byteOffset,d=byteOffset;i<byteLength;i+=1,s+=1,d+=1){this.buffer._bytes[d]=array.buffer._bytes[s]}}}else if(typeof arguments[0]==="object"&&typeof arguments[0].length!=="undefined"){sequence=arguments[0];len=ToUint32(sequence.length);offset=ToUint32(arguments[1]);if(offset+len>this.length){throw RangeError("Offset plus length of array is out of range")}for(i=0;i<len;i+=1){s=sequence[i];this._setter(offset+i,Number(s))}}else{throw TypeError("Unexpected argument type(s)")}}});Object.defineProperty($TypedArray$.prototype,"slice",{value:function(start,end){var o=ToObject(this);var lenVal=o.length;var len=ToUint32(lenVal);var relativeStart=ToInt32(start);var k=relativeStart<0?max(len+relativeStart,0):min(relativeStart,len);var relativeEnd=end===undefined?len:ToInt32(end);var final_=relativeEnd<0?max(len+relativeEnd,0):min(relativeEnd,len);var count=final_-k;var c=o.constructor;var a=new c(count);var n=0;while(k<final_){var kValue=o._getter(k);a._setter(n,kValue);++k;++n}return a}});Object.defineProperty($TypedArray$.prototype,"some",{value:function(callbackfn){if(this===undefined||this===null)throw TypeError();var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();var thisp=arguments[1];for(var i=0;i<len;i++){if(callbackfn.call(thisp,t._getter(i),i,t)){return true}}return false}});Object.defineProperty($TypedArray$.prototype,"sort",{value:function(comparefn){if(this===undefined||this===null)throw TypeError();var t=Object(this);var len=ToUint32(t.length);var tmp=Array(len);for(var i=0;i<len;++i)tmp[i]=t._getter(i);if(comparefn)tmp.sort(comparefn);else tmp.sort();for(i=0;i<len;++i)t._setter(i,tmp[i]);return t}});Object.defineProperty($TypedArray$.prototype,"subarray",{value:function(start,end){function clamp(v,min,max){return v<min?min:v>max?max:v}start=ToInt32(start);end=ToInt32(end);if(arguments.length<1){start=0}if(arguments.length<2){end=this.length}if(start<0){start=this.length+start}if(end<0){end=this.length+end}start=clamp(start,0,this.length);end=clamp(end,0,this.length);var len=end-start;if(len<0){len=0}return new this.constructor(this.buffer,this.byteOffset+start*this.BYTES_PER_ELEMENT,len)}});function makeTypedArray(elementSize,pack,unpack){var TypedArray=function(){Object.defineProperty(this,"constructor",{value:TypedArray});$TypedArray$.apply(this,arguments);if(0)makeArrayAccessors(this)};if("__proto__"in TypedArray){TypedArray.__proto__=$TypedArray$}else{TypedArray.from=$TypedArray$.from;TypedArray.of=$TypedArray$.of}TypedArray.BYTES_PER_ELEMENT=elementSize;var TypedArrayPrototype=function(){};TypedArrayPrototype.prototype=$TypedArrayPrototype$;TypedArray.prototype=new TypedArrayPrototype;Object.defineProperty(TypedArray.prototype,"BYTES_PER_ELEMENT",{value:elementSize});Object.defineProperty(TypedArray.prototype,"_pack",{value:pack});Object.defineProperty(TypedArray.prototype,"_unpack",{value:unpack});return TypedArray}var Int8Array=makeTypedArray(1,packI8,unpackI8);var Uint8Array=makeTypedArray(1,packU8,unpackU8);var Uint8ClampedArray=makeTypedArray(1,packU8Clamped,unpackU8);var Int16Array=makeTypedArray(2,packI16,unpackI16);var Uint16Array=makeTypedArray(2,packU16,unpackU16);var Int32Array=makeTypedArray(4,packI32,unpackI32);var Uint32Array=makeTypedArray(4,packU32,unpackU32);var Float32Array=makeTypedArray(4,packF32,unpackF32);var Float64Array=makeTypedArray(8,packF64,unpackF64);global.Int8Array=global.Int8Array||Int8Array;global.Uint8Array=global.Uint8Array||Uint8Array;global.Uint8ClampedArray=global.Uint8ClampedArray||Uint8ClampedArray;global.Int16Array=global.Int16Array||Int16Array;global.Uint16Array=global.Uint16Array||Uint16Array;global.Int32Array=global.Int32Array||Int32Array;global.Uint32Array=global.Uint32Array||Uint32Array;global.Float32Array=global.Float32Array||Float32Array;global.Float64Array=global.Float64Array||Float64Array})();(function(){function r(array,index){return IsCallable(array.get)?array.get(index):array[index]}var IS_BIG_ENDIAN=function(){var u16array=new Uint16Array([4660]),u8array=new Uint8Array(u16array.buffer);return r(u8array,0)===18}();function DataView(buffer,byteOffset,byteLength){if(!(buffer instanceof ArrayBuffer||Class(buffer)==="ArrayBuffer"))throw TypeError();byteOffset=ToUint32(byteOffset);if(byteOffset>buffer.byteLength)throw RangeError("byteOffset out of range");if(byteLength===undefined)byteLength=buffer.byteLength-byteOffset;else byteLength=ToUint32(byteLength);if(byteOffset+byteLength>buffer.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:buffer});Object.defineProperty(this,"byteLength",{value:byteLength});Object.defineProperty(this,"byteOffset",{value:byteOffset})}function makeGetter(arrayType){return function GetViewValue(byteOffset,littleEndian){byteOffset=ToUint32(byteOffset);if(byteOffset+arrayType.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");byteOffset+=this.byteOffset;var uint8Array=new Uint8Array(this.buffer,byteOffset,arrayType.BYTES_PER_ELEMENT),bytes=[];for(var i=0;i<arrayType.BYTES_PER_ELEMENT;i+=1)bytes.push(r(uint8Array,i));if(Boolean(littleEndian)===Boolean(IS_BIG_ENDIAN))bytes.reverse();return r(new arrayType(new Uint8Array(bytes).buffer),0)}}Object.defineProperty(DataView.prototype,"getUint8",{value:makeGetter(Uint8Array)});Object.defineProperty(DataView.prototype,"getInt8",{value:makeGetter(Int8Array)});Object.defineProperty(DataView.prototype,"getUint16",{value:makeGetter(Uint16Array)});Object.defineProperty(DataView.prototype,"getInt16",{value:makeGetter(Int16Array)});Object.defineProperty(DataView.prototype,"getUint32",{value:makeGetter(Uint32Array)});Object.defineProperty(DataView.prototype,"getInt32",{value:makeGetter(Int32Array)});Object.defineProperty(DataView.prototype,"getFloat32",{value:makeGetter(Float32Array)});Object.defineProperty(DataView.prototype,"getFloat64",{value:makeGetter(Float64Array)});function makeSetter(arrayType){return function SetViewValue(byteOffset,value,littleEndian){byteOffset=ToUint32(byteOffset);if(byteOffset+arrayType.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");var typeArray=new arrayType([value]),byteArray=new Uint8Array(typeArray.buffer),bytes=[],i,byteView;for(i=0;i<arrayType.BYTES_PER_ELEMENT;i+=1)bytes.push(r(byteArray,i));if(Boolean(littleEndian)===Boolean(IS_BIG_ENDIAN))bytes.reverse();byteView=new Uint8Array(this.buffer,byteOffset,arrayType.BYTES_PER_ELEMENT);byteView.set(bytes)}}Object.defineProperty(DataView.prototype,"setUint8",{value:makeSetter(Uint8Array)});Object.defineProperty(DataView.prototype,"setInt8",{value:makeSetter(Int8Array)});Object.defineProperty(DataView.prototype,"setUint16",{value:makeSetter(Uint16Array)});Object.defineProperty(DataView.prototype,"setInt16",{value:makeSetter(Int16Array)});Object.defineProperty(DataView.prototype,"setUint32",{value:makeSetter(Uint32Array)});Object.defineProperty(DataView.prototype,"setInt32",{value:makeSetter(Int32Array)});Object.defineProperty(DataView.prototype,"setFloat32",{value:makeSetter(Float32Array)});Object.defineProperty(DataView.prototype,"setFloat64",{value:makeSetter(Float64Array)});global.DataView=global.DataView||DataView})();return E})})(this);
if(typeof hola_ldr_require!="undefined")hola_ldr_require.config({map:{events:"/util/events.js"}});define("/svc/cdn/pub/config.js",[],function(){var E={};var b="//"+require.zdot("host");E.swf_urls={videojs:b+require.zdot("videojs"),videojs_osmf:b+require.zdot("videojs_osmf"),videojs_flashls:b+require.zdot("videojs_flashls"),videojs5_osmf:b+require.zdot("videojs5_osmf"),videojs5:b+require.zdot("videojs5"),videojs5_10:b+require.zdot("videojs5_10")};E.css_urls={videojs:b+require.zdot("videojs5_10_css"),hola_skin:b+require.zdot("hola_skin"),thumbnails:b+require.zdot("thumbnails")};return E});require(["/util/es6_shim.js","/svc/cdn/pub/typedarray_shim.js"],function(){});
!function(t,e){"function"==typeof define&&define.amd?define("cash",e):"undefined"!=typeof exports?module.exports=e():t.cash=t.$=e()}(this,function(){function t(t,e){e=e||A;var n=q.test(t)?e.getElementsByClassName(t.slice(1)):W.test(t)?e.getElementsByTagName(t):e.querySelectorAll(t);return n}function e(t){if(!w){w=A.implementation.createHTMLDocument("");var e=w.createElement("base");e.href=A.location.href;try{A.domain&&w.domain!==A.domain&&(w.domain=A.domain)}catch(n){}w.head.appendChild(e)}try{var r;if((r=w.body.childNodes)&&r.length)for(var i=0;i<r.length;i++)w.body.removeChild(r[i])}catch(n){}return w.body.innerHTML=t,w.body.childNodes}function n(t){"loading"!==A.readyState?t():A.addEventListener("DOMContentLoaded",t)}function r(r,i){if(!r)return this;if(r.cash&&r!==S)return r;var o,u=r,s=0;if(k(r))u=R.test(r)?A.getElementById(r.slice(1)):D.test(r)?e(r):t(r,i);else if(P(r))return n(r),this;if(!u)return this;if(u.nodeType||u===S)this[0]=u,this.length=1;else for(o=this.length=u.length;s<o;s++)this[s]=u[s];return this}function i(t,e){return new r(t,e)}function o(t,e){for(var n=t.length,r=0;r<n&&e.call(t[r],t[r],r,t)!==!1;r++);}function u(t,e){var n=t&&(t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector);return!!n&&n.call(t,e)}function s(t){return k(t)?u:t.cash?function(e){return t.is(e)}:function(t,e){return t===e}}function c(t){return i(B.call(t).filter(function(t,e,n){return n.indexOf(t)===e}))}function a(t){return t[_]=t[_]||{}}function f(t,e,n){return a(t)[e]=n}function h(t,e){var n=a(t);return void 0===n[e]&&(n[e]=t.dataset?t.dataset[e]:i(t).attr("data-"+e)),n[e]}function l(t,e){var n=a(t);n?delete n[e]:t.dataset?delete t.dataset[e]:i(t).removeAttr("data-"+name)}function d(t){return k(t)&&t.match(j)}function p(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)}function v(t,e,n){t.classList?t.classList.add(e):n.indexOf(" "+e+" ")&&(t.className+=" "+e)}function m(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(e,"")}function g(t,e){return parseInt(S.getComputedStyle(t[0],null)[e],10)||0}function y(t,e,n){var r=h(t,"_cashEvents")||f(t,"_cashEvents",{});r[e]=r[e]||[],r[e].push(n),t.addEventListener(e,n)}function b(t,e,n){var r,i=h(t,"_cashEvents"),u=i&&i[e];u&&(n?(t.removeEventListener(e,n),r=u.indexOf(n),r>=0&&u.splice(r,1)):(o(u,function(n){t.removeEventListener(e,n)}),u=[]))}function x(t,e){return"&"+encodeURIComponent(t)+"="+encodeURIComponent(e).replace(/%20/g,"+")}function L(t){var e=[];return o(t.options,function(t){t.selected&&e.push(t.value)}),e.length?e:null}function N(t){var e=t.selectedIndex;return e>=0?t.options[e].value:null}function C(t){var e=t.type;if(!e)return null;switch(e.toLowerCase()){case"select-one":return N(t);case"select-multiple":return L(t);case"radio":return t.checked?t.value:null;case"checkbox":return t.checked?t.value:null;default:return t.value?t.value:null}}function E(t,e,n){if(n){var r=t.childNodes[0];t.insertBefore(e,r)}else t.appendChild(e)}function T(t,e,n){var r=k(e);return!r&&e.length?void o(e,function(e){return T(t,e,n)}):void o(t,r?function(t){return t.insertAdjacentHTML(n?"afterbegin":"beforeend",e)}:function(t,r){return E(t,0===r?e:e.cloneNode(!0),n)})}var w,A=document,S=window,M=Array.prototype,B=M.slice,I=M.filter,H=M.push,O=function(){},P=function(t){return typeof t==typeof O&&t.call},k=function(t){return"string"==typeof t},R=/^#[\w-]*$/,q=/^\.[\w-]*$/,D=/<.+>/,W=/^\w+$/,$=i.fn=i.prototype=r.prototype={cash:!0,length:0,push:H,splice:M.splice,map:M.map,init:r};Object.defineProperty($,"constructor",{value:i}),i.parseHTML=e,i.noop=O,i.isFunction=P,i.isString=k,i.extend=$.extend=function(t){t=t||{};var e=B.call(arguments),n=e.length,r=1;for(1===e.length&&(t=this,r=0);r<n;r++)if(e[r])for(var i in e[r])e[r].hasOwnProperty(i)&&(t[i]=e[r][i]);return t},i.extend({merge:function(t,e){for(var n=+e.length,r=t.length,i=0;i<n;r++,i++)t[r]=e[i];return t.length=r,t},each:o,matches:u,unique:c,isArray:Array.isArray,isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}});var _=i.uid="_cash"+Date.now();$.extend({data:function(t,e){if(k(t))return void 0===e?h(this[0],t):this.each(function(n){return f(n,t,e)});for(var n in t)this.data(n,t[n]);return this},removeData:function(t){return this.each(function(e){return l(e,t)})}});var j=/\S+/g;$.extend({addClass:function(t){var e=d(t);return e?this.each(function(t){var n=" "+t.className+" ";o(e,function(e){v(t,e,n)})}):this},attr:function(t,e){if(t){if(k(t))return void 0===e?this[0]?this[0].getAttribute?this[0].getAttribute(t):this[0][t]:void 0:this.each(function(n){n.setAttribute?n.setAttribute(t,e):n[t]=e});for(var n in t)this.attr(n,t[n]);return this}},hasClass:function(t){var e=!1,n=d(t);return n&&n.length&&this.each(function(t){return e=p(t,n[0]),!e}),e},prop:function(t,e){if(k(t))return void 0===e?this[0][t]:this.each(function(n){n[t]=e});for(var n in t)this.prop(n,t[n]);return this},removeAttr:function(t){return this.each(function(e){e.removeAttribute?e.removeAttribute(t):delete e[t]})},removeClass:function(t){if(!arguments.length)return this.attr("class","");var e=d(t);return e?this.each(function(t){o(e,function(e){m(t,e)})}):this},removeProp:function(t){return this.each(function(e){delete e[t]})},toggleClass:function(t,e){if(void 0!==e)return this[e?"addClass":"removeClass"](t);var n=d(t);return n?this.each(function(t){var e=" "+t.className+" ";o(n,function(n){p(t,n)?m(t,n):v(t,n,e)})}):this}}),$.extend({add:function(t,e){return c(i.merge(this,i(t,e)))},each:function(t){return o(this,t),this},eq:function(t){return i(this.get(t))},filter:function(t){if(!t)return this;var e=P(t)?t:s(t);return i(I.call(this,function(n){return e(n,t)}))},first:function(){return this.eq(0)},get:function(t){return void 0===t?B.call(this):t<0?this[t+this.length]:this[t]},index:function(t){var e=t?i(t)[0]:this[0],n=t?this:i(e).parent().children();return B.call(n).indexOf(e)},last:function(){return this.eq(-1)}});var F=function(){var t=/(?:^\w|[A-Z]|\b\w)/g,e=/[\s-_]+/g;return function(n){return n.replace(t,function(t,e){return t[0===e?"toLowerCase":"toUpperCase"]()}).replace(e,"")}}(),U=function(){var t={},e=document,n=e.createElement("div"),r=n.style;return function(e){if(e=F(e),t[e])return t[e];var n=e.charAt(0).toUpperCase()+e.slice(1),i=["webkit","moz","ms","o"],u=(e+" "+i.join(n+" ")+n).split(" ");return o(u,function(n){if(n in r)return t[n]=e=t[e]=n,!1}),t[e]}}();i.prefixedProp=U,i.camelCase=F,$.extend({css:function(t,e){if(k(t))return t=U(t),arguments.length>1?this.each(function(n){return n.style[t]=e}):S.getComputedStyle(this[0])[t];for(var n in t)this.css(n,t[n]);return this}}),o(["Width","Height"],function(t){var e=t.toLowerCase();$[e]=function(){return this[0].getBoundingClientRect()[e]},$["inner"+t]=function(){return this[0]["client"+t]},$["outer"+t]=function(e){return this[0]["offset"+t]+(e?g(this,"margin"+("Width"===t?"Left":"Top"))+g(this,"margin"+("Width"===t?"Right":"Bottom")):0)}}),$.extend({off:function(t,e){return this.each(function(n){return b(n,t,e)})},on:function(t,e,r,i){var o;if(!k(t)){for(var s in t)this.on(s,e,t[s]);return this}return P(e)&&(r=e,e=null),"ready"===t?(n(r),this):(e&&(o=r,r=function(t){for(var n=t.target;!u(n,e);){if(n===this)return n=!1;n=n.parentNode}n&&o.call(n,t)}),this.each(function(e){var n=r;i&&(n=function(){r.apply(this,arguments),b(e,t,n)}),y(e,t,n)}))},one:function(t,e,n){return this.on(t,e,n,!0)},ready:n,trigger:function(t,e){var n=A.createEvent("HTMLEvents");return n.data=e,n.initEvent(t,!0,!1),this.each(function(t){return t.dispatchEvent(n)})}}),$.extend({serialize:function(){var t="";return o(this[0].elements||this,function(e){if(!e.disabled&&"FIELDSET"!==e.tagName){var n=e.name;switch(e.type.toLowerCase()){case"file":case"reset":case"submit":case"button":break;case"select-multiple":var r=C(e);null!==r&&o(r,function(e){t+=x(n,e)});break;default:var i=C(e);null!==i&&(t+=x(n,i))}}}),t.substr(1)},val:function(t){return void 0===t?C(this[0]):this.each(function(e){return e.value=t})}}),$.extend({after:function(t){return i(t).insertAfter(this),this},append:function(t){return T(this,t),this},appendTo:function(t){return T(i(t),this),this},before:function(t){return i(t).insertBefore(this),this},clone:function(){return i(this.map(function(t){return t.cloneNode(!0)}))},empty:function(){return this.html(""),this},html:function(t){if(void 0===t)return this[0].innerHTML;var e=t.nodeType?t[0].outerHTML:t;return this.each(function(t){return t.innerHTML=e})},insertAfter:function(t){var e=this;return i(t).each(function(t,n){var r=t.parentNode,i=t.nextSibling;e.each(function(t){r.insertBefore(0===n?t:t.cloneNode(!0),i)})}),this},insertBefore:function(t){var e=this;return i(t).each(function(t,n){var r=t.parentNode;e.each(function(e){r.insertBefore(0===n?e:e.cloneNode(!0),t)})}),this},prepend:function(t){return T(this,t,!0),this},prependTo:function(t){return T(i(t),this,!0),this},remove:function(){return this.each(function(t){return t.parentNode.removeChild(t)})},text:function(t){return void 0===t?this[0].textContent:this.each(function(e){return e.textContent=t})}});var z=A.documentElement;$.extend({position:function(){var t=this[0];return{left:t.offsetLeft,top:t.offsetTop}},offset:function(){var t=this[0].getBoundingClientRect();return{top:t.top+S.pageYOffset-z.clientTop,left:t.left+S.pageXOffset-z.clientLeft}},offsetParent:function(){return i(this[0].offsetParent)}}),$.extend({children:function(t){var e=[];return this.each(function(t){H.apply(e,t.children)}),e=c(e),t?e.filter(function(e){return u(e,t)}):e},closest:function(t){return!t||this.length<1?i():this.is(t)?this.filter(t):this.parent().closest(t)},is:function(t){if(!t)return!1;var e=!1,n=s(t);return this.each(function(r){return e=n(r,t),!e}),e},find:function(e){if(!e||e.nodeType)return i(e&&this.has(e).length?e:null);var n=[];return this.each(function(r){H.apply(n,t(e,r))}),c(n)},has:function(e){var n=k(e)?function(n){return 0!==t(e,n).length}:function(t){return t.contains(e)};return this.filter(n)},next:function(){return i(this[0].nextElementSibling)},not:function(t){if(!t)return this;var e=s(t);return this.filter(function(n){return!e(n,t)})},parent:function(){var t=[];return this.each(function(e){e&&e.parentNode&&t.push(e.parentNode)}),c(t)},parents:function(t){var e,n=[];return this.each(function(r){for(e=r;e&&e.parentNode&&e!==A.body.parentNode;)e=e.parentNode,(!t||t&&u(e,t))&&n.push(e)}),c(n)},prev:function(){return i(this[0].previousElementSibling)},siblings:function(){var t=this.parent().children(),e=this[0];return t.filter(function(t){return t!==e})}});var z=A.documentElement;return $.extend({jqPosition:function(){var t=this[0];if(t){var e,n,r,o,u=i(t),s={top:0,left:0};if("fixed"===u.css("position"))r=t.getBoundingClientRect();else{for(r=this.offset(),o=t.ownerDocument,e=t.offsetParent||z,n=i(e);e&&(e===o.body||e===z)&&"static"===n.css("position");)e=e.parentNode;e&&e!==t&&1===e.nodeType&&(s=n.offset(),s.top+=parseInt(n.css("borderTopWidth"),10)||0,s.left+=parseInt(n.css("borderLeftWidth"),10)||0)}return{top:r.top-s.top-(parseInt(u.css("marginTop"),10)||0),left:r.left-s.left-(parseInt(u.css("marginLeft"),10)||0)}}}}),i});
(function(){var __hola_stub_define;var is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";if(!is_node&&!is_rn)define=define||self.define;else define=require("./require_node.js").define(module,"../");define("/util/events.js",[],function(){function EventEmitter(){this._events={}}EventEmitter.prototype.listeners=function listeners(name){var events=this._events&&this._events[name]||[];var length=events.length,listeners=[],event;for(var i=0;i<length;event=events[++i])listeners.push(events[i].fn);return listeners};EventEmitter.prototype.emit=function emit(name,a1,a2,a3,a4,a5){if(!this._events||!this._events[name])return false;var listeners=this._events[name],length=listeners.length;var len=arguments.length,event=listeners[0],args,i;if(length===1){switch(len){case 1:event.fn.call(event.context||this);break;case 2:event.fn.call(event.context||this,a1);break;case 3:event.fn.call(event.context||this,a1,a2);break;case 4:event.fn.call(event.context||this,a1,a2,a3);break;case 5:event.fn.call(event.context||this,a1,a2,a3,a4);break;case 6:event.fn.call(event.context||this,a1,a2,a3,a4,a5);break;default:for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];event.fn.apply(event.context||this,args)}if(event.once)remove_listener.apply(this,[name,event])}else{for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];for(i=0;i<length;event=listeners[++i]){event.fn.apply(event.context||this,args);if(event.once)remove_listener.apply(this,[name,event])}}return true};function add_listener(name,fn,opt){opt=opt||{};if(!this._events)this._events={};if(!this._events[name])this._events[name]=[];var event={fn:fn};if(opt.context)event.context=opt.context;if(opt.once)event.once=opt.once;if(opt.prepend)this._events[name].unshift(event);else this._events[name].push(event);return this}function remove_listener(name,listener){if(!this._events||!this._events[name])return this;var listeners=this._events[name],events=[];var is_fn=typeof listener=="function";for(var i=0,length=listeners.length;i<length;i++){if(!listener)continue;if(is_fn&&listeners[i].fn!==listener||!is_fn&&listeners[i]!==listener){events.push(listeners[i])}}if(events.length)this._events[name]=events;else this._events[name]=null;return this}EventEmitter.prototype.on=function on(name,fn,context){return add_listener.apply(this,[name,fn,{context:context}])};EventEmitter.prototype.once=function once(name,fn,context){return add_listener.apply(this,[name,fn,{context:context,once:true}])};EventEmitter.prototype.prependListener=function prependListener(name,fn,context){return add_listener.apply(this,[name,fn,{context:context,prepend:true}])};EventEmitter.prototype.prependOnceListener=function prependOnceListener(name,fn,context){return this.prependListener(name,fn,{context:context,prepend:true,once:true})};EventEmitter.prototype.removeListener=function removeListener(name,fn){return remove_listener.apply(this,[name,fn])};EventEmitter.prototype.removeAllListeners=function removeAllListeners(name){if(!this._events)return this;if(name)this._events[name]=null;else this._events={};return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prototype.setMaxListeners=function setMaxListeners(){return this};EventEmitter.prototype.eventNames=function eventNames(){var _this=this;return Object.keys(this._events).filter(function(e){return _this._events[e]!==null})};EventEmitter.EventEmitter=EventEmitter;EventEmitter.EventEmitter2=EventEmitter;EventEmitter.EventEmitter3=EventEmitter;return EventEmitter})})();
(function(){var __hola_stub_define,process,zerr,assert;var is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";var is_ff_addon=typeof module=="object"&&module.uri&&!module.uri.indexOf("resource://");if(!is_node){if(is_ff_addon)define=require("./require_node.js").define(module,"../");else if(is_rn){define=require("./require_node.js").define(module,"../",require("/util/events.js"),require("/util/array.js"),require("/util/util.js"))}else define=define||self.define;process={nextTick:function(fn){setTimeout(fn,0)},env:{}};if(!is_ff_addon&&!is_rn&&self.hola&&self.hola.zerr)zerr=self.hola.zerr;else{zerr=function(){console.log.apply(console,arguments)};zerr.perr=zerr;zerr.debug=function(){};zerr.is=function(){return false};zerr.L={DEBUG:0}}if(!zerr.is)zerr.is=function(){return false}}else{require("./config.js");process=global.process||require("_process");zerr=require("./zerr.js");assert=require("assert");define=require("./require_node.js").define(module,"../")}if(typeof assert!="function")assert=function(){};define("/util/etask.js",["/util/events.js","/util/array.js","/util/util.js"],function(events,array,zutil){var E=Etask;var etask=Etask;var env=process.env,assign=Object.assign;E.use_bt=+env.ETASK_BT;E.root=[];E.assert_extra=+env.ETASK_ASSERT_EXTRA;E.nextTick=process.nextTick;E.set_zerr=function(_zerr){zerr=_zerr};E.events=new events;var cb_pre,cb_post,cb_ctx,longcb_ms,perf_enable;E.perf_stat={};if(is_rn)E.etask=E;function _cb_pre(et){return{start:Date.now()}}function _cb_post(et,ctx){ctx=ctx||cb_ctx;var ms=Date.now()-ctx.start;if(longcb_ms&&ms>longcb_ms){zerr("long cb "+ms+"ms: "+et.get_name()+", "+et.run_state.f.toString().slice(0,128))}if(perf_enable){var name=et.get_name();var perf=E.perf_stat[name]||(E.perf_stat[name]={ms:0,n:0,max:0});if(perf.max<ms)perf.max=ms;perf.ms+=ms;perf.n++}}function cb_set(){if(longcb_ms||perf_enable){cb_pre=_cb_pre;cb_post=_cb_post;cb_ctx={start:Date.now()}}else cb_pre=cb_post=cb_ctx=undefined}E.longcb=function(ms){longcb_ms=ms;cb_set()};E.perf=function(enable){if(arguments.length){perf_enable=enable;cb_set()}return perf_enable};E.longcb(+env.LONGCB);E.perf(+env.ETASK_PERF);function stack_get(){var prev=Error.stackTraceLimit,err;Error.stackTraceLimit=4;err=new Error;Error.stackTraceLimit=prev;return err}function Etask(opt,states){if(!(this instanceof Etask))return new Etask(opt,states);if(Array.isArray(opt)||typeof opt=="function"){states=opt;opt=undefined}opt=typeof opt=="string"&&{name:opt}||opt||{};if(typeof states=="function"){if(states.constructor.name=="GeneratorFunction")return E._generator(null,states,opt);states=[states]}this.cur_state=this.states=this._finally=this.error=this.at_return=this.next_state=this.use_retval=this.running=this.at_continue=this.cancel=this.wait_timer=this.retval=this.run_state=this._stack=this.down=this.up=this.child=this.name=this._name=this.parent=this.cancelable=this.tm_create=this._alarm=this.tm_completed=this.parent_type=this.info=this.then_waiting=this.free=this.parent_guess=this.child_guess=this.wait_retval=undefined;this.name=opt.name;this._name=this.name===undefined?"noname":this.name;this.cancelable=opt.cancel;this.then_waiting=[];this.child=[];this.child_guess=[];this.cur_state=-1;this.states=[];this._stack=Etask.use_bt?stack_get():undefined;this.tm_create=Date.now();this.info={};var idx=this.states.idx={};for(var i=0;i<states.length;i++){var pstate=states[i],t;if(typeof pstate!="function")assert(0,"invalid state type");t=this._get_func_type(pstate);var state={f:pstate,label:t.label,try_catch:t.try_catch,"catch":t.catch,"finally":t.finally,cancel:t.cancel,sig:undefined};if(i==0&&opt.state0_args){state.f=state.f.bind.apply(state.f,[this].concat(opt.state0_args))}if(state.label)idx[state.label]=i;assert((state.catch||state.try_catch?1:0)+(state.finally?1:0)+(state.cancel?1:0)<=1,"invalid multiple state types");state.sig=state.finally||state.cancel;if(state.finally){assert(this._finally===undefined,"more than 1 finally$");this._finally=i}if(state.cancel){assert(this.cancel===undefined,"more than 1 cancel$");this.cancel=i}this.states[i]=state}var _this=this;E.root.push(this);var in_run=E.in_run_top();if(opt.spawn_parent)this.spawn_parent(opt.spawn_parent);else if(opt.up)opt.up._set_down(this);else if(in_run)this._spawn_parent_guess(in_run);if(opt.init)opt.init.call(this);if(opt.async){var wait_retval=this._set_wait_retval();E.nextTick(function(){if(_this.running!==undefined)return;_this._got_retval(wait_retval)})}else this._next_run();return this}zutil.inherits(Etask,events.EventEmitter);E.prototype._root_remove=function(){assert(!this.parent,"cannot remove from root when has parent");if(!array.rm_elm_tail(E.root,this))assert(0,"etask not in root\n"+E.ps({MARK:this}))};E.prototype._parent_remove=function(){if(this.up){var up=this.up;this.up=this.up.down=undefined;if(up.tm_completed)up._check_free();return}if(this.parent_guess)this._parent_guess_remove();if(!this.parent)return this._root_remove();if(!array.rm_elm_tail(this.parent.child,this)){assert(0,"etask child not in parent\n"+E.ps({MARK:[["child",this],["parent",this.parent]]}))}if(this.parent.tm_completed)this.parent._check_free();this.parent=undefined};E.prototype._check_free=function(){if(this.down||this.child.length)return;this._parent_remove();this.free=true};E.prototype._call_err=function(e){E.ef(e)};E.prototype.emit_safe=function(){try{this.emit.apply(this,arguments)}catch(e){this._call_err(e)}};E.prototype._call_safe=function(state_fn){try{return state_fn.call(this)}catch(e){this._call_err(e)}};E.prototype._complete=function(){if(zerr.is(zerr.L.DEBUG))zerr.debug(this._name+": close");this.tm_completed=Date.now();this.parent_type=this.up?"call":"spawn";if(this.error)this.emit_safe("uncaught",this.error);if(this._finally!==undefined){var ret=this._call_safe(this.states[this._finally].f);if(E.is_err(ret))this._set_retval(ret)}this.emit_safe("finally");this.emit_safe("ensure");if(this.error&&!this.up&&!this.parent&&!this.parent_guess)E.events.emit("uncaught",this);if(this.parent)this.parent.emit("child",this);if(this.up&&(this.down||this.child.length)){var up=this.up;this.up=this.up.down=undefined;this.parent=up;up.child.push(this)}this._check_free();this._del_wait_timer();this.del_alarm();this._ecancel_child();this.emit_safe("finally1");while(this.then_waiting.length)this.then_waiting.shift()()};E.prototype._next=function(rv){if(this.tm_completed)return true;rv=rv||{ret:undefined,err:undefined};var states=this.states;var state=this.at_return?states.length:this.next_state!==undefined?this.next_state:this.cur_state+1;this.retval=rv.ret;this.error=rv.err;if(rv.err!==undefined){if(zerr.on_exception)zerr.on_exception(rv.err);if(this.run_state.try_catch){this.use_retval=true;for(;state<states.length&&states[state].sig;state++);}else for(;state<states.length&&!states[state].catch;state++);}else{for(;state<states.length&&(states[state].sig||states[state].catch);state++);}this.cur_state=state;this.run_state=states[state];this.next_state=undefined;if(this.cur_state<states.length)return false;this._complete();return true};E.prototype._next_run=function(rv){if(this._next(rv))return;this._run()};E.prototype._handle_rv=function(rv){var wait_retval,_this=this,ret=rv.ret;if(ret===this.retval);else if(!ret);else if(ret instanceof Etask){if(!ret.tm_completed){this._set_down(ret);wait_retval=this._set_wait_retval();ret.then_waiting.push(function(){_this._got_retval(wait_retval,E.err_res(ret.error,ret.retval))});return true}rv.err=ret.error;rv.ret=ret.retval}else if(ret instanceof Etask_err){rv.err=ret.error;rv.ret=undefined}else if(typeof ret.then=="function"){wait_retval=this._set_wait_retval();ret.then(function(ret){_this._got_retval(wait_retval,ret)},function(err){_this._got_retval(wait_retval,E.err(err))});return true}else if(typeof ret.next=="function"&&typeof ret.throw=="function"){rv.ret=E._generator(ret,this.states[this.cur_state]);return this._handle_rv(rv)}return false};E.prototype._set_retval=function(ret){if(ret===this.retval&&!this.error);else if(!ret){this.retval=ret;this.error=undefined}else if(ret instanceof Etask){if(ret.tm_completed){this.retval=ret.retval;this.error=ret.error}}else if(ret instanceof Etask_err){this.retval=undefined;this.error=ret.error}else if(typeof ret.then=="function");else if(typeof ret.next=="function"&&typeof ret.throw=="function");else{this.retval=ret;this.error=undefined}return ret};E.prototype._set_wait_retval=function(){return this.wait_retval=new Etask_wait(this,"wait_int")};E.in_run=[];E.in_run_top=function(){return E.in_run[E.in_run.length-1]};E.prototype._run=function(){var rv={ret:undefined,err:undefined};while(1){var cb_ctx;var arg=this.error&&!this.use_retval?this.error:this.retval;this.use_retval=false;this.running=true;rv.ret=rv.err=undefined;E.in_run.push(this);if(zerr.is(zerr.L.DEBUG))zerr.debug(this._name+":S"+this.cur_state+": running");if(cb_pre)cb_ctx=cb_pre(this);try{rv.ret=this.run_state.f.call(this,arg)}catch(e){rv.err=e;if(rv.err instanceof Error)rv.err.etask=this}if(cb_post)cb_post(this,cb_ctx);this.running=false;E.in_run.pop();for(;this.child_guess.length;this.child_guess.pop().parent_guess=undefined);if(rv.ret instanceof Etask_wait){var wait_completed=false,wait=rv.ret;if(!this.at_continue&&!wait.ready){this.wait_retval=wait;if(wait.op=="wait_child")wait_completed=this._set_wait_child(wait);if(wait.timeout)this._set_wait_timer(wait.timeout);if(!wait_completed)return;this.wait_retval=undefined}rv.ret=this.at_continue?this.at_continue.ret:wait.ready&&!wait.completed?wait.ready.ret:undefined;wait.completed=true}this.at_continue=undefined;if(this._handle_rv(rv))return;if(this._next(rv))return}};E.prototype._set_down=function(down){if(this.down)assert(0,"caller already has a down\n"+this.ps());if(down.parent_guess)down._parent_guess_remove();assert(!down.parent,"returned etask already has a spawn parent");assert(!down.up,"returned etask already has a caller parent");down._parent_remove();this.down=down;down.up=this};var func_type_cache={};E.prototype._get_func_type=function(func,on_fail){var name=func.name;var type=func_type_cache[name];if(type)return type;type=func_type_cache[name]={name:undefined,label:undefined,try_catch:undefined,"catch":undefined,"finally":undefined,cancel:undefined};if(!name)return type;type.name=name;var n=name.split("$");if(n.length==1){type.label=n[0];return type}if(n.length>2)return type;if(n[1].length)type.label=n[1];var f=n[0].split("_");for(var j=0;j<f.length;j++){if(f[j]=="try"){type.try_catch=true;if(f[j+1]=="catch")j++}else if(f[j]=="catch")type["catch"]=true;else if(f[j]=="finally"||f[j]=="ensure")type.finally=true;else if(f[j]=="cancel")type.cancel=true;else{return void(on_fail||assert.bind(null,false))("unknown func name "+name)}}return type};E.prototype.spawn=function(child,replace){if(!(child instanceof Etask)&&child&&typeof child.then=="function"){var promise=child;child=etask([function(){return promise}])}if(!(child instanceof Etask)){this.emit("child",child);return}if(!replace&&child.parent)assert(0,"child already has a parent\n"+child.parent.ps());child.spawn_parent(this)};E.prototype._spawn_parent_guess=function(parent){this.parent_guess=parent;parent.child_guess.push(this)};E.prototype._parent_guess_remove=function(){if(!array.rm_elm_tail(this.parent_guess.child_guess,this))assert(0,"etask not in parent_guess\n"+E.ps({MARK:this}));this.parent_guess=undefined};E.prototype.spawn_parent=function(parent){if(this.up)assert(0,"child already has an up\n"+this.up.ps());if(this.tm_completed&&!this.parent)return;this._parent_remove();if(parent&&parent.free)parent=undefined;if(!parent)return void E.root.push(this);parent.child.push(this);this.parent=parent};E.prototype.set_state=function(name){var state=this.states.idx[name];assert(state!==undefined,'named func "'+name+'" not found');return this.next_state=state};E.prototype.finally=function(cb){this.prependListener("finally",cb)};E.prototype.goto_fn=function(name){return this.goto.bind(this,name)};E.prototype.goto=function(name,promise){this.set_state(name);var state=this.states[this.next_state];assert(!state.sig,"goto to sig");return this.continue(promise)};E.prototype.loop=function(promise){this.next_state=this.cur_state;return promise};E.prototype._set_wait_timer=function(timeout){var _this=this;this.wait_timer=setTimeout(function(){_this.wait_timer=undefined;_this._next_run({ret:undefined,err:"timeout"})},timeout)};E.prototype._del_wait_timer=function(){if(this.wait_timer)this.wait_timer=clearTimeout(this.wait_timer);this.wait_retval=undefined};E.prototype._get_child_running=function(from){var i,child=this.child;for(i=from||0;i<child.length&&child[i].tm_completed;i++);return i>=child.length?-1:i};E.prototype._set_wait_child=function(wait_retval){var i,_this=this,child=wait_retval.child;var cond=wait_retval.cond,wait_on;assert(!cond||child=="any",'condition supported only for "any" '+"option, you can add support if needed");if(child=="any"){if(this._get_child_running()<0)return true;wait_on=function(){_this.once("child",function(child){if(!cond||cond.call(child,child.retval))return _this._got_retval(wait_retval,{child:child});if(_this._get_child_running()<0)return _this._got_retval(wait_retval);wait_on()})};wait_on()}else if(child=="all"){if((i=this._get_child_running())<0)return true;wait_on=function(child){_this.once("child",function(child){var i;if((i=_this._get_child_running())<0)return _this._got_retval(wait_retval);wait_on(_this.child[i])})};wait_on(this.child[i])}else{assert(child,"no child provided");assert(this===child.parent,"child does not belong to parent");if(child.tm_completed)return true;child.once("finally",function(){return _this._got_retval(wait_retval,{child:child})})}this.emit_safe("wait_on_child")};E.prototype._got_retval=function(wait_retval,res){if(this.wait_retval!==wait_retval||wait_retval.completed)return;wait_retval.completed=true;if(!this._next(E._res2rv(res)))this._run()};E.prototype.continue_fn=function(){return this.continue.bind(this)};E.continue_depth=0;E.prototype.continue=function(promise,sync){this.wait_retval=undefined;this._set_retval(promise);if(this.tm_completed)return promise;if(this.down)this.down._ecancel();this._del_wait_timer();var rv={ret:promise,err:undefined};if(this.running){this.at_continue=rv;return promise}if(this._handle_rv(rv))return rv.ret;var _this=this;if(E.is_final(promise)&&(!E.continue_depth&&!E.in_run.length||sync)){E.continue_depth++;this._next_run(rv);E.continue_depth--}else E.nextTick(function(){_this._next_run(rv)});return promise};E.prototype._ecancel=function(){if(this.tm_completed)return this;this.emit_safe("cancel");if(this.cancel!==undefined)return this._call_safe(this.states[this.cancel].f);if(this.cancelable)return this.return()};E.prototype._ecancel_child=function(){if(!this.child.length)return;var child=Array.from(this.child);for(var i=0;i<child.length;i++)child[i]._ecancel()};E.prototype.return_fn=function(){return this.return.bind(this)};E.prototype.return=function(promise){if(this.tm_completed)return this._set_retval(promise);this.at_return=true;this.next_state=undefined;return this.continue(promise,true)};E.prototype.del_alarm=function(){var a=this._alarm;if(!a)return;clearTimeout(a.id);if(a.cb)this.removeListener("sig_alarm",a.cb);this._alarm=undefined};E.prototype.alarm_left=function(){var a=this._alarm;if(!a)return 0;return a.start-Date.now()};E.prototype._operation_opt=function(opt){if(opt.goto)return{ret:this.goto(opt.goto,opt.ret)};if(opt.throw)return{ret:this.throw(opt.throw)};if(opt.return!==undefined)return{ret:this.return(opt.return)};if(opt.continue!==undefined)return{ret:this.continue(opt.continue)}};E.prototype.alarm=function(ms,cb){var _this=this,opt,a;if(cb&&typeof cb!="function"){opt=cb;cb=function(){var v;if(!(v=_this._operation_opt(opt)))assert(0,"invalid alarm cb opt");return v.ret}}this.del_alarm();a=this._alarm={ms:ms,cb:cb,start:Date.now()};a.id=setTimeout(function(){_this._alarm=undefined;_this.emit("sig_alarm")},a.ms);if(cb)this.once("sig_alarm",cb)};function Etask_wait(et,op,timeout){this.timeout=timeout;this.et=et;this.op=op;this.child=this.at_child=this.cond=undefined;this.ready=this.completed=undefined}Etask_wait.prototype.continue=function(res){if(this.completed)return;if(!this.et.wait_retval)return void(this.ready={ret:res});if(this!==this.et.wait_retval)return;this.et.continue(res)};Etask_wait.prototype.continue_fn=function(){return this.continue.bind(this)};Etask_wait.prototype.throw=function(err){return this.continue(E.err(err))};Etask_wait.prototype.throw_fn=function(){return this.throw.bind(this)};E.prototype.wait=function(timeout){return new Etask_wait(this,"wait",timeout)};E.prototype.wait_child=function(child,timeout,cond){if(typeof timeout=="function"){cond=timeout;timeout=0}var wait=new Etask_wait(this,"wait_child",timeout);wait.child=child;wait.at_child=null;wait.cond=cond;return wait};E.prototype.throw_fn=function(err){return err?this.throw.bind(this,err):this.throw.bind(this)};E.prototype.throw=function(err){return this.continue(E.err(err))};E.prototype.get_name=function(flags){var stack=this._stack instanceof Error?this._stack.stack.split("\n"):undefined;var caller;flags=flags||{};if(stack){caller=/^    at (.*)$/.exec(stack[4]);caller=caller?caller[1]:undefined}var names=[];if(this.name)names.push(this.name);if(caller&&!(this.name&&flags.SHORT_NAME))names.push(caller);if(!names.length)names.push("noname");return names.join(" ")};E.prototype.state_str=function(){return this.cur_state+(this.next_state?"->"+this.next_state:"")};E.prototype.get_depth=function(){var i=0,et=this;for(;et;et=et.up,i++);return i};function trim_space(s){if(s[s.length-1]!=" ")return s;return s.slice(0,-1)}function ms_to_str(ms){var s=""+ms;return s.length<=3?s+"ms":s.slice(0,-3)+"."+s.slice(-3)+"s"}E.prototype.get_time_passed=function(){return ms_to_str(Date.now()-this.tm_create)};E.prototype.get_time_completed=function(){return ms_to_str(Date.now()-this.tm_completed)};E.prototype.get_info=function(){var info=this.info,s="",_i;if(!info)return"";for(var i in info){_i=info[i];if(!_i)continue;if(s!=="")s+=" ";if(typeof _i=="function")s+=_i();else s+=_i}return trim_space(s)};function Etask_err(err){this.error=err||new Error}E.Etask_err=Etask_err;E.err=function(err){return new Etask_err(err)};E.is_err=function(v){return v instanceof Etask&&v.error!==undefined||v instanceof Etask_err};E.err_res=function(err,res){return err?E.err(err):res};E._res2rv=function(res){return E.is_err(res)?{ret:undefined,err:res.error}:{ret:res,err:undefined}};E.is_final=function(v){return!v||typeof v.then!="function"||v instanceof Etask_err||v instanceof Etask&&!!v.tm_completed};E.prototype.then=function(on_res,on_err){var _this=this;function on_done(){if(!_this.error)return!on_res?_this.retval:on_res(_this.retval);return!on_err?E.err(_this.error):on_err(_this.error)}if(this.tm_completed)return etask("then_completed",[function(){return on_done()}]);var then_wait=etask("then_wait",[function(){return this.wait()}]);this.then_waiting.push(function(){try{then_wait.continue(on_done())}catch(e){then_wait.throw(e)}});return then_wait};E.prototype.otherwise=E.prototype.catch=function(on_err){return this.then(null,on_err)};E.prototype.ensure=function(on_ensure){return this.then(function(res){on_ensure();return res},function(err){on_ensure();throw err})};Etask_err.prototype.then=function(on_res,on_err){var _this=this;return etask("then_err",[function(){return!on_err?E.err(_this.error):on_err(_this.error)}])};Etask_err.prototype.otherwise=Etask_err.prototype.catch=function(on_err){return this.then(null,on_err)};Etask_err.prototype.ensure=function(on_ensure){this.then(null,function(){on_ensure()});return this};E.resolve=function(res){return etask([function(){return res}])};E.reject=function(err){return etask([function(){throw err}])};E.prototype.wait_ext=function(promise){if(!promise||typeof promise.then!="function")return promise;var wait=this.wait();promise.then(wait.continue_fn(),wait.throw_fn());return wait};E.prototype.longname=function(flags){flags=flags||{TIME:1};var s="",_s;if(this.running)s+="RUNNING ";s+=this.get_name(flags)+(!this.tm_completed?"."+this.state_str():"")+" ";if(this.tm_completed)s+="COMPLETED"+(flags.TIME?" "+this.get_time_completed():"")+" ";if(flags.TIME)s+=this.get_time_passed()+" ";if(_s=this.get_info())s+=_s+" ";return trim_space(s)};E.prototype.stack=function(flags){var et=this,s="";flags=assign({STACK:1,RECURSIVE:1,GUESS:1},flags);while(et){var _s=et.longname(flags)+"\n";if(et.up)et=et.up;else if(et.parent){_s=(et.parent_type=="call"?"CALL":"SPAWN")+" "+_s;et=et.parent}else if(et.parent_guess&&flags.GUESS){_s="SPAWN? "+_s;et=et.parent_guess}else et=undefined;if(flags.TOPDOWN)s=_s+s;else s+=_s}return s};E.prototype._ps=function(pre_first,pre_next,flags){var i,s="",task_trail,et=this,child_guess;if(++flags.limit_n>=flags.LIMIT)return flags.limit_n==flags.LIMIT?"\nLIMIT "+flags.LIMIT+"\n":"";for(;et.up;et=et.up);for(var first=1;et;et=et.down,first=0){s+=first?pre_first:pre_next;first=0;if(flags.MARK&&(i=flags.MARK.sp.indexOf(et))>=0)s+=(flags.MARK.name[i]||"***")+" ";s+=et.longname(flags)+"\n";if(flags.RECURSIVE){var stack_trail=et.down?".":" ";var child=et.child;if(flags.GUESS)child=child.concat(et.child_guess);for(i=0;i<child.length;i++){task_trail=i<child.length-1?"|":stack_trail;child_guess=child[i].parent_guess?"\\? ":child[i].parent_type=="call"?"\\> ":"\\_ ";s+=child[i]._ps(pre_next+task_trail+child_guess,pre_next+task_trail+"   ",flags)}}}return s};function ps_flags(flags){var m,_m;if(m=flags.MARK){if(!Array.isArray(m))_m={sp:[m],name:[]};else if(!Array.isArray(flags.MARK[0]))_m={sp:m,name:[]};else{_m={sp:[],name:[]};for(var i=0;i<m.length;i++){_m.name.push(m[i][0]);_m.sp.push(m[i][1])}}flags.MARK=_m}}E.prototype.ps=function(flags){flags=assign({STACK:1,RECURSIVE:1,LIMIT:1e7,TIME:1,GUESS:1},flags,{limit_n:0});ps_flags(flags);return this._ps("","",flags)};E._longname_root=function(){return(zerr.prefix?zerr.prefix+"pid "+process.pid+" ":"")+"root"};E.ps=function(flags){var i,s="",task_trail;flags=assign({STACK:1,RECURSIVE:1,LIMIT:1e7,TIME:1,GUESS:1},flags,{limit_n:0});ps_flags(flags);s+=E._longname_root()+"\n";var child=E.root;if(flags.GUESS){child=[];for(i=0;i<E.root.length;i++){if(!E.root[i].parent_guess)child.push(E.root[i])}}for(i=0;i<child.length;i++){task_trail=i<child.length-1?"|":" ";s+=child[i]._ps(task_trail+"\\_ ",task_trail+"   ",flags)}return s};function assert_tree_unique(a){var i;for(i=0;i<a.length-1;i++)assert(!a.includes(a[i],i+1))}E.prototype._assert_tree=function(opt){var i,et;opt=opt||{};assert_tree_unique(this.child);assert(this.parent);if(this.down){et=this.down;assert(et.up===this);assert(!et.parent);assert(!et.parent_guess);this.down._assert_tree(opt)}for(i=0;i<this.child.length;i++){et=this.child[i];assert(et.parent===this);assert(!et.parent_guess);assert(!et.up);et._assert_tree(opt)}if(this.child_guess.length)assert(E.in_run.includes(this));for(i=0;i<this.child_guess.length;i++){et=this.child_guess[i];assert(et.parent_guess===this);assert(!et.parent);assert(!et.up)}};E._assert_tree=function(opt){var i,et,child=E.root;opt=opt||{};assert_tree_unique(E.root);for(i=0;i<child.length;i++){et=child[i];assert(!et.parent);assert(!et.up);et._assert_tree(opt)}};E.prototype._assert_parent=function(){if(this.up)return assert(!this.parent&&!this.parent_guess);assert(this.parent&&this.parent_guess,"parent_guess together with parent");if(this.parent){var child=this.parent?this.parent.child:E.root;assert(child.includes(this),"cannot find in parent "+(this.parent?"":"root"))}else if(this.parent_guess){assert(this.parent_guess.child_guess.includes(this),"cannot find in parent_guess");assert(E.in_run.includes(this.parent_guess))}};E.prototype.return_child=function(){var child=Array.from(this.child);for(var i=0;i<child.length;i++)child[i].return()};E.sleep=function(ms){var timer;ms=ms||0;return etask({name:"sleep",cancel:true},[function(){this.info.ms=ms+"ms";timer=setTimeout(this.continue_fn(),ms);return this.wait()},function finally$(){clearTimeout(timer)}])};var ebreak_obj={ebreak:1};E.prototype.break=function(ret){return this.throw({ebreak:ebreak_obj,ret:ret})};E.for=function(cond,inc,opt,states){if(Array.isArray(opt)||typeof opt=="function"){states=opt;opt={}}if(typeof states=="function")states=[states];opt=opt||{};return etask({name:"for",cancel:true,init:opt.init_parent},[function loop(){return!cond||cond.call(this)},function try_catch$(res){if(!res)return this.return();return etask({name:"for_iter",cancel:true,init:opt.init},states||[])},function(){if(this.error){if(this.error.ebreak===ebreak_obj)return this.return(this.error.ret);return this.throw(this.error)}return inc&&inc.call(this)},function(){return this.goto("loop")}])};E.for_each=function(obj,states){var keys=Object.keys(obj);var iter={obj:obj,keys:keys,i:0,key:undefined,val:undefined};function init_iter(){this.iter=iter}return E.for(function(){this.iter=this.iter||iter;iter.key=keys[iter.i];iter.val=obj[keys[iter.i]];return iter.i<keys.length},function(){return iter.i++},{init:init_iter,init_parent:init_iter},states)};E.while=function(cond,states){return E.for(cond,null,states)};E.all=function(a_or_o,ao2){var i,j,opt={};if(ao2){opt=a_or_o;a_or_o=ao2}if(Array.isArray(a_or_o)){var a=Array.from(a_or_o);i=0;return etask({name:"all_a",cancel:true},[function(){for(j=0;j<a.length;j++)this.spawn(a[j])},function try_catch$loop(){if(i>=a.length)return this.return(a);this.info.at="at "+i+"/"+a.length;var _a=a[i];if(_a instanceof Etask)_a.spawn_parent();return _a},function(res){if(this.error){if(!opt.allow_fail)return this.throw(this.error);res=E.err(this.error)}a[i]=res;i++;return this.goto("loop")}])}else if(a_or_o instanceof Object){var keys=Object.keys(a_or_o),o={};i=0;return etask({name:"all_o",cancel:true},[function(){for(j=0;j<keys.length;j++)this.spawn(a_or_o[keys[j]])},function try_catch$loop(){if(i>=keys.length)return this.return(o);var _i=keys[i],_a=a_or_o[_i];this.info.at="at "+_i+" "+i+"/"+keys.length;if(_a instanceof Etask)_a.spawn_parent();return _a},function(res){if(this.error){if(!opt.allow_fail)return this.throw(this.error);res=E.err(this.error)}o[keys[i]]=res;i++;return this.goto("loop")}])}else assert(0,"invalid type")};E.all_limit=function(limit,arr_iter,cb){var at=0;var iter=!Array.isArray(arr_iter)?arr_iter:function(){if(at<arr_iter.length)return cb.call(this,arr_iter[at++])};return etask({name:"all_limit",cancel:true},[function(){var next;if(!(next=iter.call(this)))return this.goto("done");this.spawn(next);this.loop();if(this.child.length>=limit)return this.wait_child("any")},function done(){return this.wait_child("all")}])};E._apply=function(opt,func,_this,args){var func_name;if(typeof _this=="string"){assert(_this[0]==".","invalid method "+_this);var method=_this.slice(1),_class=func;func=_class[method];_this=_class;assert(_this instanceof Object,"invalid method ."+method);func_name=method}else if(Array.isArray(_this)&&!args){args=_this;_this=null}opt.name=opt.name||func_name||func.name;return etask(opt,[function(){var et=this,ret_sync,returned=0;args=Array.from(args);args.push(function cb(err,res){if(typeof opt.ret_sync=="string"&&!returned){var a=arguments;returned++;return void E.nextTick(function(){cb.apply(null,a)})}var nfn=opt.nfn===undefined||opt.nfn?1:0;if(opt.ret_o){var o={},i;if(Array.isArray(opt.ret_o)){for(i=0;i<opt.ret_o.length;i++)o[opt.ret_o[i]]=arguments[i+nfn]}else if(typeof opt.ret_o=="string")o[opt.ret_o]=array.slice(arguments,nfn);else assert(0,"invalid opt.ret_o");if(typeof opt.ret_sync=="string")o[opt.ret_sync]=ret_sync;res=o}else if(opt.ret_a)res=array.slice(arguments,nfn);else if(!nfn)res=err;et.continue(nfn?E.err_res(err,res):res)});ret_sync=func.apply(_this,args);if(Array.isArray(opt.ret_sync))opt.ret_sync[0][opt.ret_sync[1]]=ret_sync;returned++;return this.wait()}])};E.nfn_apply=function(opt,func,_this,args){var _opt={nfn:1};if(typeof opt=="function"||typeof func=="string"){args=_this;_this=func;func=opt;opt=_opt}else opt=assign(_opt,opt);return E._apply(opt,func,_this,args)};E.cb_apply=function(opt,func,_this,args){var _opt={nfn:0};if(typeof opt=="function"||typeof func=="string"){args=_this;_this=func;func=opt;opt=_opt}else opt=assign(_opt,opt);return E._apply(opt,func,_this,args)};E.prototype.continue_nfn=function(){return function(err,res){this.continue(E.err_res(err,res))}.bind(this)};E.augment=function(_prototype,method,e_method){var i,opt={};if(method instanceof Object&&!Array.isArray(method)){assign(opt,method);method=arguments[2];e_method=arguments[3]}if(Array.isArray(method)){if(e_method)opt.prefix=e_method;for(i=0;i<method.length;i++)E.augment(_prototype,opt,method[i]);return}opt.prefix=opt.prefix||"e_";if(!e_method)e_method=opt.prefix+method;var fn=_prototype[method];_prototype[e_method]=function(){return etask._apply({name:e_method,nfn:1},fn,this,arguments)}};E.wait=function(timeout){return etask({name:"wait",cancel:true},[function(){return this.wait(timeout)}])};E.to_nfn=function(promise,cb,opt){return etask({name:"to_nfn",async:true},[function try_catch$(){return promise},function(res){var ret=[this.error];if(opt&&opt.ret_a)ret=ret.concat(res);else ret.push(res);cb.apply(null,ret)}])};function etask_fn(opt,states,push_this){if(Array.isArray(opt)||typeof opt=="function"){states=opt;opt=undefined}var is_generator=typeof states=="function"&&states.constructor.name=="GeneratorFunction";return function(){var _opt=assign({},opt);_opt.state0_args=Array.from(arguments);if(push_this)_opt.state0_args.unshift(this);if(is_generator)return E._generator(null,states,_opt);return new Etask(_opt,states)}}E.fn=function(opt,states){return etask_fn(opt,states,false)};E._fn=function(opt,states){return etask_fn(opt,states,true)};E._generator=function(gen,ctor,opt){opt=opt||{};opt.name=opt.name||ctor&&ctor.name||"generator";if(opt.cancel===undefined)opt.cancel=true;var done;return new Etask(opt,[function(){this.generator=gen=gen||ctor.apply(this,opt.state0_args||[]);this.generator_ctor=ctor;return{ret:undefined,err:undefined}},function try_catch$loop(rv){var res;try{res=rv.err?gen.throw(rv.err):gen.next(rv.ret)}catch(e){return this.return(E.err(e))}if(res.done){done=true;return this.return(res.value)}return res.value},function(ret){return this.goto("loop",this.error?{ret:undefined,err:this.error}:{ret:ret,err:undefined})},function finally$(){if(!done&&gen.return)try{gen.return()}catch(e){}}])};E.ef=function(err){if(zerr.on_exception)zerr.on_exception(err);return err};E.interval=function(opt,states){if(typeof opt=="number")opt={ms:opt};if(opt.mode=="fixed"){return E.for(null,function(){return etask.sleep(opt.ms)},states)}if(opt.mode=="smart"||!opt.mode){var now;return E.for(function(){now=Date.now();return true},function(){var delay=zutil.clamp(0,now+opt.ms-Date.now(),Infinity);return etask.sleep(delay)},states)}if(opt.mode=="spawn"){var stopped=false;return etask([function loop(){etask([function try_catch$(){return etask(states)},function(res){if(!this.error)return;if(this.error.ebreak!==ebreak_obj)return this.throw(this.error);stopped=true}])},function(){if(stopped)return this.return();return etask.sleep(opt.ms)},function(){if(stopped)return this.return();return this.goto("loop")}])}throw new Error("unexpected mode "+opt.mode)};return Etask})})();
(function(){var __hola_stub_define;var is_node=typeof module=="object"&&module.exports&&module.children;var is_node_ff=typeof module=="object"&&module.exports;if(!is_node_ff)define=define||self.define;else define=require("./require_node.js").define(module,"../");define("/util/date.js",[],function(){var E=date_get;function pad(num,size){return("000"+num).slice(-size)}E.ms_to_dur=function(_ms){var s="",sec=Math.floor(_ms/1e3);if(sec<0){s+="-";sec=-sec}var days=Math.floor(sec/(60*60*24));sec-=days*60*60*24;var hours=Math.floor(sec/(60*60));sec-=hours*60*60;var mins=Math.floor(sec/60);sec-=mins*60;if(days)s+=days+" "+(days>1?"Days":"Day")+" ";return s+pad(hours,2)+":"+pad(mins,2)+":"+pad(sec,2)};E.dur_to_str=function(dur,opt){opt=opt||{};var parts=[];dur=+dur;function chop(period,name){if(dur<period)return;var number=Math.floor(dur/period);parts.push(number+name);dur-=number*period}chop(ms.YEAR,"y");chop(ms.MONTH,"mo");if(opt.week)chop(ms.WEEK,"w");chop(ms.DAY,"d");chop(ms.HOUR,"h");chop(ms.MIN,"min");chop(ms.SEC,"s");if(dur)parts.push(dur+"ms");if(!parts.length)return"0s";return parts.slice(0,opt.units||parts.length).join(opt.sep||"")};E.monotonic=undefined;E.init=function(){var adjust,last;if(typeof window=="object"&&window.performance&&window.performance.now){adjust=Date.now()-window.performance.now();E.monotonic=function(){return window.performance.now()+adjust}}else if(is_node&&!global.mocha_running){var timer=process.binding("timer_wrap").Timer;adjust=Date.now()-timer.now();E.monotonic=function(){return timer.now()+adjust}}else{last=adjust=0;E.monotonic=function(){var now=Date.now()+adjust;if(now>=last)return last=now;adjust+=last-now;return last}}};E.init();E.str_to_dur=function(str,opt){opt=opt||{};var month="mo|mon|months?";if(opt.short_month)month+="|m";var m=str.replace(/ /g,"").match(new RegExp("^(([0-9]+)y(ears?)?)?"+"(([0-9]+)("+month+"))?(([0-9]+)w(eeks?)?)?(([0-9]+)d(ays?)?)?"+"(([0-9]+)h(ours?)?)?(([0-9]+)(min|minutes?))?"+"(([0-9]+)s(ec|econds?)?)?(([0-9]+)ms(ec)?)?$","i"));if(!m)return;return ms.YEAR*(+m[2]||0)+ms.MONTH*(+m[5]||0)+ms.WEEK*(+m[8]||0)+ms.DAY*(+m[11]||0)+ms.HOUR*(+m[14]||0)+ms.MIN*(+m[17]||0)+ms.SEC*(+m[20]||0)+(+m[23]||0)};E.months_long=["January","February","March","April","May","June","July","August","September","October","November","December"];E.months_short=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var months_short_lc=E.months_short.map(function(m){return m.toLowerCase()});E.days_long=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];E.days_short=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var days_short_lc=E.days_short.map(function(d){return d.toLowerCase()});var days_long_lc=E.days_long.map(function(d){return d.toLowerCase()});E.locale={months_long:E.months_long,months_short:E.months_short,days_long:E.days_long,days_short:E.days_short,AM:"AM",PM:"PM"};E.get=date_get;function date_get(d,_new){var y,mon,day,H,M,S,_ms;if(d===undefined)return new Date;if(d==null)return new Date(null);if(d instanceof Date)return _new?new Date(d):d;if(typeof d=="string"){var m;d=d.trim();if(m=/^((\d\d\d\d)-(\d\d)-(\d\d)|(\d\d?)-([A-Za-z]{3})-(\d\d(\d\d)?))\s*([\sT](\d\d):(\d\d)(:(\d\d)(\.(\d\d\d))?)?Z?)?$/.exec(d)){H=+m[10]||0;M=+m[11]||0;S=+m[13]||0;_ms=+m[15]||0;if(m[2]){y=+m[2];mon=+m[3];day=+m[4];if(!y&&!mon&&!day&&!H&&!M&&!S&&!_ms)return new Date(NaN);return new Date(Date.UTC(y,mon-1,day,H,M,S,_ms))}if(m[5]){y=+m[7];mon=months_short_lc.indexOf(m[6].toLowerCase())+1;day=+m[5];if(m[7].length==2){y=+y;y+=y>=70?1900:2e3}return new Date(Date.UTC(y,mon-1,day,H,M,S,_ms))}}if(/^\d+$/.test(d))return new Date(+d);return new Date(d)}if(typeof d=="number")return new Date(d);throw new TypeError("invalid date "+d)}E.to_sql_ms=function(d){d=E.get(d);if(isNaN(d))return"0000-00-00 00:00:00.000";return pad(d.getUTCFullYear(),4)+"-"+pad(d.getUTCMonth()+1,2)+"-"+pad(d.getUTCDate(),2)+" "+pad(d.getUTCHours(),2)+":"+pad(d.getUTCMinutes(),2)+":"+pad(d.getUTCSeconds(),2)+"."+pad(d.getUTCMilliseconds(),3)};E.to_sql_sec=function(d){return E.to_sql_ms(d).slice(0,-4)};E.to_sql=function(d){return E.to_sql_ms(d).replace(/( 00:00:00)?....$/,"")};E.from_sql=E.get;E.to_month_short=function(d){d=E.get(d);return E.months_short[d.getUTCMonth()]};E.to_month_long=function(d){d=E.get(d);return E.months_long[d.getUTCMonth()]};E.to_jdate=function(d){d=E.get(d);return(pad(d.getUTCDate(),2)+"-"+E.months_short[d.getUTCMonth()]+"-"+pad(d.getUTCFullYear()%100,2)+" "+pad(d.getUTCHours(),2)+":"+pad(d.getUTCMinutes(),2)+":"+pad(d.getUTCSeconds(),2)).replace(/( 00:00)?:00$/,"")};E.to_log_file=function(d){d=E.get(d);return d.getUTCFullYear()+pad(d.getUTCMonth()+1,2)+pad(d.getUTCDate(),2)+"_"+pad(d.getUTCHours(),2)+pad(d.getUTCMinutes(),2)+pad(d.getUTCSeconds(),2)};E.from_log_file=function(d){var m=d.match(/^(\d{4})(\d{2})(\d{2})_(\d{2})(\d{2})(\d{2})$/);if(!m)return;return new Date(Date.UTC(m[1],m[2]-1,m[3],m[4],m[5],m[6]))};E.to_log_ms=function(d){return E.to_sql_ms(d).replace(/-/g,".")};E.from_rcs=function(d){var m=d.match(/^(\d{4})\.(\d{2})\.(\d{2})\.(\d{2})\.(\d{2})\.(\d{2})$/);if(!m)return;return new Date(Date.UTC(m[1],m[2]-1,m[3],m[4],m[5],m[6]))};E.to_rcs=function(d){return E.to_sql_sec(d).replace(/[-: ]/g,".")};E.sec={MS:.001,SEC:1,MIN:60,HOUR:60*60,DAY:24*60*60,WEEK:7*24*60*60,MONTH:30*24*60*60,YEAR:365*24*60*60};E.ms={};for(var key in E.sec)E.ms[key]=E.sec[key]*1e3;var ms=E.ms;E.align=function(d,align){d=E.get(d,1);switch(align.toUpperCase()){case"MS":break;case"SEC":d.setUTCMilliseconds(0);break;case"MIN":d.setUTCSeconds(0,0);break;case"HOUR":d.setUTCMinutes(0,0,0);break;case"DAY":d.setUTCHours(0,0,0,0);break;case"WEEK":d.setUTCDate(d.getUTCDate()-d.getUTCDay());d.setUTCHours(0,0,0,0);break;case"MONTH":d.setUTCDate(1);d.setUTCHours(0,0,0,0);break;case"YEAR":d.setUTCMonth(0,1);d.setUTCHours(0,0,0,0);break;default:throw new Error("invalid align "+align)}return d};E.add=function(d,dur){d=E.get(d,1);if(dur.year)d.setUTCFullYear(d.getUTCFullYear()+dur.year);if(dur.month)d.setUTCMonth(d.getUTCMonth()+dur.month);["day","hour","min","sec","ms"].forEach(function(key){if(dur[key])d.setTime(+d+dur[key]*ms[key.toUpperCase()])});return d};E.describe_interval=function(_ms){return _ms<2*ms.MIN?Math.round(_ms/ms.SEC)+" sec":_ms<2*ms.HOUR?Math.round(_ms/ms.MIN)+" min":_ms<2*ms.DAY?Math.round(_ms/ms.HOUR)+" hours":_ms<2*ms.WEEK?Math.round(_ms/ms.DAY)+" days":_ms<2*ms.MONTH?Math.round(_ms/ms.WEEK)+" weeks":_ms<2*ms.YEAR?Math.round(_ms/ms.MONTH)+" months":Math.round(_ms/ms.YEAR)+" years"};E.time_ago=function(d,until_date){var _ms=E.get(until_date)-E.get(d);if(_ms<ms.SEC)return"right now";return E.describe_interval(_ms)+" ago"};E.ms_to_str=function(_ms){var s=""+_ms;return s.length<=3?s+"ms":s.slice(0,-3)+"."+s.slice(-3)+"s"};E.parse=function(text,opt){opt=opt||{};if(opt.fmt)return E.strptime(text,opt.fmt);var d,a,i,v,_v,dir,_dir,amount,now=opt.now;now=!now?new Date:new Date(now);text=text.replace(/\s+/g," ").trim().toLowerCase();if(!text)return;if(text=="now")return now;if(!isNaN(d=E.get(text)))return d;d=now;a=text.split(" ");dir=a.includes("ago")?-1:a.includes("last")?-1:a.includes("next")?1:undefined;for(i=0;i<a.length;i++){v=a[i];if(/^(ago|last|next)$/.test(v));else if(v=="today")d=E.align(d,"DAY");else if(v=="yesterday")d=E.align(+d-ms.DAY,"DAY");else if(v=="tomorrow")d=E.align(+d+ms.DAY,"DAY");else if((_v=days_short_lc.indexOf(v))>=0)d=new Date(+E.align(d,"WEEK")+_v*ms.DAY+(dir||0)*ms.WEEK);else if((_v=days_long_lc.indexOf(v))>=0)d=new Date(+E.align(d,"WEEK")+_v*ms.DAY+(dir||0)*ms.WEEK);else if(_v=/^([+-]?\d+)(?:([ymoinwdhs]+)(\d.*)?)?$/.exec(v)){if(amount!==undefined)return;amount=dir!==undefined?Math.abs(+_v[1]):+_v[1];if(_v[2]){a.splice(i+1,0,_v[2]);if(_v[3])a.splice(i+2,0,_v[3])}continue}else if(/^([ywdhs]|years?|months?|mon?|weeks?|days?|hours?|minutes?|min|seconds?|sec)$/.test(v)){_v=v[0]=="m"&&v[1]=="i"?ms.MIN:v[0]=="y"?ms.YEAR:v[0]=="m"&&v[1]=="o"?ms.MONTH:v[0]=="w"?ms.WEEK:v[0]=="d"?ms.DAY:v[0]=="h"?ms.HOUR:ms.SEC;amount=amount===undefined?1:amount;_dir=dir===undefined?opt.dir||1:dir;if(_v==ms.MONTH)d.setUTCMonth(d.getUTCMonth()+_dir*amount);else if(_v==ms.YEAR)d.setUTCFullYear(d.getUTCFullYear()+_dir*amount);else d=new Date(+d+_v*amount*_dir);amount=undefined}else return;if(amount!==undefined)return}if(amount!==undefined)return;return d};E.strptime=function(str,fmt){function month(m){return months_short_lc.indexOf(m.toLowerCase())}var parse={"%":["%",function(){},0],a:["[a-z]+",function(m){},0],A:["[a-z]+",function(m){},0],b:["[a-z]+",function(m){d.setUTCMonth(month(m))},2],B:["[a-z]+",function(m){d.setUTCMonth(month(m))},2],y:["[0-9]{2}",function(m){d.setUTCFullYear(+m+(m<70?2e3:1900))},1],Y:["[0-9]{4}",function(m){d.setUTCFullYear(+m)},1],m:["[0-9]{0,2}",function(m){d.setUTCMonth(+m-1)},2],d:["[0-9]{0,2}",function(m){d.setUTCDate(+m)},3],H:["[0-9]{0,2}",function(m){d.setUTCHours(+m)},4],M:["[0-9]{0,2}",function(m){d.setUTCMinutes(+m)},5],S:["[0-9]{0,2}",function(m){d.setUTCSeconds(+m)},6],s:["[0-9]+",function(m){d=new Date(+m)},0],L:["[0-9]{0,3}",function(m){d.setUTCMilliseconds(+m)},7],z:["[+-][0-9]{4}",function(m){var timezone=+m.slice(0,3)*3600+m.slice(3,5)*60;d=new Date(+d-timezone*1e3)},8],Z:["[a-z]{0,3}[+-][0-9]{2}:?[0-9]{2}|[a-z]{1,3}",function(m){m=/^([a-z]{0,3})(?:([+-][0-9]{2}):?([0-9]{2}))?$/i.exec(m);if(m[1]=="Z"||m[1]=="UTC")return;var timezone=+m[2]*3600+m[3]*60;d=new Date(+d-timezone*1e3)},8],I:["[0-9]{0,2}",function(m){d.setUTCHours(+m)},4],p:["AM|PM",function(m){if(d.getUTCHours()==12)d.setUTCHours(d.getUTCHours()-12);if(m.toUpperCase()=="PM")d.setUTCHours(d.getUTCHours()+12)},9]};var ff=[];var ff_idx=[];var re=new RegExp("^\\s*"+fmt.replace(/%(?:([a-zA-Z%]))/g,function(_,fd){var d=parse[fd];if(!d)throw Error("Unknown format descripter: "+fd);ff_idx[d[2]]=ff.length;ff.push(d[1]);return"("+d[0]+")"})+"\\s*$","i");var matched=str.match(re);if(!matched)return;var d=new Date(0);for(var i=0;i<ff_idx.length;i++){var idx=ff_idx[i];var fun=ff[idx];if(fun)fun(matched[idx+1])}return d};var utc_local={local:{getSeconds:function(d){return d.getSeconds()},getMinutes:function(d){return d.getMinutes()},getHours:function(d){return d.getHours()},getDay:function(d){return d.getDay()},getDate:function(d){return d.getDate()},getMonth:function(d){return d.getMonth()},getFullYear:function(d){return d.getFullYear()},getYearBegin:function(d){return new Date(d.getFullYear(),0,1)}},utc:{getSeconds:function(d){return d.getUTCSeconds()},getMinutes:function(d){return d.getUTCMinutes()},getHours:function(d){return d.getUTCHours()},getDay:function(d){return d.getUTCDay()},getDate:function(d){return d.getUTCDate()},getMonth:function(d){return d.getUTCMonth()},getFullYear:function(d){return d.getUTCFullYear()},getYearBegin:function(d){return new Date(Date.UTC(d.getUTCFullYear(),0,1))}}};E.strftime=function(fmt,d,opt){function hours12(hours){return hours==0?12:hours>12?hours-12:hours}function ord_str(n){var i=n%10,ii=n%100;if(ii>=11&&ii<=13||i==0||i>=4)return"th";switch(i){case 1:return"st";case 2:return"nd";case 3:return"rd"}}function week_num(l,d,first_weekday){var wday=l.getDay(d);if(first_weekday=="monday")wday=wday==0?wday=6:wday-1;var yday=(d-l.getYearBegin(d))/ms.DAY;return Math.floor((yday+7-wday)/7)}function padx(n,padding,length){if(typeof padding=="number"){length=padding;padding="0"}if(padding===undefined)padding="0";length=length||2;var s=""+n;if(padding)for(;s.length<length;s=padding+s);return s}opt=opt||{};d=E.get(d);var locale=opt.locale||E.locale;var formats=locale.formats||{};var tz=opt.timezone;var utc=opt.utc!==undefined?opt.utc:opt.local!==undefined?!opt.local:true;if(tz!=null){utc=true;if(typeof tz=="string"){var sign=tz[0]=="-"?-1:1;var hours=parseInt(tz.slice(1,3),10);var mins=parseInt(tz.slice(3,5),10);tz=sign*(60*hours+mins)}if(typeof tz=="number")d=new Date(+d+tz*6e4)}var l=utc?utc_local.utc:utc_local.local;function replace(fmt){return fmt.replace(/%([-_0]?.)/g,function(_,c){var mod,padding,day;if(c.length==2){mod=c[0];if(mod=="-")padding="";else if(mod=="_")padding=" ";else if(mod=="0")padding="0";else return _;c=c[1]}switch(c){case"A":return locale.days_long[l.getDay(d)];case"a":return locale.days_short[l.getDay(d)];case"B":return locale.months_long[l.getMonth(d)];case"b":return locale.months_short[l.getMonth(d)];case"C":return padx(Math.floor(l.getFullYear(d)/100),padding);case"D":return replace(formats.D||"%m/%d/%y");case"d":return padx(l.getDate(d),padding);case"e":return l.getDate(d);case"F":return replace(formats.F||"%Y-%m-%d");case"H":return padx(l.getHours(d),padding);case"h":return locale.months_short[l.getMonth(d)];case"I":return padx(hours12(l.getHours(d)),padding);case"j":day=Math.ceil((+d-l.getYearBegin(d))/(1e3*60*60*24));return pad(day,3);case"k":return padx(l.getHours(d),padding===undefined?" ":padding);case"L":return pad(Math.floor(d.getMilliseconds()),3);case"l":return padx(hours12(l.getHours(d)),padding===undefined?" ":padding);case"M":return padx(l.getMinutes(d),padding);case"m":return padx(l.getMonth(d)+1,padding);case"n":return"\n";case"o":return""+l.getDate(d)+ord_str(l.getDate(d));case"P":return(l.getHours(d)<12?locale.AM:locale.PM).toLowerCase();case"p":return l.getHours(d)<12?locale.AM:locale.PM;case"R":return replace(formats.R||"%H:%M");case"r":return replace(formats.r||"%I:%M:%S %p");case"S":return padx(l.getSeconds(d),padding);case"s":return Math.floor(+d/1e3);case"T":return replace(formats.T||"%H:%M:%S");case"t":return"	";case"U":return padx(week_num(l,d,"sunday"),padding);case"u":day=l.getDay(d);return day==0?7:day;case"v":return replace(formats.v||"%e-%b-%Y");case"W":return padx(week_num(l,d,"monday"),padding);case"w":return l.getDay(d);case"Y":return l.getFullYear(d);case"y":return(""+l.getFullYear(d)).slice(-2);case"Z":if(utc)return"GMT";var tz_string=d.toString().match(/\((\w+)\)/);return tz_string&&tz_string[1]||"";case"z":if(utc)return"+0000";var off=typeof tz=="number"?tz:-d.getTimezoneOffset();return(off<0?"-":"+")+pad(Math.abs(off/60),2)+pad(off%60,2);default:return c}})}return replace(fmt)};E.compile_schedule=function(expr){var re=/^(\d\d?)(?::(\d\d?))?-(\d\d?)(?::(\d\d?))?$/;var parts=expr.split(/\s+/);var intervals=[];for(var i=0;i<parts.length;i++){if(!parts[i])continue;var m=re.exec(parts[i]);if(!m)throw new Error("Schedule syntax error: "+expr);var from=m[1]*ms.HOUR,to=m[3]*ms.HOUR;if(m[2])from+=m[2]*ms.MIN;if(m[4])to+=m[4]*ms.MIN;intervals.push({from:from%ms.DAY,to:to%ms.DAY})}return function(d){var t=E.get(d)%ms.DAY;for(var i=0;i<intervals.length;i++){var interval=intervals[i];if(interval.from<interval.to){if(t>=interval.from&&t<interval.to)return true}else{if(t<interval.to||t>=interval.from)return true}}return false}};return E})})();
(function(){var __hola_stub_define;var is_node_ff=typeof module=="object"&&module.exports;if(!is_node_ff)define=define||self.define;else define=require("./require_node.js").define(module,"../");define("/util/sprintf.js",[],function(){var E=sprintf;E.sprintf=sprintf;var has=Object.prototype.hasOwnProperty;function sprintf(fmt){if(has.call(E.cache,fmt))return E.cache[fmt](arguments);E.cache[fmt]=E.parse(fmt);E.cache_n++;if(E.cache_cb)E.cache_cb(fmt);return E.cache[fmt](arguments)}E.cache={};E.cache_n=0;E.to_int=function(num){return(num=+num)>=0?Math.floor(num):-Math.floor(-num)};E.thousand_grouping=function(num_s){var m=/^([-+])?(\d*)(\.\d*)?$/.exec(num_s);if(!m)return num_s;m[2]=(m[2]||"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+",");return(m[1]||"")+m[2]+(m[3]||"")};E.stringify=function(value,replacer){if(is_array(replacer)){var r={},v;for(var i=0,l=replacer.length;i<l;i++){v=value_of(replacer[i]);if(typeof v=="string"||typeof v=="number")r[v]=true}replacer=r}else if(typeof replacer!="function")replacer=undefined;return _stringify("",{"":value},replacer,[])};function json_escape(str){return JSON.stringify(str)}function _stringify(key,holder,replacer,stack){var value;try{value=holder[key]}catch(e){value="__ERROR__: "+e}if(value&&typeof value=="object"&&typeof value.toJSON=="function")value=value.toJSON(key);if(typeof replacer=="function")value=replacer.call(holder,key,value);value=value_of(value);switch(typeof value){case"boolean":return value?"true":"false";case"string":return json_escape(value);case"number":return Number.isFinite(value)?json_escape(value):"null";case"object":if(value===null)return"null";if(stack.indexOf(value)>=0)return'"__CIRCULAR__"';stack.push(value);var s,a=[],p,ret;if(is_array(value)){for(var i=0,l=value.length;i<l;i++){s=_stringify(""+i,value,replacer,stack);a.push(s==null?"null":s)}ret="["+a.join(",")+"]"}else{for(p in value){if(!has.call(value,p))continue;if(typeof replacer=="object"&&!replacer[p])continue;if((s=_stringify(p,value,replacer,stack))!=null)a.push(json_escape(p)+":"+s)}ret="{"+a.join(",")+"}"}stack.pop();return ret;default:return undefined}}function value_of(v){return typeof v=="object"&&(v instanceof Number||v instanceof String||v instanceof Boolean)?v.valueOf():v}function is_array(a){return Object.prototype.toString.call(a)=="[object Array]"}function stringify(value){try{return JSON.stringify(value)}catch(e){return E.stringify(value)}}E.parse_fast=function(fmt){var _fmt=fmt,match=[],arg_names=0,cursor=1;var pad_chr,pad_chrs,arg_padded,f,s=stringify;f='var out = "", arg, arg_s, sign;\n';for(;_fmt;_fmt=_fmt.substring(match[0].length)){if(match=/^[^%]+/.exec(_fmt))f+="out += "+s(match[0])+";\n";else if(match=/^%%/.exec(_fmt))f+='out += "%";\n';else if(match=/^%(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?(')?([bcdefoOsuxX])/.exec(_fmt)){var positional=match[1],keyword=match[2],sign=match[3];var pad_zero=match[4],pad_min=match[5],pad_max=match[6];var precision=match[7],thousand_grouping=match[8]=="'";var conversion=match[9],keyword_list=[];if(keyword){arg_names|=1;var _keyword=keyword,kmatch;if(!(kmatch=/^([a-z_][a-z_\d]*)/i.exec(_keyword)))throw"sprintf: invalid keyword property name "+_keyword;keyword_list.push(kmatch[1]);while(_keyword=_keyword.substring(kmatch[0].length)){if(kmatch=/^\.([a-z_][a-z_\d]*)/i.exec(_keyword))keyword_list.push(kmatch[1]);else if(kmatch=/^\[(\d+)\]/.exec(_keyword))keyword_list.push(kmatch[1]);else throw"sprintf: invalid keyword format "+_keyword}}else arg_names|=2;if(arg_names===3){throw"sprintf: mixing positional and named placeholders is "+"not (yet) supported"}f+="sign = false;\n";if(keyword_list.length){f+="arg = argv["+cursor+"]";for(var k=0;k<keyword_list.length;k++)f+="["+s(keyword_list[k])+"]";f+=";\n"}else if(positional)f+="arg = argv["+positional+"];\n";else f+="arg = argv["+cursor++ +"];\n";if(/[^sO]/.test(conversion))f+="arg = +arg;\n";switch(conversion){case"b":f+="arg_s = arg.toString(2);\n";break;case"c":f+="arg_s = String.fromCharCode(arg);\n";break;case"d":f+='arg = sprintf.to_int(arg); arg_s = ""+arg;\n';if(thousand_grouping)f+="arg_s = sprintf.thousand_grouping(arg_s);\n";break;case"e":f+="arg_s = arg.toExponential("+(precision?s(precision):"")+");\n";break;case"f":if(precision)f+="arg_s = arg.toFixed("+precision+");\n";else f+='arg_s = ""+arg;\n';if(thousand_grouping)f+="arg_s = sprintf.thousand_grouping(arg_s);\n";break;case"o":f+="arg_s = arg.toString(8);\n";break;case"O":f+="arg_s = stringify(arg);\n";break;case"u":f+='arg = arg >>> 0; arg_s = ""+arg;\n';break;case"x":f+="arg_s = arg.toString(16);\n";break;case"X":f+="arg_s = arg.toString(16).toUpperCase();\n";break;case"s":f+='arg_s = ""+arg;\n';if(precision)f+="arg_s = arg_s.substring(0, "+precision+");\n";break}if(/[def]/.test(conversion)){if(sign)f+='if (arg>=0) arg_s = "+"+arg_s;\n';f+='sign = arg_s[0]=="-" || arg_s[0]=="+";\n'}pad_chr=!pad_zero?" ":pad_zero=="0"?"0":pad_zero[1];pad_chrs=s(pad_chr)+".repeat(Math.max("+ +pad_max+"-arg_s.length, 0))";arg_padded=!pad_max?"arg_s":pad_min?"arg_s+"+pad_chrs:/[def]/.test(conversion)&&pad_chr=="0"?"(sign ? arg_s[0]+"+pad_chrs+"+arg_s.slice(1) : "+pad_chrs+"+arg_s)":pad_chrs+"+arg_s";f+="out += "+arg_padded+";\n"}else throw"sprintf invalid format "+_fmt}f+="return out;\n";return new Function(["sprintf","stringify","argv"],f).bind(null,sprintf,stringify)};E.parse_slow=function(fmt){var _fmt=fmt,match=[],arg_names=0,cursor=1;var _f=[],out,arg,arg_s,argv,sign;function f(fn){_f.push(fn)}for(;_fmt;_fmt=_fmt.substring(match[0].length))(function(){if(match=/^[^%]+/.exec(_fmt)){var _match=match;f(function(){return out+=_match[0]})}else if(match=/^%%/.exec(_fmt))f(function(){return out+="%"});else if(match=/^%(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?(')?([bcdefoOsuxX])/.exec(_fmt)){var positional=match[1],keyword=match[2],sign=match[3];var pad_zero=match[4],pad_min=match[5],pad_max=match[6];var precision=match[7],thousand_grouping=match[8]=="'";var conversion=match[9],keyword_list=[],_cursor=cursor;if(keyword){arg_names|=1;var _keyword=keyword,kmatch;if(!(kmatch=/^([a-z_][a-z_\d]*)/i.exec(_keyword)))throw"sprintf: invalid keyword property name "+_keyword;keyword_list.push(kmatch[1]);while(_keyword=_keyword.substring(kmatch[0].length)){if(kmatch=/^\.([a-z_][a-z_\d]*)/i.exec(_keyword))keyword_list.push(kmatch[1]);else if(kmatch=/^\[(\d+)\]/.exec(_keyword))keyword_list.push(kmatch[1]);else throw"sprintf: invalid keyword format "+_keyword}}else arg_names|=2;if(arg_names===3){throw"sprintf: mixing positional and named placeholders is "+"not (yet) supported"}f(function(){sign=false});if(keyword_list.length){f(function(){arg=argv[_cursor];for(var k=0;k<keyword_list.length&&arg!=null;k++)arg=arg[keyword_list[k]]})}else if(positional)f(function(){arg=argv[positional]});else{f(function(){arg=argv[_cursor]});cursor++}if(/[^sO]/.test(conversion))f(function(){return arg=+arg});switch(conversion){case"b":f(function(){arg_s=arg.toString(2)});break;case"c":f(function(){arg_s=String.fromCharCode(arg)});break;case"d":f(function(){arg=sprintf.to_int(arg);arg_s=""+arg});if(thousand_grouping)f(function(){arg_s=sprintf.thousand_grouping(arg_s)});break;case"e":f(function(){arg_s=arg.toExponential(precision?precision:undefined)});break;case"f":if(precision)f(function(){arg_s=arg.toFixed(precision)});else f(function(){arg_s=""+arg});if(thousand_grouping)f(function(){arg_s=sprintf.thousand_grouping(arg_s)});break;case"o":f(function(){arg_s=arg.toString(8)});break;case"O":f(function(){arg_s=stringify(arg)});break;case"u":f(function(){arg=arg>>>0;arg_s=""+arg});break;case"x":f(function(){arg_s=arg.toString(16)});break;case"X":f(function(){arg_s=arg.toString(16).toUpperCase()});break;case"s":f(function(){arg_s=""+arg});if(precision)f(function(){arg_s=arg_s.substring(0,precision)});break}if(/[def]/.test(conversion)){if(sign)f(function(){if(arg>=0)arg_s="+"+arg_s});f(function(){sign=arg_s[0]=="-"||arg_s[0]=="+"})}var pad_chr=!pad_zero?" ":pad_zero=="0"?"0":pad_zero[1];f(function(){var pad_chrs=pad_chr.repeat(Math.max(+pad_max-arg_s.length,0));var arg_padded=!pad_max?arg_s:pad_min?arg_s+pad_chrs:sign&&pad_chr[0]=="0"?arg_s[0]+pad_chrs+arg_s.slice(1):pad_chrs+arg_s;out+=arg_padded})}else throw"sprintf invalid format "+_fmt})();return function(_argv){argv=_argv;out="";for(var i=0;i<_f.length;i++)_f[i](argv);return out}};E.parse=function(){try{if(new Function("return 1")()==1)return E.parse_fast}catch(e){}return E.parse_slow}();E.vsprintf=function(fmt,argv,opt){if(opt){if(opt.fast)return E.parse_fast(fmt)([fmt].concat(argv));if(opt.slow)return E.parse_slow(fmt)([fmt].concat(argv))}return E.sprintf.apply(null,[fmt].concat(argv))};return E})})();
(function(){var __hola_stub_define;var is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";if(!is_node&&!is_rn)define=define||self.define;else define=require("./require_node.js").define(module,"../");define("/util/rate_limit.js",[],function(){var E=rate_limit;function rate_limit(rl,ms,n){var now=Date.now();if(!rl.count||rl.ts+ms<now){rl.count=1;rl.ts=now;return true}rl.count++;return rl.count<=n}E.leaky_bucket=function leaky_bucket(size,rate){this.size=size;this.rate=rate;this.time=Date.now();this.level=0};E.leaky_bucket.prototype.inc=function(inc){if(inc===undefined)inc=1;var now=Date.now();this.level-=this.rate*(now-this.time);this.time=now;if(this.level<0)this.level=0;var new_level=this.level+inc;if(new_level>this.size)return false;this.level=new_level;return true};return E})})();
(function(){var __hola_stub_define;var is_node_ff=typeof module=="object"&&module.exports;if(!is_node_ff)define=define||self.define;else define=require("./require_node.js").define(module,"../");define("/util/escape.js",[],function(){var E={};E.un={};var html_escape_table={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};E.html=function(html){return html.replace(/[&<>"']/g,function(m){return html_escape_table[m[0]]})};E.sh=function(s_or_a){function single(s){s=""+s;if(!s)return'""';if(/^[a-z0-9_\-.\/:]+$/i.test(s))return s;return'"'+s.replace(/([\\"`$])/g,"\\$1")+'"'}if(arguments.length==1&&!Array.isArray(s_or_a))return single(s_or_a);var s="",a=Array.isArray(s_or_a)?s_or_a:arguments;for(var i=0;i<a.length;i++)s+=(i?" ":"")+single(a[i]);return s};E.un_sh=function(s,keep_esc){var state={PARSE_STATE_INIT:0,PARSE_STATE_NORMAL_ARG:1,PARSE_STATE_QUOTE_ARG:2},cur_state=state.PARSE_STATE_INIT;var i,quote=0,argv=[],a="";for(i=0;i<s.length;i++){var esc=0;a+=s[i];if(s[i]=="\\"&&s[1]){if(!keep_esc)a=a.slice(0,-1);esc=1;i++;a+=s[i]}switch(cur_state){case state.PARSE_STATE_INIT:switch(s[i]){case"\r":case"\n":case" ":case"	":if(!esc){a="";break}case'"':case"'":if(!esc){cur_state=state.PARSE_STATE_QUOTE_ARG;if(!keep_esc)a=a.slice(0,-1);quote=s[i];break}default:cur_state=state.PARSE_STATE_NORMAL_ARG}break;case state.PARSE_STATE_NORMAL_ARG:switch(s[i]){case"\r":case"\n":case" ":case"	":if(!esc){cur_state=state.PARSE_STATE_INIT;a=a.slice(0,-1);argv.push(a);a=""}break;case'"':case"'":if(!esc){cur_state=state.PARSE_STATE_QUOTE_ARG;quote=s[i];if(!keep_esc)a=a.slice(0,-1)}break}break;case state.PARSE_STATE_QUOTE_ARG:if(s[i]==quote&&!esc){cur_state=state.PARSE_STATE_NORMAL_ARG;if(!keep_esc)a=a.slice(0,-1)}break}}if(cur_state==state.PARSE_STATE_NORMAL_ARG){cur_state=state.PARSE_STATE_INIT;argv.push(a)}if(cur_state!=state.PARSE_STATE_INIT)throw"error parsing shell";return argv};E.regex=function(s){return s.replace(/[[\]{}()*+?.\\^$|\/]/g,"\\$&")};E.uri_comp=function(s){return encodeURIComponent(s).replace(/%20/g,"+")};var http_escape_chars=[];(function(){var i;for(i=0;i<256;i++){var c=String.fromCharCode(i);http_escape_chars[i]=/^[a-zA-Z0-9_.~,\-]$/.test(c)?c:"%"+("0"+i.toString(16)).slice(-2)}})();E.encodeURIComponent_bin=function(s_or_b){var s=Buffer&&s_or_b instanceof Buffer?s_or_b.toString("binary"):""+s_or_b;var esc="";for(var i=0;i<s.length;i++)esc+=http_escape_chars[s.charCodeAt(i)];return esc};E.qs=function(param,opt){opt=opt||{};var qs=opt.qs||"";var sep=qs||opt.amp?"&":"";if(!param)return qs;var uri_comp=opt.space_plus===undefined||opt.space_plus?E.uri_comp:encodeURIComponent;var uri_comp_val=opt.bin?E.encodeURIComponent_bin:uri_comp;for(var i in param){var val=param[i];if(val===undefined)continue;var key=uri_comp(i);qs+=sep;if(val===null)qs+=key;else if(Array.isArray(val)){if(!val.length)continue;qs+=val.map(function(val){return key+"="+uri_comp_val(val)}).join("&")}else qs+=key+"="+uri_comp_val(val);sep="&"}return qs};E.uri=function(uri,qs,hash){var opt;if(typeof uri=="string")opt={uri:uri,_qs:qs,hash:hash};else{opt=Object.assign({},uri);opt._qs=opt.qs;opt.qs=undefined}uri=opt.uri;qs=typeof opt._qs=="string"?opt._qs:E.qs(opt._qs,opt);hash=typeof opt.hash=="string"?opt.hash:E.qs(opt.hash,opt);if(qs){if(!uri.includes("?"))uri+="?";else if(uri[uri.length-1]!="?"&&uri[uri.length-1]!="&")uri+="&"}else qs="";if(hash)hash="#"+hash;else hash="";return uri+qs+hash};E.mailto_url=function(mail){return"mailto:"+(mail.to||"")+"?"+E.qs({cc:mail.cc,bcc:mail.bcc,subject:mail.subject,body:mail.body},{space_plus:false})};E.parse={};E.parse.eat_token=function(s_obj,re){var match;if(!(match=re.exec(s_obj.s)))return match;s_obj.s=s_obj.s.substr(match.index+match[0].length);return match};E.parse.http_words=function(val){var res=[],o={s:val},eat_token=E.parse.eat_token,match;while(o.s){if(match=eat_token(o,/^\s*(=*[^\s=;,]+)/)){var v=match[1];if(match=eat_token(o,/^\s*=\s*\"([^\"\\]*(?:\\.[^\"\\]*)*)\"/))res.push([v,match[1].replace(/\\(.)/,"$1")]);else if(match=eat_token(o,/^\s*=\s*([^;,\s]*)/))res.push([v,match[1].replace(/\s+$/,"")]);else res.push([v,null])}else if(match=eat_token(o,/^\s*,/));else if((match=eat_token(o,/^\s*;/))||(match=eat_token(o,/^\s+/)));else throw new Error("This should not happen: "+o.s)}return res};return E})})();
(function(){var __hola_stub_define,process;var is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";var is_ff_addon=typeof module=="object"&&module.uri&&!module.uri.indexOf("resource://");if(is_rn){define=require("./require_node.js").define(module,"../",require("/util/array.js"),require("/util/date.js"),require("/util/util.js"),require("/util/sprintf.js"),require("/util/rate_limit.js"),require("/util/escape.js"));process={nextTick:function(fn){setTimeout(fn,0)},env:{}}}else if(!is_node&&!is_ff_addon){define=define||self.define;process={env:{}}}else{define=require("./require_node.js").define(module,"../");if(is_ff_addon)process={env:{}};else if(is_node){process=global.process||require("_process");require("./config.js");var cluster=require("cluster");var version=require("./version.js").version}}define("/util/zerr.js",["/util/array.js","/util/date.js","/util/util.js","/util/sprintf.js","/util/rate_limit.js","/util/escape.js"],function(array,date,zutil,sprintf,rate_limit,zescape){var E,_zerr;var env=process.env;var zerr=function(msg){_zerr(L.ERR,arguments)};E=zerr;E.zerr=zerr;var L=E.L={EMERG:0,ALERT:1,CRIT:2,ERR:3,WARN:4,NOTICE:5,INFO:6,DEBUG:7};var perr_pending=[];var LINV=E.LINV={};for(var k in L)LINV[L[k]]=k;["debug","info","notice","warn","err","crit"].forEach(function(l){var level=L[l.toUpperCase()];E[l]=function(){return _zerr(level,arguments)}});E.assert=function(exp,msg){if(!exp)zerr.crit(msg)};E.json=function(o,replacer,space){try{return JSON.stringify(o,replacer,space)||""}catch(e){return"[circular]"}};E.is=function(level){return level<=E.level};["debug","info","notice","warn","err"].forEach(function(l){var level=L[l.toUpperCase()];E.is[l]=function(){return level<=E.level}});E.log_tail=function(size){return(E.log||[]).join("\n").substr(-(size||4096))};E.perr=function(id,info,opt){E._zerr(!opt||opt.level===undefined?L.ERR:opt.level,["perr "+id+" "+E.json(info)]);if(perr_pending&&perr_pending.length<100)perr_pending.push(Array.from(arguments))};var perr_hooks=[];E.add_perr_hook=perr_hooks.push.bind(perr_hooks);var perr_dropped={};var perr_orig=E.perr;function wrap_perr(perr_fn){var send=perr_fn,pre_send;if(typeof perr_fn!="function"){send=perr_fn.send;pre_send=perr_fn.pre_send}return function(id,info,opt){opt=opt||{};var _rate_limit=opt.rate_limit||{};var ms=_rate_limit.ms||date.ms.HOUR,count=_rate_limit.count||10;var disable_drop_count=_rate_limit.disable_drop_count;var rl_hash=perr_orig.rl_hash=perr_orig.rl_hash||{};var rl=rl_hash[id]=rl_hash[id]||{};if(pre_send)pre_send(id,info,opt);perr_hooks.filter(function(h){return h.ids.test(id)}).forEach(function(h){h.fn(id,info,opt)});if(opt.rate_limit===false||rate_limit(rl,ms,count)){if(perr_dropped[id]){if(!disable_drop_count&&info&&typeof info!="string")info.w=perr_dropped[id];perr_dropped[id]=null}return send(id,info,opt)}perr_dropped[id]=(perr_dropped[id]||0)+1;if(info&&typeof info!="string")info=zerr.json(info);zerr("perr %s %s rate too high %s %d %d",id,info,zerr.json(rl),ms,count)}}E.perr_install=function(install_fn){E.perr=wrap_perr(install_fn(perr_orig,perr_pending||[]));perr_pending=null};function err_has_stack(err){return err instanceof Error&&err.stack}E.e2s=function(err){if(!is_node&&err_has_stack(err)){var e_str=""+err,e_stack=""+err.stack;return e_stack.startsWith(e_str)?e_stack:e_str+" "+e_stack}return err_has_stack(err)?""+err.stack:""+err};E.on_exception=undefined;var in_exception;E.set_exception_handler=function(prefix,err_func){E.on_exception=function(err){if(!(err instanceof TypeError||err instanceof ReferenceError)||err.sent_perr){return}if(in_exception)return;in_exception=1;err.sent_perr=true;err_func((prefix?prefix+"_":"")+"etask_typeerror",null,err);in_exception=0}};E.on_unhandled_exception=undefined;E.catch_unhandled_exception=function(func,obj){return function(){var args=arguments;try{return func.apply(obj,Array.from(args))}catch(e){E.on_unhandled_exception(e)}}};E.set_level=function(level){var prev="L"+LINV[E.level];level=level||env.ZERR;if(!level)return prev;var val=L[level]||L[level.replace(/^L/,"")];if(val!==undefined)E.level=val;return prev};if(is_node){E.ZEXIT_LOG_DIR="/tmp/zexit_logs";E.prefix="";E.level=L.NOTICE;E.flush=function(){};E.set_log_buffer=function(on){if(!on){if(E.log_buffer){E.flush();E.log_buffer(0)}return}E.log_buffer=require("log-buffer");E.log_buffer(32*1024);E.flush=function(){E.log_buffer.flush()};setInterval(E.flush,1e3).unref()};var node_init=function(){if(zutil.is_mocha())E.level=L.WARN;else E.prefix=!cluster.isMaster?"C"+cluster.worker.id+" ":""};var init=function(){if(is_node)node_init();E.set_level()};init();var zerr_format=function(args){return args.length<=1?args[0]:sprintf.apply(null,args)};var __zerr=function(level,args){var msg=zerr_format(args);var k=Object.keys(L);var prefix=E.hide_timestamp?"":E.prefix+date.to_sql_ms()+" ";console.error(prefix+k[level]+": "+msg)};E.set_logger=function(logger){__zerr=function(level,args){var msg=zerr_format(args);logger(level,msg)}};_zerr=function(level,args){if(level>E.level)return;__zerr(level,args)};E._zerr=_zerr;E.zexit=function(args){var stack;if(err_has_stack(args)){stack=args.stack;__zerr(L.CRIT,[E.e2s(args)])}else{var e=new Error;stack=e.stack;__zerr(L.CRIT,arguments);console.error(stack)}E.flush();if(process.zon&&process.zon.main){var LCRIT=2;var LCONSOLE=256;var emb_zutil=process.binding("zutil");emb_zutil.zerr(LCRIT|LCONSOLE,"perr node_zexit "+E.e2s(args));process.exit(1)}if(env.NODE_ENV=="production"){var conf=require("./conf.js");var zcounter_file=require("./zcounter_file.js");zcounter_file.inc("server_zexit");args=zerr_format(arguments);write_zexit_log({id:"lerr_server_zexit",info:""+args,ts:date.to_sql(),backtrace:stack,version:version,app:conf.app});E.flush()}debugger;process.exit(1)};var write_zexit_log=function(json){try{var file=require("./file.js");file.mkdirp(E.ZEXIT_LOG_DIR);file.write_atomic_e(E.ZEXIT_LOG_DIR+"/"+date.to_log_file()+"_zexit_"+process.pid+".log",E.json(json))}catch(e){E.zerr(E.e2s(e))}}}else{var chrome;E.log=[];var L_STR=E.L_STR=["EMERGENCY","ALERT","CRITICAL","ERROR","WARNING","NOTICE","INFO","DEBUG"];E.log.max_size=200;if(is_rn){E.level=L.WARN;E.hide_timestamp=true}else{chrome=self.chrome;E.conf=self.conf;E.level=self.is_tpopup?L.CRITICAL:E.conf&&E.conf.zerr_level?L[self.conf.zerr_level]:L.WARN}var console_method=function(l){if(is_rn)return l<=L.NOTICE?"log":l<=L.INFO?"info":"debug";return l<=L.ERR?"error":!chrome?"log":l===L.WARN?"warn":l<=L.INFO?"info":"debug"};_zerr=function(l,args){var s;try{var fmt=""+args[0];var fmt_args=Array.prototype.slice.call(args,1);s=(fmt+(fmt_args.length?" "+E.json(fmt_args):"")).substr(0,1024);var prefix=(E.hide_timestamp?"":date.to_sql_ms()+" ")+L_STR[l]+": ";E.log.push(prefix+s);if(E.is(l)){Function.prototype.apply.bind(console[console_method(l)],console)([prefix+fmt].concat(fmt_args))}if(E.log.length>E.log.max_size)E.log.splice(0,E.log.length-E.log.max_size/2)}catch(err){try{console.error("ERROR in zerr "+(err.stack||err),arguments)}catch(e){}}if(l<=L.CRIT)throw new Error(s)};E._zerr=_zerr;var post=function(url,data){var use_xdr=typeof XDomainRequest=="function"&&!("withCredentials"in XMLHttpRequest.prototype);var req=use_xdr?new XDomainRequest:new XMLHttpRequest;req.open("POST",url);if(req.setRequestHeader){req.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}req.send(zescape.qs(data));return req};var perr_transport=function(id,info,opt){opt=zutil.clone(opt||{});var qs=opt.qs||{},data=opt.data||{};data.is_json=1;if(info&&typeof info!="string")info=zerr.json(info);if(opt.err&&!info)info=""+(opt.err.message||zerr.json(opt.err));data.info=info;qs.id=id;if(!opt.no_zerr){zerr._zerr(opt.level,["perr "+id+(info?" info: "+info:"")+(opt.bt?"\n"+opt.bt:"")])}return post(zescape.uri(E.conf.url_perr+"/perr",qs),data)};var perr=function(perr_orig,pending){while(pending.length)perr_transport.apply(null,pending.shift());return perr_transport};E.perr_install(perr)}return E})})();
(function(){var __hola_stub_define;var is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node)define=define||self.define;else define=require("./require_node.js").define(module,"../");define("/util/ajax_lite.js",["/util/etask.js","/util/date.js","/util/zerr.js","/util/escape.js","events"],function(etask,date,zerr,zescape,events){var E=ajax;var assign=Object.assign;E.json=function(opt){return ajax(assign({},opt,{data_type:"json"}))};E.events=new events.EventEmitter;E.t={};E.t.get_origin=get_origin;E.t.get_url_origin=get_url_origin;E.t.is_current_origin=is_current_origin;var raw_default_opt={method:"GET",url:null,headers:null,data_type:"text",data:null,qs:null,timeout:20*date.ms.SEC,with_credentials:false,return_headers:false};var ajax_default_opt={slow:2*date.ms.SEC,perr:null};var type_helpers={text:{setup:function(xhr){if(xhr instanceof XMLHttpRequest){xhr.setRequestHeader("Accept","text/*");xhr.responseType="text"}},extract:function(xhr){return xhr.responseText}},json:{setup:function(xhr){if(xhr instanceof XMLHttpRequest){xhr.setRequestHeader("Accept","application/json");xhr.responseType="text"}},extract:function(xhr){return JSON.parse(xhr.responseText)}}};function get_origin(location){if(location.origin)return location.origin;var default_ports={"http:":80,"https:":443};var port=location.port;if(default_ports[location.protocol]==port)port=null;return location.protocol+"//"+location.hostname+(port?":"+port:"")}var probe_link;function get_url_origin(url){probe_link=probe_link||document.createElement("a");probe_link.href=url;probe_link.href=probe_link.href;return get_origin(probe_link)}function is_current_origin(url){return is_node?false:window.location.origin==get_url_origin(url)}var can_use_xdr=typeof XDomainRequest=="function"&&!("withCredentials"in XMLHttpRequest.prototype);E.raw=function(opt){return etask([function(){opt=assign({},raw_default_opt,opt);var type_helper=type_helpers[opt.data_type];if(!type_helper){throw{status:null,status_text:"Unknown data_type "+opt.data_type,response_text:null}}var req=can_use_xdr&&!is_current_origin(opt.url)?new XDomainRequest:new XMLHttpRequest;var url=zescape.uri(opt.url,opt.qs);var wait=this.wait();if(opt.timeout){this.alarm(opt.timeout,function(){req.abort();wait.throw({status:null,status_text:"timeout",response_text:null})})}req.open(opt.method,url);type_helper.setup(req);if(opt.headers&&req.setRequestHeader){for(var header in opt.headers)req.setRequestHeader(header,opt.headers[header])}if(opt.with_credentials&&"withCredentials"in req)req.withCredentials=true;req.onload=function(){var status=req.status||200;if(status==1223)status=204;if(status>=200&&status<300){var res=type_helper.extract(req);if(opt.return_headers){return wait.continue({res:res,headers:req.getAllResponseHeaders?req.getAllResponseHeaders():""})}return wait.continue(res)}return wait.throw({status:status,status_text:req.statusText,response_text:req.responseText})};req.onerror=function(){wait.throw({status:req.status,status_text:req.statusText,response_text:req.responseText})};this.finally(function(){req.onload=req.onerror=null});var data=opt.data;if(data!=null){switch(typeof data){case"object":data=zescape.qs(data);break;case"string":data=zescape.uri_comp(data);break;default:data=data+""}if(req.setRequestHeader){req.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}}req.send(data);return wait}])};function ajax(opt){opt=assign({},raw_default_opt,ajax_default_opt,opt);var t0=Date.now();var url=zescape.uri(opt.url,opt.qs);zerr.debug("ajax("+opt.data_type+") url "+url);return etask([function(){return E.raw(opt)},function catch$(err){zerr.err("ajax("+opt.data_type+") failed url "+url+" data "+zerr.json(opt.data).substr(0,200)+" status: "+err.status+" "+err.status_text+"\nresponseText: "+(err.response_text||"").substr(0,200));if(err.status_text=="timeout")E.events.emit("timeout",this);throw err},function(response){var t=Date.now()-t0,slow=t>opt.slow;zerr[slow?"err":"debug"]("ajax("+opt.data_type+") "+(slow?"SLOW ":"ok ")+t+"ms url "+url);if(slow&&opt.perr)opt.perr({id:"be_ajax_slow",info:t+"ms "+url});return response}])}return E})})();
!function(e){if("function"==typeof define&&define.amd)define("cookie",e);else if("object"==typeof exports)module.exports=e();else{var n=window.Cookies,o=window.Cookies=e();o.noConflict=function(){return window.Cookies=n,o}}}(function(){function e(){for(var e=0,n={};e<arguments.length;e++){var o=arguments[e];for(var t in o)n[t]=o[t]}return n}function n(o){function t(n,i,r){var c;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(r=e({path:"/"},t.defaults,r)).expires){var s=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*r.expires),r.expires=s}try{c=JSON.stringify(i),/^[\{\[]/.test(c)&&(i=c)}catch(e){}return i=o.write?o.write(i,n):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),n=encodeURIComponent(String(n)),n=n.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),n=n.replace(/[\(\)]/g,escape),document.cookie=[n,"=",i,r.expires&&"; expires="+r.expires.toUTCString(),r.path&&"; path="+r.path,r.domain&&"; domain="+r.domain,r.secure?"; secure":""].join("")}n||(c={});for(var a=document.cookie?document.cookie.split("; "):[],p=/(%[0-9A-Z]{2})+/g,d=0;d<a.length;d++){var f=a[d].split("="),u=f[0].replace(p,decodeURIComponent),l=f.slice(1).join("=");'"'===l.charAt(0)&&(l=l.slice(1,-1));try{if(l=o.read?o.read(l,u):o(l,u)||l.replace(p,decodeURIComponent),this.json)try{l=JSON.parse(l)}catch(e){}if(n===u){c=l;break}n||(c[u]=l)}catch(e){}}return c}}return t.set=t,t.get=function(e){return t(e)},t.getJSON=function(){return t.apply({json:!0},[].slice.call(arguments))},t.defaults={},t.remove=function(n,o){t(n,"",e(o,{expires:-1}))},t.withConverter=n,t}return n(function(){})});
(function(){var __hola_stub_define;var is_node=typeof module=="object"&&module.exports;if(!is_node)define=define||self.define;else define=function(){};define("/util/storage.js",["cookie"],function(cookie){var E={};var storage;function have_local_storage(){try{var _=localStorage;if(_.length)return true;_.setItem("_",0);_.removeItem("_");return true}catch(e){}}function select_local_storage(){storage=localStorage}function select_cookies(domain){var cookie_opt={domain:"."+domain,path:"/",expires:30};storage={getItem:cookie.get,setItem:function(key,val){cookie.set(key,val,cookie_opt)},removeItem:function(key){cookie.remove(key,cookie_opt)}}}E.init=function(domain){if(have_local_storage())return select_local_storage();console.error("cannot use localStorage, using cookies instead");select_cookies(domain||"hola.org")};E.init();E.on_err=function(){};E.set=function(key,val){try{storage.setItem(key,val)}catch(err){E.on_err("storage_set",key,err)}};E.get=function(key){try{return storage.getItem(key)}catch(err){E.on_err("storage_get",key,err)}};E.get_int=function(key){return+E.get(key)||0};E.clr=function(key){try{storage.removeItem(key)}catch(err){E.on_err("storage_clr",key,err)}};E.set_json=function(key,val){try{return E.set(key,JSON.stringify(val||null))}catch(err){E.on_err("storage_set_json",key,err)}};E.get_json=function(key){var val=E.get(key);if(!val)return val;try{val=JSON.parse(val)}catch(err){console.log("err "+err)}return val};return E})})();
(function(){var __hola_stub_define;var is_node_ff=typeof module=="object"&&module.exports;if(!is_node_ff)define=define||self.define;else define=function(setup){module.exports=setup()};define("/util/user_agent.js",[],function(){var E={};var win_versions={"10.0":"10.0",6.3:"8.1",6.2:"8",6.1:"7","6.0":"vista",5.2:"2003",5.1:"xp","5.0":"2000"};var arch_mapping={x86_64:"64",i686:"32",arm:"arm"};var check_hola=/\bhola_android\b/i;var check_android_cdn=/Android.* CDNService\/([0-9\.]+)$/;var check_ios_cdn=/ CDNService\/([0-9\.]+)$/;var check_hola_player_app=/ (Spark|Hola)Player/;var check_opera=/\bOPR\b\/(\d+)/i;var check_edge=/\bEdge\b\/(\d+)/i;var check_xbox=/\bxbox\b/i;var check_ucbrowser=/\bUCBrowser\b\/(\d+)/i;var check_webview=/ Version\/(\d+)(\.\d)/;var is_browser=!is_node_ff&&typeof window!="undefined";function ios_ua(ua,safari_ver){var res;if(res=/(?:iPhone|iPad|iPod|iPod touch);.*?OS ([\d._]+)/.exec(ua)){var ios_ver=res[1];var is_chrome=/CriOS/.test(ua);var is_firefox=/FxiOS/.test(ua);var is_hola_ios=is_browser&&(window.hola_cdn_sdk||window.spark_ios_sdk)||check_ios_cdn.test(ua);var ucbrowser_ver=(check_ucbrowser.exec(ua)||[])[1];var is_ucbrowser=!!ucbrowser_ver;return{browser:"safari",version:safari_ver||ios_ver,ios:ios_ver,hola_ios:is_hola_ios,chrome:is_chrome,firefox:is_firefox,ucbrowser:is_ucbrowser,ucbrowser_version:ucbrowser_ver,webview:/Twitter/.test(ua)?"twitter":/GSA\/\d+/.test(ua)?"googlesearch":/FBAV\/\d+/.test(ua)?"facebook":!safari_ver&&!is_chrome&&!is_firefox&&!is_ucbrowser&&!is_hola_ios}}if(/HolaCDN iOS/.exec(ua))return{browser:"safari",hola_ios:true}}function check_chromium(ua){if(check_webview.test(ua)||/Android/.test(ua)||/ Mobile /.test(ua)||check_opera.test(ua)){return false}var group="(?: (\\w*)\\/)?",ver="\\/[\\d\\.]+";var res=new RegExp("AppleWebKit"+ver+"(?: \\(.*\\))?"+group+".* Chrome"+ver+group+".* Safari"+ver+group).exec(ua);return res&&(res[1]||res[2]||res[3])}E.guess_browser=function(ua){var res;ua=ua||(is_browser?window.navigator&&navigator.userAgent:"");if(res=/\bOpera Mini\/(\d+)/.exec(ua))return{browser:"opera_mini",version:res[1]};var ucbrowser=check_ucbrowser.exec(ua);if(res=/[( ]MSIE ([6789]|10).\d[);]/.exec(ua))return{browser:"ie",version:res[1],xbox:check_xbox.test(ua)};if(res=/[( ]Trident\/\d+(\.\d)+.*rv:(\d\d)(\.\d)+[);]/.exec(ua))return{browser:"ie",version:res[2],xbox:check_xbox.test(ua)};if(res=/ Chrome\/(\d+)(\.\d+)+.* Safari\/\d+(\.\d+)+/.exec(ua)){var opera=check_opera.exec(ua);var edge;if(edge=check_edge.exec(ua))return{browser:"edge",version:edge[1]};return{browser:"chrome",version:res[1],android:ua.match(/Android/),webview:ua.match(check_webview),hola_android:check_hola.test(ua),hola_app:check_android_cdn.test(ua),hola_player_app:check_hola_player_app.test(ua),chromium_based:check_chromium(ua),opera:opera&&!!opera[1],opera_version:opera?opera[1]:undefined,ucbrowser:ucbrowser&&!!ucbrowser[1],ucbrowser_version:ucbrowser?ucbrowser[1]:undefined,webos_app:/Web0S/.test(ua),samsung_browser:/SamsungBrowser/.test(ua)}}if(res=/ QupZilla\/(\d+\.\d+\.\d+).* Safari\/\d+.\d+/.exec(ua))return{browser:"qupzilla",version:res[1]};if(res=/\(PlayStation (\d+) (\d+\.\d+)\).* AppleWebKit\/\d+.\d+/.exec(ua)){return{browser:"playstation"+res[1],version:res[2]}}if(res=/\(SMART-TV; Linux; Tizen ([0-9.]+)\) AppleWebkit\//.exec(ua))return{browser:"samsung_tizen",version:res[1]};if(res=/ Version\/(\d+)(\.\d)+.* Safari\/\d+.\d+/.exec(ua)){if(!ua.match(/Android/))return ios_ua(ua,res[1])||{browser:"safari",version:res[1]};return{browser:"chrome",version:res[1],android:true,webview:true,hola_android:check_hola.test(ua),hola_app:check_android_cdn.test(ua),hola_player_app:check_hola_player_app.test(ua),ucbrowser:ucbrowser&&!!ucbrowser[1],ucbrowser_version:ucbrowser?ucbrowser[1]:undefined,samsung_browser:/SamsungBrowser/.test(ua)}}if(res=/ (Firefox|PaleMoon)\/(\d+).\d/.exec(ua)){return{browser:"firefox",version:res[2],palemoon:res[1]=="PaleMoon"}}if(/Hola\/\d+\.\d+.*?(?:iPhone|iPad|iPod)/.exec(ua))return{browser:"safari",version:"Hola"};if(res=ios_ua(ua))return res;return{}};E.browser_to_string=function(browser){if(typeof browser!="object"||!browser.browser)return"unknown";var s=browser.browser=="ie"&&browser.version>11?"edge":browser.browser;if(browser.version)s+=" "+browser.version;if(browser.chrome)s+=" chrome";if(browser.firefox)s+=" firefox";if(browser.xbox)s+=" xbox";if(browser.android)s+=" android";if(browser.webview){s+=" webview";if(typeof browser.webview=="string")s+="-"+browser.webview}if(browser.chromium_based)s+=" chromium_based";if(browser.samsung_browser)s+=" samsung";if(browser.opera){s+=" opera";if(browser.opera_version)s+="-"+browser.opera_version}if(browser.hola_android)s+=" hola_android";if(browser.hola_app)s+=" hola_app";if(browser.hola_player_app)s+=" hola_player_app";if(browser.ucbrowser){s+=" ucbrowser";if(browser.ucbrowser_version)s+="-"+browser.ucbrowser_version}if(browser.palemoon)s+=" palemoon";if(browser.ios)s+=" ios";if(browser.webos_app)s+=" webos_app";return s?s:"unknown"};E.guess=function(ua,platform){var res;ua=ua||(is_browser?navigator.userAgent:"");platform=platform||(is_browser?navigator.platform:"");if(check_xbox.exec(ua))return{os:"xbox",mobile:false};if(res=/Windows(?: NT(?: (.*?))?)?[);]/.exec(ua)){return{os:"windows",version:win_versions[res[1]],release_version:res[1],arch:ua.match(/WOW64|Win64|x64/)?"64":"32",mobile:false}}if(/Windows Phone/.exec(ua))return{os:"winphone",mobile:true};if(res=/Macintosh.*; (?:Intel|PPC) Mac OS X (\d+[._]\d+)/.exec(ua))return{os:"macos",version:res[1].replace("_","."),mobile:false};if(/Macintosh/.exec(ua))return{os:"macos",mobile:false};if(/Web0S.*SmartTV/.exec(ua)){return{os:"webos",version:/Chrome/.test(ua)?"3":"2",mobile:false,tv:true}}if(res=/(Android|Andr0id)(?: (\d+\.\d+))?/.exec(ua))return{os:"android",version:res[2],mobile:true};if(res=/(Linux|CrOS|OpenBSD|FreeBSD)(?: (x86_64|i686|arm))?/.exec(ua)){if(check_opera.test(ua)&&res[1]=="Linux"&&res[2]=="x86_64"&&/^Linux arm/.test(platform)){return{os:"android",mobile:true}}return{os:res[1].toLowerCase(),arch:arch_mapping[res[2]],nix:true,mobile:false}}if(res=/(?:iPhone|iPad|iPod|iPod touch);.*?OS (\d+[._]\d+)/.exec(ua))return{os:"ios",version:res[1].replace("_","."),mobile:true};if(/iPhone|iPad|iPod|HolaCDN iOS/.exec(ua))return{os:"ios",mobile:true};if(/PLAYSTATION/.exec(ua))return{os:"ps",mobile:false};if(/HitLeap Viewer/.exec(ua))return{os:"windows",mobile:false};return{}};E.guess_device=function(ua){var res;ua=ua||(is_browser?navigator.userAgent:"");if(res=/(iPhone|iPad|iPod)/.exec(ua))return{device:res[1].toLowerCase()};return{}};E.support_fullscreen=function(){return!!(is_browser&&typeof document!="undefined"&&(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled))};E.support_hover=function(){if(!is_browser)return false;if(window.matchMedia&&window.matchMedia("(hover: hover)").matches)return true;return!E.guess().mobile};return E})})();
(function(){var __hola_stub_define,is_node=typeof module=="object"&&module.exports;if(!is_node)define=define||self.define;else define=require("../../../util/require_node.js").define(module,"../");define("/svc/cdn/pub/log.js",["/util/storage.js","/util/date.js","/util/array.js","/util/util.js","/util/zerr.js","/util/etask.js","/util/sprintf.js"],function(storage,date,array,zutil,zerr,etask,sprintf){var E=log_cdn;var assign=Object.assign;E.type="cdn";zerr.set_exception_handler("cdn",function(id,info,err){E.err("exception "+id+" "+(err.stack||err));E.perr({id:id,info:""+err,bt:err.stack})});etask.set_zerr(zerr);function log_cdn(){var s;var opt={};try{var args=[].slice.call(arguments);if(typeof args[args.length-1]=="object")opt=args.pop();s=args.length>1?sprintf.apply(null,args):args[0];log(opt.type||E.type,s,opt);if(opt.perr_id&&E.perr)E.perr({id:opt.perr_id,info:s})}catch(e){console.error("error in log_cdn",opt.type||E.type,s,e);if(E.perr)E.perr({id:"log_cdn_err",info:s,bt:e.stack})}}function extend_opt(def_opt){if(def_opt.muted)return;var args=[].slice.call(arguments,1);var opt={};if(typeof args[args.length-1]=="object")opt=assign({},args.pop());log_cdn.apply(this,args.concat(assign(opt,def_opt)))}var log_levels={no:0,crit:1,err:2,warn:3,notice:4,info:5,debug:6};function log_level_handler(opt,level){var level_opt=level=="console"?{console_log:true,level:"info"}:{level:level};return extend_opt.bind(E,assign({},opt,level_opt))}function Journal(opt){if(!(this instanceof Journal))return new Journal(opt);opt=opt||{logs:[]};opt.type=opt.type||E.type;assign(this,{crit:log_level_handler(opt,"crit"),err:log_level_handler(opt,"err"),warn:log_level_handler(opt,"warn"),notice:log_level_handler(opt,"notice"),info:log_level_handler(opt,"info"),debug:log_level_handler(opt,"debug"),console:log_level_handler(opt,"console"),set_type:function(type){return new Journal(assign({},opt,{type:type}))},set_module:function(module){return new Journal(assign({},opt,{module:module,type:opt.type}))},reset_module:function(){return this.set_module(null)},mute:function(){return new Journal(assign({},opt,{muted:true}))},unmute:function(){return new Journal(assign({},opt,{muted:false}))},get_logs:function(raw){return raw?opt.logs:opt.logs.map(function(l){return l&&l.msg||l})},reset_logs:function(){opt.logs.splice(0,opt.logs.length)},logs_to_str:function(logs,full_log){return E.logs_to_str(logs||opt.logs)},concat:function(logs,need_sort){return E.concat_logs(opt.logs,logs,need_sort)},fork:function(id){return new Journal(assign({},opt,{id:id,logs:opt.logs.slice()}))},stash:function(){var stash=opt.logs.slice();return function(){zutil.clone_inplace(opt.logs,stash)}},uninit:function(){this.reset_logs()}})}assign(E,new Journal);E.settings_def=function(){return{log_level:"notice",max_size:2048,max_full_history_size:8192}};E.settings=E.settings_def();E.init=function(opt){E.settings=assign({},E.settings_def(),zutil.clone_deep(opt),storage.get_json("hola_log_settings"))};E.set=function(o,no_storage){if(!no_storage)storage.set_json("hola_log_settings",o);E.settings=assign({},E.settings_def(),zutil.clone_deep(o))};E.reset=function(clear_storage){E.set(E.settings_def(),true);storage.clr("hola_log_settings");E.console("log reset to defaults, customer settings to be re-applied "+"after page reload")};E.log_is=function(level){return log_levels[E.settings.log_level]>=log_levels[level]};E.full_history=[];E.get_full_history=function(types,modules){return E.filter_logs(E.full_history,types,modules).map(function(l){return l.msg})};E.get_player_logs=function(){var set_level=log_levels[E.settings.log_level||"notice"];return E.filter_logs(E.full_history,"player").filter(function(l){return l.level<=Math.max(log_levels.info,set_level)}).map(function(l){return l.msg})};function pad(num,size){return E.zmocha_pad||("000"+num).slice(-size)}function log(type,s,opt){opt=opt||{};var logs=opt.logs||E.get_logs(true);var msg=type+(opt.module&&opt.module!=opt.type?"/"+opt.module:"")+": "+s;var slevel=opt.level||"debug";var level=log_levels[slevel];var set_level=log_levels[E.settings.log_level||"notice"];var print=false;if(opt.console_log&&set_level>0)print=true;else if(level<=set_level){var mods=E.settings.log_modules;if(!opt.module||!mods)print=true;else if(mods&&(mods.includes(opt.module)||mods.includes("*")))print=true}var d=zutil.is_mocha()?E.zmocha_date||new Date:new Date;var _msg=date.to_sql_ms(d)+pad(logs.length,3)+" ["+(opt.id||0)+"] "+msg;if(print){var l=E.level_to_console(slevel);if(zutil.is_mocha()&&E.zmocha_test_log){E.zmocha_console=E.zmocha_console||[];E.zmocha_console.push(l+" "+_msg)}else console[l](_msg)}_msg={type:type,module:opt.module,msg:_msg,level:level};E.full_history.push(_msg);if(level<=Math.max(log_levels.info,set_level))logs.push(_msg);var max_full=E.settings.max_full_history_size||8192;var max_size=E.settings.max_size||2048;if(!E.debug_mode&&E.full_history.length>max_full)E.full_history.splice(0,max_full/2);if(!E.debug_mode&&logs.length>max_size)logs.splice(0,max_size/2)}E.level_to_console=function(level){switch(level){case"crit":return"error";case"err":return"error";case"warn":return"warn";case"notice":return"log";case"info":return"info";case"debug":return zutil.is_mocha()?"info":"debug";default:console.error("invalid level",level);return"error"}};E.filter_logs=function(logs,types,modules){types=typeof types=="string"?[types]:types&&types.slice();modules=typeof modules=="string"?[modules]:modules;return logs.filter(function(l){if(!l.type)return true;var match_type=types&&types.includes(l.type);var match_module=modules&&modules.includes(l.module);return(!types||match_type)&&(match_type&&!l.module||!modules||match_module)})};E.logs_to_str=function(logs,full_log){if(!logs)return"no logs";var size=E.settings.max_size/2;if(!full_log&&logs.length>size)logs=logs.slice(-size);logs=logs.map(function(l){return l&&l.msg||l});return array.to_nl(logs)||"empty logs"};E.concat_logs=function(logs,logs2,need_sort){var combined_logs=(logs||[]).concat(logs2||[]);if(need_sort){combined_logs.sort(function(a,b){return(a&&a.msg||a).localeCompare(b&&b.msg||b)})}return combined_logs};E.set_perr=function(perr_func){E.perr=perr_func};return E})})();
(function(){var __hola_stub_define;var is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node)define=define||self.define;else define=require("./require_node.js").define(module,"../");define("/util/rand.js",["/util/array.js"],function(array){var E={};var is_jtest=false;var jtest_vals={};var MAX_INT=2147483647;var MIN_INT=-MAX_INT-1;function jtest_pop(s){var elm;if(s===undefined)return null;if((elm=jtest_vals[s])===undefined)return null;return elm.shift()}E.rand=function(s){var ret;if(is_jtest&&(ret=jtest_pop(s))!==null)return ret;return Math.random()};E.rand_int32=function(s){var ret;if(is_jtest&&(ret=jtest_pop(s))!==null)return ret;return Math.floor(Math.random()*(MAX_INT-MIN_INT+1))-MAX_INT};E.rand_range=function(from,to,s){var ret;if(is_jtest&&(ret=jtest_pop(s))!==null)return ret;return Math.floor(Math.random()*(to-from))+from};E.rand_element=function(a,s){if(a.length)return a[E.rand_range(0,a.length,s)]};E.rand_subset=function(a,size,s){var shuffled=a.slice(0);for(var i=0;i<size;i++){var j=E.rand_range(i,shuffled.length,s);var tmp=shuffled[j];shuffled[j]=shuffled[i];shuffled[i]=tmp}return shuffled.slice(0,size)};E.jtest_push=function(s,arr){if(!jtest_vals[s])jtest_vals[s]=[];if(Array.isArray(arr))array.push(jtest_vals[s],arr);else jtest_vals[s].push(arr)};E.jtest_init=function(){is_jtest=true;jtest_vals={}};E.jtest_uninit=function(){is_jtest=false};E.basic_u32=function(v){return 1103515245*v+12345>>>0};E.basic_u31=function(v){return 1103515245*v+12345&2147483647};return E})})();
!function(n){function t(n,t){var r=(65535&n)+(65535&t),e=(n>>16)+(t>>16)+(r>>16);return e<<16|65535&r}function r(n,t){return n<<t|n>>>32-t}function e(n,e,o,u,c,f){return t(r(t(t(e,n),t(u,f)),c),o)}function o(n,t,r,o,u,c,f){return e(t&r|~t&o,n,t,u,c,f)}function u(n,t,r,o,u,c,f){return e(t&o|r&~o,n,t,u,c,f)}function c(n,t,r,o,u,c,f){return e(t^r^o,n,t,u,c,f)}function f(n,t,r,o,u,c,f){return e(r^(t|~o),n,t,u,c,f)}function i(n,r){n[r>>5]|=128<<r%32,n[(r+64>>>9<<4)+14]=r;var e,i,a,h,d,l=1732584193,g=-271733879,v=-1732584194,m=271733878;for(e=0;e<n.length;e+=16)i=l,a=g,h=v,d=m,l=o(l,g,v,m,n[e],7,-680876936),m=o(m,l,g,v,n[e+1],12,-389564586),v=o(v,m,l,g,n[e+2],17,606105819),g=o(g,v,m,l,n[e+3],22,-1044525330),l=o(l,g,v,m,n[e+4],7,-176418897),m=o(m,l,g,v,n[e+5],12,1200080426),v=o(v,m,l,g,n[e+6],17,-1473231341),g=o(g,v,m,l,n[e+7],22,-45705983),l=o(l,g,v,m,n[e+8],7,1770035416),m=o(m,l,g,v,n[e+9],12,-1958414417),v=o(v,m,l,g,n[e+10],17,-42063),g=o(g,v,m,l,n[e+11],22,-1990404162),l=o(l,g,v,m,n[e+12],7,1804603682),m=o(m,l,g,v,n[e+13],12,-40341101),v=o(v,m,l,g,n[e+14],17,-1502002290),g=o(g,v,m,l,n[e+15],22,1236535329),l=u(l,g,v,m,n[e+1],5,-165796510),m=u(m,l,g,v,n[e+6],9,-1069501632),v=u(v,m,l,g,n[e+11],14,643717713),g=u(g,v,m,l,n[e],20,-373897302),l=u(l,g,v,m,n[e+5],5,-701558691),m=u(m,l,g,v,n[e+10],9,38016083),v=u(v,m,l,g,n[e+15],14,-660478335),g=u(g,v,m,l,n[e+4],20,-405537848),l=u(l,g,v,m,n[e+9],5,568446438),m=u(m,l,g,v,n[e+14],9,-1019803690),v=u(v,m,l,g,n[e+3],14,-187363961),g=u(g,v,m,l,n[e+8],20,1163531501),l=u(l,g,v,m,n[e+13],5,-1444681467),m=u(m,l,g,v,n[e+2],9,-51403784),v=u(v,m,l,g,n[e+7],14,1735328473),g=u(g,v,m,l,n[e+12],20,-1926607734),l=c(l,g,v,m,n[e+5],4,-378558),m=c(m,l,g,v,n[e+8],11,-2022574463),v=c(v,m,l,g,n[e+11],16,1839030562),g=c(g,v,m,l,n[e+14],23,-35309556),l=c(l,g,v,m,n[e+1],4,-1530992060),m=c(m,l,g,v,n[e+4],11,1272893353),v=c(v,m,l,g,n[e+7],16,-155497632),g=c(g,v,m,l,n[e+10],23,-1094730640),l=c(l,g,v,m,n[e+13],4,681279174),m=c(m,l,g,v,n[e],11,-358537222),v=c(v,m,l,g,n[e+3],16,-722521979),g=c(g,v,m,l,n[e+6],23,76029189),l=c(l,g,v,m,n[e+9],4,-640364487),m=c(m,l,g,v,n[e+12],11,-421815835),v=c(v,m,l,g,n[e+15],16,530742520),g=c(g,v,m,l,n[e+2],23,-995338651),l=f(l,g,v,m,n[e],6,-198630844),m=f(m,l,g,v,n[e+7],10,1126891415),v=f(v,m,l,g,n[e+14],15,-1416354905),g=f(g,v,m,l,n[e+5],21,-57434055),l=f(l,g,v,m,n[e+12],6,1700485571),m=f(m,l,g,v,n[e+3],10,-1894986606),v=f(v,m,l,g,n[e+10],15,-1051523),g=f(g,v,m,l,n[e+1],21,-2054922799),l=f(l,g,v,m,n[e+8],6,1873313359),m=f(m,l,g,v,n[e+15],10,-30611744),v=f(v,m,l,g,n[e+6],15,-1560198380),g=f(g,v,m,l,n[e+13],21,1309151649),l=f(l,g,v,m,n[e+4],6,-145523070),m=f(m,l,g,v,n[e+11],10,-1120210379),v=f(v,m,l,g,n[e+2],15,718787259),g=f(g,v,m,l,n[e+9],21,-343485551),l=t(l,i),g=t(g,a),v=t(v,h),m=t(m,d);return[l,g,v,m]}function a(n){var t,r="";for(t=0;t<32*n.length;t+=8)r+=String.fromCharCode(n[t>>5]>>>t%32&255);return r}function h(n){var t,r=[];for(r[(n.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;for(t=0;t<8*n.length;t+=8)r[t>>5]|=(255&n.charCodeAt(t/8))<<t%32;return r}function d(n){return a(i(h(n),8*n.length))}function l(n,t){var r,e,o=h(n),u=[],c=[];for(u[15]=c[15]=void 0,o.length>16&&(o=i(o,8*n.length)),r=0;16>r;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(h(t)),512+8*t.length),a(i(c.concat(e),640))}function g(n){var t,r,e="0123456789abcdef",o="";for(r=0;r<n.length;r+=1)t=n.charCodeAt(r),o+=e.charAt(t>>>4&15)+e.charAt(15&t);return o}function v(n){return unescape(encodeURIComponent(n))}function m(n){return d(v(n))}function p(n){return g(m(n))}function s(n,t){return l(v(n),v(t))}function C(n,t){return g(s(n,t))}function A(n,t,r){return t?r?s(t,n):C(t,n):r?m(n):p(n)}"function"==typeof define&&define.amd?define("md5",[],function(){return A}):"object"==typeof module&&module.exports?module.exports=A:n.md5=A}(this);
(function(){var __hola_stub_define,is_node=typeof module=="object"&&module.exports;if(!is_node)define=define||self.define;else{var define_node=require("../../../util/require_node.js").define(module,"../");var zutil=require("../../../util/util.js");var md5=zutil.is_mocha()&&"/svc/cdn/pub/md5.min.js";define=function(name,deps,fn){return define_node(name,["/util/url.js","/util/ajax_lite.js",null,"/util/escape.js","/util/user_agent.js","/util/etask.js","/util/date.js","/util/array.js","/util/util.js",null,"/util/events.js","/util/rand.js",md5,"/util/conv.js"],fn)}}define("/svc/cdn/pub/util.js",["/util/url.js","/util/ajax_lite.js","/util/storage.js","/util/escape.js","/util/user_agent.js","/util/etask.js","/util/date.js","/util/array.js","/util/util.js","/svc/cdn/pub/log.js","/util/events.js","/util/rand.js","md5","/util/conv.js","/util/rate_limit.js"],function(zurl,ajax,storage,zescape,user_agent,etask,date,array,zutil,_log,events,rand,md5,conv,rate_limit){var def_perr_url="//perr.h-cdn.com/be_client_cgi/perr";var E={conf:{}};var assign=Object.assign;var log;if(is_node){E.uri_opts_list=[]}else{E.geoip=zutil.clone(storage.get_json("hola_geoip")||{});E.perr_url=def_perr_url;E.player_url="https://player.h-cdn.com";E.jtest={};E.uri_opts_list=["tech"];E.session_id="session_id_"+rand.rand("cdn_session_id");var protocol=typeof window!="undefined"&&window.location&&window.location.protocol;E.protocol=!protocol||!protocol.startsWith("http")?"http:":protocol;E.mvp_marker=null;log=_log.set_module("util");E.ERR={failed:-1,ranges_unsupported:-2,aborted:-3,head_unsupported:-4,disconnected:-5,unicode_bom:-6,busy:-7};E.ERR_str={"-1":"failed","-2":"ranges_unsupported","-3":"aborted","-4":"head_unsupported","-5":"disconnected","-6":"unicode_bom","-7":"busy"};E.BEFOREUNLOAD=typeof navigator!="undefined"&&navigator.userAgent.match(/iPad|iPhone|iPod/)?"pagehide":"beforeunload";E.has_beacon=typeof navigator!="undefined"&&navigator.sendBeacon;E.browser_init=function(ua,platform){var browser=E.browser=user_agent.guess_browser(ua);var guess=E.guess=user_agent.guess(ua,platform);E.is_chrome=browser.browser=="chrome"&&!browser.opera;E.is_firefox=browser.browser=="firefox";E.is_edge=browser.browser=="edge";E.is_ie=browser.browser=="ie";E.is_opera=browser.opera;E.is_samsung=browser.samsung_browser;E.is_ucbrowser=browser.ucbrowser;E.is_safari=browser.browser=="safari";E.is_webview=!!browser.webview;E.is_windows=guess.os=="windows";E.is_android=guess.os=="android";E.is_winphone=guess.os=="winphone";E.is_mac=guess.os=="macos";E.is_ios=guess.os=="ios";E.is_linux=guess.os=="linux";E.is_webos=guess.os=="webos";E.is_mobile=guess.mobile;E.is_arch_32=guess.arch=="32";E.is_tv=guess.tv;E.is_ios_sdk=browser.hola_ios;E.is_android_sdk=browser.hola_app;E.is_app=browser.hola_player_app;E.browser_rule_s=E.browser.opera?"opera":E.browser.hola_app?"android_app":E.browser.hola_ios?"ios_app":E.browser.webos_app?"webos_app":E.browser.chromium_based?"chromium_based":E.browser.browser};E.browser_init();E.fix_url=function(url){return url.startsWith("//")?E.protocol+url:url};function dom_query_fn(method){return function(selector){var method_exists_on=function(root){return root&&root[method]};var query=function(root){return root&&root[method]?root[method](selector):null};if(method_exists_on(document))return query(document);if(method_exists_on(document.body)||method_exists_on(document.head)){return query(document.body)||query(document.head)}return query(document.createElement("div"))}}E.dom_query=dom_query_fn("querySelector");E.dom_query_all=dom_query_fn("querySelectorAll");E.dom_query_foreach=function(selector,cb){var nodes=E.dom_query_all(selector);for(var i=0;i<nodes.length;i++)cb(nodes[i])};E.dom_listen=function(element,on_dom_change){if(window.MutationObserver){var observer=new window.MutationObserver(on_dom_change);observer.observe(element,{childList:true,subtree:true});E.dom_listen.using_observer=true;return observer.disconnect.bind(observer)}if(window.MutationEvent&&element.addEventListener){E.cdn_perr({id:"using_mutation_events",info:{from:"dom_listen"}});element.addEventListener("DOMSubtreeModified",on_dom_change);return element.removeEventListener.bind(element,"DOMSubtreeModified",on_dom_change)}E.cdn_perr({id:"dom_listen_unavailable"});return function(){}};E.attr_watch=function(element,opt){function onchange(from,to){var re;if(re=opt.toggle_pattern){if(re.test(to)==re.test(from))return;from=(from&&from.match(re)||[])[0];to=(to&&to.match(re)||[])[0]}else if(re=opt.change_pattern){from=(from&&from.match(re)||[])[0];to=(to&&to.match(re)||[])[0];if(from==to)return}opt.watch_fn(from,to)}if(zutil.is_mocha()){var prop,attr2prop={"class":"className"};if(prop=attr2prop[opt.attr]){var hook=E.inject_hook(element,prop,{set:function(e,args){var prev=element[prop];hook.original_handlers.set(args[0]);onchange(prev,args[0]);e.set_handled()}});return hook.remove.bind(hook)}}if(window.MutationObserver){var observer=new window.MutationObserver(function(mutations){var first;if(first=mutations.find(function(record){return record.attributeName==opt.attr})){onchange(first.oldValue,element.getAttribute(opt.attr))}});observer.observe(element,{attributes:true,attributeOldValue:true});return observer.disconnect.bind(observer)}if(window.MutationEvent&&element.addEventListener){var on_attr_modified=function(e){if(e.attrName==opt.attr)onchange(e.prevValue,e.newValue)};E.cdn_perr({id:"using_mutation_events",info:{from:"attr_watch"}});element.addEventListener("DOMAttrModified",on_attr_modified);return element.removeEventListener.bind(element,"DOMAttrModified",on_attr_modified)}E.cdn_perr({id:"attr_watch_unavailable"})};E.new_event=function(name,init){if(typeof Event=="function")return new Event(name,init);var evt=document.createEvent("Event");evt.initEvent(name,true,true);return evt};E.clone_event=function(evt){return E.new_event(evt.type,evt)};E.send_beacon=function(url,data){if(E.has_beacon){data.send_type="BEACON";if(navigator.sendBeacon(url,to_form_data(data)))return;data.send_type=undefined}data.send_type="POST";ajax.raw({url:E.fix_url(url),data:data,method:"POST"})};E.is_numeric=function(n){return!isNaN(n)&&n!=null&&n!=Infinity};E.valid_ranges=function(ranges){return ranges&&(!ranges.length||ranges.every(function(r){return E.is_numeric(r.from)&&E.is_numeric(r.to)}))};E.get_dbg_conf=function(){var dbg_conf=storage.get_json("hola_dbg_conf");var window_dbg_conf=typeof window!="undefined"&&window.hola_dbg_conf;if(!window_dbg_conf&&!dbg_conf)return;dbg_conf=zutil.extend_deep({},window_dbg_conf,dbg_conf);if(!E.get_dbg_conf_warn){log.warn("using hola_dbg_conf %O",dbg_conf,{});E.get_dbg_conf_warn=true}return dbg_conf};E.get_spark_conf=function(){var spark_conf=storage.get_json("spark_conf")||storage.get_json("hola_spark_conf");var window_spark_conf=typeof window!="undefined"&&(window.spark_conf||window.hola_spark_conf);if(!window_spark_conf&&!spark_conf)return;spark_conf=zutil.extend_deep({},window_spark_conf,spark_conf);if(!E.get_spark_conf_warn){log.warn("using hola_spark_conf %O",spark_conf,{});E.get_spark_conf_warn=true}return spark_conf};E.remove_from_qs=function(qs,remove){var pairs=qs.split("&"),params={};pairs.forEach(function(p){var split=p.split("=");params[split[0]]=split[1]});Object.keys(params).forEach(function(param){if(remove.includes(decodeURIComponent(param)))delete params[param]});qs="";for(var p in params){qs+=(qs.length?"&":"")+p+(params[p]!==undefined?"="+params[p]:"")}return qs};E.get_platform_conf=function(conf){var pconf;conf=conf||{};if(E.is_app&&conf.app){pconf=conf.app.use_desktop_conf?assign({},conf.desktop,{disable:conf.app.disable}):conf.app}else if((E.is_mobile||E.is_app)&&conf.mobile){pconf=conf.mobile.use_desktop_conf?assign({},conf.desktop,{disable:conf.mobile.disable}):conf.mobile}if(!E.is_mobile&&!E.is_app&&conf.desktop)pconf=conf.desktop;if(pconf){conf=assign({},zutil.omit(conf,["desktop","mobile","app"]),pconf)}return conf};E.get_tooltip_position=function(player_conf){if(E.is_mobile)return"hidden";var pos=player_conf.tooltip_position||"auto";if(pos=="auto")return player_conf.position.includes("l")?"right":"left";return player_conf.tooltip_position};E.conv_playlist_for_widget=function(list){return list.map(function(obj){obj.video_info=obj.video_info||{};return{description:obj.video_info.description||"",dur:obj.video_info.dur||0,page_url:obj.location||"",poster:obj.video_info.poster||"",video_poster:obj.video_info.video_poster||"",video_url:obj.video_info.url||"",title:obj.video_info.title||"",total:obj.video_info.total||0,ts:obj.video_info.ts||0}})};E.init=function(conf){if(E.inited)return;E.perr_sent={};E.perr_rl_hash={};E.inited=true;E.mvp_marker=null;E.conf=zutil.extend_deep({},conf,E.get_dbg_conf());E.has_ext=E.conf.loader&&E.conf.loader.injected;E.is_selenium=typeof window!="undefined"&&window.hola_selenium_test;var proto=zutil.get(E.conf,"loader.https_xhr_only")?"https:":"";E.perr_url=E.conf.perr_url||proto+def_perr_url;E.ver=E.conf.ver;E._events=new E.events;E.debug_err_url_rx=storage.get("hola_debug_err_url_rx");if(typeof window!="undefined")window.addEventListener(E.BEFOREUNLOAD,on_beforeunload);if(typeof document!="undefined"&&document.visibilityState){E.is_hidden=document.visibilityState!="visible";document.addEventListener("visibilitychange",on_visibilitychange)}};function on_beforeunload(){E.is_beforeunload=true;E._events.emit("beforeunload");E._events.emit("zbeforeunload",{type:"beforeunload"});E.send_delayed_perrs()}function on_visibilitychange(){if(document.visibilityState=="visible"){E.is_hidden=false;E._events.emit("visible_state");if(E.is_mobile)E._events.emit("visibility_start")}else if(document.visibilityState=="hidden"){E.is_hidden=true;E._events.emit("hidden_state");if(E.is_mobile){E._events.emit("visibility_end");E._events.emit("zbeforeunload",{type:"visibility_end"})}}E.send_delayed_perrs()}function _has_local_storage(){try{var _=localStorage;if(_.length)return true;_.setItem("_",0);_.removeItem("_");return true}catch(e){}}E.has_local_storage=_has_local_storage();E.is_mode_stats=function(zone){return zone.CG("mode")=="stats"};E.is_mode_cdn=function(zone){return zone.CG("mode")=="cdn"};E.is_mode_bwsaver=function(zone){return zone.CG("mode")=="bwsaver"};E.is_mode_cdn_or_bwsaver=function(zone){return E.is_mode_cdn(zone)||E.is_mode_bwsaver(zone)};E.uninit=function(){if(!E.inited)return;if(typeof window!="undefined")window.removeEventListener(E.BEFOREUNLOAD,on_beforeunload);if(typeof document!="undefined"&&document.visibilityState)document.removeEventListener("visibilitychange",on_visibilitychange);E.send_delayed_perrs();E.inited=false;E.conf={}};function build_info(){var b={platform:typeof navigator!="undefined"&&navigator.platform,user_agent:typeof navigator!="undefined"&&navigator.userAgent};b.ver=E.ver;b.browser=user_agent.browser_to_string(E.browser);b.browser_build=typeof window!="undefined"&&window.conf&&window.conf.browser&&window.conf.browser.name;b.guess=JSON.stringify(E.guess);return b}function build(){var info=build_info(),s="";for(var f in info)s+=(s&&"\n")+f+": "+info[f];return s}function to_form_data(o){var data=new FormData;zutil.forEach(o,function(v,k){data.append(k,v)});return data}E.perrs=[];E.perr_delayed=function(opt){if(!zutil.get(E.conf,"loader.delayed_perrs_enable")&&!zutil.get(E.conf,"loader.delayed_perrs_filterin",[]).includes(opt.id)){return}E.perrs.push(opt);if(E.delayed_timer)return;E.delayed_timer=setTimeout(E.send_delayed_perrs,5*date.ms.SEC)};E.get_connection_speed=function(){var connection=navigator&&(navigator.connection||navigator.mozConnection||navigator.webkitConnection);return connection&&connection.effectiveType};E.get_connection_type=function(){var connection=navigator&&(navigator.connection||navigator.mozConnection||navigator.webkitConnection);return connection&&connection.type};E.is_mobile_wifi_con=function(){return E.is_mobile&&E.get_connection_type()=="wifi"};E.is_mobile_cellular_con=function(){return E.is_mobile&&E.get_connection_type()=="cellular"};E.detect_incognito=function(){return etask({cancel:true},[function(){if(window.requestFileSystem||window.webkitRequestFileSystem){(window.requestFileSystem||window.webkitRequestFileSystem)(0,0,this.continue_fn(),this.continue_fn());return this.wait()}if(E.is_firefox)return this.goto("res",navigator&&!!navigator.serviceWorker);if(E.is_safari){try{if(localStorage.length)return false;else{localStorage.x=1;localStorage.removeItem("x")}}catch(e){return this.goto("res",!navigator.cookieEnabled)}}return true},function(r){return!r.code},function res(r){return!r}])};E.send_delayed_perrs=function(){E.delayed_timer=clearTimeout(E.delayed_timer);if(!E.perrs.length)return;if(!E.is_beforeunload&&!E.is_hidden){var can_send=true;var wrappers=zutil.get(E.loader,"wrapper",[]);wrappers.forEach(function(w){if(!can_send||!w.player||!w.player.is_playing())return;var b=w.player.get_current_buffer();if(b.to-b.from>20)return;can_send=false});if(!can_send)E.delayed_timer=setTimeout(E.send_delayed_perrs,5*date.ms.SEC)}var max=25,perrs=E.perrs.slice(0,max);E.perrs=E.perrs.slice(max);E.cdn_perr({id:"delayed_perrs",delay:false,delayed_perrs:perrs});if(E.perrs.length)E.delayed_timer=setTimeout(E.send_delayed_perrs,date.ms.SEC)};function perr_raw(opt){var data={},qs={},delayed=opt.delay===undefined||!!opt.delay;data.info=opt.info;data.bt=opt.bt;data.filehead=opt.filehead;if(opt.delayed_perrs)data.delayed_perrs=JSON.stringify(opt.delayed_perrs);qs.id=opt.id;qs.browser=opt.browser||(E.browser.opera?"opera":E.browser.ucbrowser?"ucbrowser":E.browser.samsung_browser?"samsung":E.browser.browser);qs.browser_ver=E.browser.version;qs.customer=opt.customer;if(opt.tag){qs.tag_id=opt.tag.id;qs.tag_date=+opt.tag.date}if(opt.zone)qs.zone=opt.zone;data.session_id=opt.session_id;data.is_json=1;if(delayed&&!+E.get_spark_uri("hola_no_perr_delay")){assign(data,qs);E.perr_delayed(data);return}data.ver=E.ver;data.build=build();var url=(opt.perr_url||E.perr_url)+"?"+zescape.qs(qs);if(opt.use_beacon)return void E.send_beacon(url,data);data.send_type="POST";ajax.raw({url:E.fix_url(url),data:data,method:"POST"})}var is_touch=typeof document!="undefined"&&"ontouchstart"in document.documentElement;var is_embed=typeof window!="undefined"&&window.top&&window.top!==window;function perr_rate_limit(opt){if(opt.rate_limit===false)return true;var _rl=assign({ms:date.ms.HOUR,count:10},opt.rate_limit);var id=opt.id,rl=E.perr_rl_hash[id]=E.perr_rl_hash[id]||{};var ret=rate_limit(rl,_rl.ms,_rl.count);if(!ret){var key="perr_rate_limit_"+id;if(!E.perr_sent[key])E.cdn_perr({id:"perr_rate_limit",info:id,rate_limit:false});E.perr_sent[key]=1}return ret}function db_perr(opt){opt=opt||{};var id=opt.id;if(opt.throttle&&!opt.force&&(opt.throttle>=1&&(E.perr_sent[id]||0)>=opt.throttle||opt.throttle<1&&Math.random()>opt.throttle)){return}perr_rate_limit(opt);var data=opt.data||{};data.sent=data.sent||{};var info=typeof opt.info!="object"?{_info:opt.info}:opt.info;var customer,zone=opt.zone||{};if(!info.customer&&(customer=E.conf.customer))info.customer=customer;if(!info.zone&&zone.name)info.zone=zone.name;if(!info.method&&zone.method)info.method=zone.method;info.hola_mode=info.hola_mode||zone.mode;info.skip=zone.skip;info.dashboard=";type="+(zone.stream_type||"unknown")+(zone.player_type?";player="+zone.player_type:"")+(zone.tech?";tech="+zone.tech:"");var url_frame=E.get_location_urls();var url=data.url||opt.url||url_frame.top_url;var match=url?url.match(/^http(s)?:\/\/(www\.)?([a-zA-Z0-9-\.]+)\/.*$/):null;info.url=url;info.frame=!!url_frame.frame_url;info.location_url=url_frame.frame_url||url_frame.top_url;if(!info.page_url)info.page_url=url_frame.top_url;info.site=match?match[3]:"unknown";info.referrer=typeof document!="undefined"&&document.referrer;info.referrer_type=E.referrer_type(info.location_url,info.referrer,E.gconf_get("loader.referrer_internal_regex"));assign(info,opt.extra,{file:data.file,link:data.link,err:opt.err||info.err});info.is_embed=is_embed;info.is_touch=is_touch;if(E.mvp_marker!=null)info.mvp_marker=E.mvp_marker;info.support_fullscreen=user_agent.support_fullscreen();var nc;if(typeof navigator!="undefined"&&(nc=navigator.connection))info.connection={type:nc.type,downlink_max:nc.downlinkMax};if(zone.bwsaver)info.bw_saving=zone.bwsaver;if(zone.video_url&&!info.video_url)info.video_url=zone.video_url;if(zone.video_live&&info.video_live===undefined)info.video_live=zone.video_live;if(zone.player_info)info.player_info=zone.player_info;if(E.is_beforeunload)info.before_unload=true;E.perr_sent[id]=E.perr_sent[id]+1||1;info.session_id=E.session_id;info.tag=zutil.get(E.loader,"tag");info.injected=E.loader&&E.loader.CG("loader.injected");info.analysis_tag=opt.analysis_tag;var info_str;try{info_str=conv.JSON_stringify(info,{inf:true})}catch(e){info_str="[circular]"}perr_raw({tag:info.tag,session_id:E.session_id,id:opt.prefix+id,info:info_str,customer:customer,zone:zone.name,bt:opt.bt,browser:opt.browser,filehead:opt.filehead,use_beacon:opt.use_beacon,perr_url:opt.perr_url,delay:opt.delay,delayed_perrs:opt.delayed_perrs})}_log.set_perr(function(opt){return E.cdn_perr(opt)});E.cdn_perr=function(opt){return E._cdn_perr(opt)};E._cdn_perr=function(opt){opt.filehead=opt.filehead?opt.filehead+"\n\n":"";if(opt.add_log){var logs;if(opt.full)logs=_log.get_full_history();else{var log_types=opt.log_types||"cdn";var log_obj=opt.log_obj||(opt.zone?opt.zone.log:_log);logs=_log.filter_logs(log_obj.get_logs(true),log_types,opt.log_modules);logs=_log.concat_logs(logs,_log.get_player_logs(),true)}if(opt.player_logs)logs=_log.concat_logs(logs,opt.player_logs,true);opt.filehead+=_log.logs_to_str(logs,opt.full||opt.full_log)}else opt.filehead+="no log requested";return db_perr(assign(opt,{prefix:"www_cdn_db_"}))}}E.gconf_set=function(path,val){return E.conf_set(E.conf,path,val)};E.conf_set=function(conf,path,val){return zutil.set(conf,path,val)};E.gconf_get=function(path,def){return E.conf_get(E.conf,path,def)};E.conf_get=function(conf,path,def){return zutil.get(conf,path,def)};E.CG=E.gconf_get;E.CS=E.gconf_set;E.gconf_apply=function(path,args,def,_this,throw_ex){return E.conf_apply(E.conf,path,args,def,_this,throw_ex)};E.conf_apply=function(conf,path,args,def,_this,throw_ex){var func=E.conf_get(conf,path,def),ret;if(!func||typeof func!="function"&&!func.__Function__)return func||def;if(func.__Function__){if(!args.length)args=func.args;var info=conv.parse_function(func.__Function__);func=new Function(info.args.join(","),info.body)}try{ret=func.apply(_this,args)}catch(e){log.info("conf_apply of path "+path+" failed with err "+e);if(throw_ex)throw e;ret=def}return ret};function update_xhr_progress(xhr,ev){if(ev.lengthComputable)xhr.total=ev.total;xhr.loaded=ev.loaded}function str2bin(xhr,opt){var arr=conv.str2bin(xhr.response,opt.served||0);if(!arr)return;var ret={progress:opt.served,data:arr.buffer,last_progress:date.monotonic()};opt.progress=opt.served;opt.served=xhr.response.length;return ret}function msstream2bin(xhr,opt){var reader=new window.MSStreamReader;function cb(data,to){var ret={progress:opt.served,data:data,last_progress:date.monotonic()};opt.progress=opt.served;opt.served=to;opt.onreadystatechange(xhr,ret)}reader.onprogress=reader.onload=function(ev){update_xhr_progress(xhr,ev);var data=ev.target.result;var to=ev.loaded;if(opt.served!=to)cb(data.slice(opt.served,to),to)};reader.readAsArrayBuffer(xhr.response)}var perr_no_res_sent=false;E.fetch_bin=function(opt){opt.onreadystatechange=opt.onreadystatechange||function(){};opt.onprogress=opt.onprogress||function(){};var xhr,url;return etask({name:"fetch_bin",cancel:true},[function(){this.url=url=zescape.uri(E.fix_url(opt.url));var _this=this;this.opt=opt;var fallback_wrapper=function(f){return opt.fallback_wrapper?opt.fallback_wrapper(f):f};if(opt.streaming)opt.progress=opt.served=0;this.xhr=xhr=opt.XHR?new opt.XHR(opt.xhr_opt):new XMLHttpRequest;if(opt.withCredentials)xhr.withCredentials=true;xhr.open(opt.method||(opt.data?"POST":"GET"),url,true);xhr.responseType=opt.response_type||"arraybuffer";xhr.onreadystatechange=fallback_wrapper(function(){if(!opt.streaming||xhr.readyState!=xhr.LOADING)opt.onreadystatechange(xhr)});xhr.onprogress=opt.onprogress;var headers=opt.headers||{};if(headers.Range&&E.browser.browser=="safari")headers["Cache-Control"]="no-store";if(opt.data){var type=opt.content_type||"application/json";if(!opt.no_content_type)headers["Content-Type"]=type;if(type=="application/json"&&typeof opt.data=="object")opt.data=JSON.stringify(opt.data)}for(var hdr in headers)xhr.setRequestHeader(hdr,headers[hdr]);function onload(ev){xhr.success=true;var res=xhr.response;if(opt.response_type=="json"&&xhr.responseType!="json")try{res=JSON.parse(res)}catch(e){}if(xhr.responseType=="ms-stream")res=null;_this.continue({data:res,size:ev.total})}if(E.debug_err_url_rx&&new RegExp(E.debug_err_url_rx).test(url)){log.notice("Xhr onload handler is replaced with debug exception");xhr.onload=function(){log.notice("Generating debug xhr error for "+url);_this.throw("debug xhr error")}}else xhr.onload=fallback_wrapper(onload);xhr.onerror=function(e){_this.throw(e)};if(opt.streaming){var b=E.browser.browser,v=E.browser.version;if(b=="chrome"&&v>=7||b=="firefox"&&v>=9&&opt.streaming_text){xhr.responseType="text";xhr.overrideMimeType("text/plain; charset=x-user-defined");xhr.onprogress=fallback_wrapper(function(e){update_xhr_progress(xhr,e);opt.onprogress.call(xhr,e,str2bin(xhr,opt))})}else if((b=="edge"||b=="ie"&&v>=10)&&window.MSStreamReader){xhr.responseType="ms-stream";xhr.onreadystatechange=fallback_wrapper(function(){if(xhr.readyState==xhr.LOADING)msstream2bin(xhr,opt);else opt.onreadystatechange(xhr)})}else if(b=="firefox"&&v>=9){xhr.responseType="moz-chunked-arraybuffer";xhr.onprogress=fallback_wrapper(function(ev){var res=xhr.response;if(!res){if(!perr_no_res_sent){perr_no_res_sent=true;E.cdn_perr({id:"on_progress_no_res"})}return}update_xhr_progress(xhr,ev);opt.progress=opt.served;opt.served=opt.progress+res.byteLength;opt.onprogress.call(xhr,ev,{progress:opt.progress,data:res,last_progress:date.monotonic()})})}else opt.streaming=false}xhr.streaming=opt.streaming;xhr.send(opt.data);return this.wait(opt.timeout)},function(res){if(this.error||!res)throw"failed fetch request "+this.error;res.hdrs=E.get_resp_hdrs(xhr);if(!res.fullsize){var v;if(v=E.fullsize_from_xhr(xhr))res.fullsize=+v;else if(!opt.hrange&&(!opt.headers||!opt.headers.Range)){res.fullsize=!res.data?0:res.data.byteLength||res.data.length}}res.had_redirect=this.url!=xhr.responseURL;res.status=xhr.status;return res},function catch$(e){this.return({err:e})},function finally$(){opt.aborted=true;if(xhr.readyState<xhr.DONE)xhr.abort()}])};E.fullsize_from_xhr=function(xhr){return E.fullsize_from_hdrs(E.get_resp_hdrs(xhr),xhr.status==206)};E.fullsize_from_hdrs=function(hdrs,is_range){if(!hdrs)return;var fs,v;if(v=hdrs["x-hola-fullsize"])fs=+v;else if(v=hdrs["content-range"])fs=+v.split("/")[1];else if((v=hdrs["content-length"])&&!is_range)fs=+v;return fs};E.guess_link_type=function(url){var type=E.get_video_type(url);switch(type){case"mp4":return"video/mp4";case"hls":return"application/x-mpegurl";case"hds":return"application/adobe-f4m";case"dash":return"application/dash+xml";case"flv":return"video/flv";case"webm":return"video/webm";default:log.debug('could not guess link type: "'+url+'" assuming mp4');return"video/mp4"}};E.mime_to_type=function(mime){switch(mime){case"video/mp4":return"mp4";case"application/vnd.apple.mpegurl":case"application/x-mpegurl":return"hls";case"application/adobe-f4m":return"hds";case"application/dash+xml":return"dash";case"video/flv":return"flv";case"video/webm":return"webm"}};E.blob_to_dataurl=function(blob){return etask({name:"blob_to_dataurl",cancel:true},[function(){var _this=this,reader=new FileReader;reader.onerror=function(e){_this.throw(e)};reader.onload=function(){_this.return(reader.result)};reader.readAsDataURL(blob);return this.wait()}])};E.blob_to_dataurl.supported=!!(typeof window!="undefined"&&window.FileReader&&window.Blob);E.btoa=function(arr){return etask([function(){if(E.blob_to_dataurl.supported)return;var bin="";var dv=new DataView(arr.buffer,arr.byteOffset,arr.byteLength);for(var i=0,l=arr.byteLength;i<l;i++)bin+=String.fromCharCode(dv.getUint8(i));return this.return(window.btoa(bin))},function(){return E.blob_to_dataurl(new Blob([arr]))},function(r){return r.slice(r.indexOf(",")+1)}])};E.set_geoip=function(data){if(!data)return;if(E.geoip&&E.geoip.country&&E.geoip.country!=data.country.toLowerCase()){E.cdn_perr({id:"geoip_country_change",info:{prev:E.geoip,next:data}})}E.geoip=zutil.clone(data);E.geoip.ver=E.conf.ver;for(var i in E.geoip){if(typeof E.geoip[i]=="string")E.geoip[i]=E.geoip[i].toLowerCase()}if(data.date)E.geoip.date_skew=date(date.to_jdate())-date(data.date);E.geoip.update=date.to_jdate();storage.set_json("hola_geoip",E.geoip);E._events.emit("set_geoip",E.geoip)};E.array_equal=function(arr1,arr2){if(arr1.length!=arr2.length)return false;var i;for(i=0;i<arr1.length&&arr1[i]===arr2[i];i++);return i==arr1.length};E.events=function(){this.events=new events;return this};E.events.prototype.on=function on(event,fn,context){this.events.on(event,fn,context)};E.events.prototype.once=function once(event,fn,context){this.events.once(event,fn,context)};E.events.prototype.one=E.events.prototype.once;E.events.prototype.off=function off(event,fn){this.events.off(event,fn)};E.events.prototype.multi_on=function multi_on(handlers,context){Object.keys(handlers).forEach(function(e){this.events.on(e,handlers[e],context)},this)};E.events.prototype.multi_off=function multi_off(handlers,context){Object.keys(handlers).forEach(function(e){this.events.off(e,handlers[e],context)},this)};E.events.prototype.emit=function emit(event,a1,a2,a3,a4,a5){this.events.emit("pre-"+event,a1,a2,a3,a4,a5);this.events.emit(event,a1,a2,a3,a4,a5);this.events.emit("post-"+event,a1,a2,a3,a4,a5)};E.on=function(event,fn,ctx){E._events.on(event,fn,ctx)};E.off=function(event,fn){E._events.off(event,fn)};E.services={};E.services.brightcove=function(opt,cb){var sources=[];etask([function(){this.finally(function(){cb(sources)});return ajax.raw({url:"https://edge.api.brightcove.com/playback/v1"+"/accounts/"+(opt.account_id||opt.account)+"/videos/"+(opt.video_id||opt.video),headers:{"BCOV-Policy":opt.policy_key||opt.pk},data_type:"json"})},function catch$(){return this.return()},function(data){sources=data.sources.filter(function(src){return src.src&&/^mp4$/i.test(src.container||"")&&/^h264$/i.test(src.codec||"")});sources=sources.map(function(src){return{src:src.src,type:"video/mp4"}})}])};var web_sockets={};E.ws=function(host,opt){opt=opt||{};var ws_c=opt.ws_c||typeof WebSocket!="undefined"&&WebSocket;if(typeof ws_c!="function"||!host)return;if(!(this instanceof E.ws))return new E.ws(host,opt);var path,customer,zone;if(typeof opt=="string")path=opt;else if(typeof opt=="object"){path=opt.path;customer=opt.customer;zone=opt.zone}var protocol=opt.protocol||(E.protocol=="https:"?"wss":"ws");this.url=protocol+"://"+host+"/"+path;this.url=zescape.uri(this.url,{customer:customer,zone:zone});if(web_sockets[this.url])return web_sockets[this.url];this.id=0;this.minor=!!opt.minor;this.pending=[];try{this.ws=new ws_c(this.url)}catch(e){return}this.ws.binaryType="arraybuffer";this.ws.onopen=this.onopen.bind(this);this.ws.onclose=this.onclose.bind(this);this.ws.onerror=this.onerror.bind(this);this.ws.onmessage=this.onmessage.bind(this);this.log=opt.log||log;this.timer=undefined;this.timedout=false;if(opt.timeout){this.timer=setTimeout(this.ontimedout.bind(this),opt.timeout==true?5e3:opt.timeout)}web_sockets[this.url]=this;return this};zutil.inherits(E.ws,events.EventEmitter);E.ws.prototype.close=function(){if(this.ws&&this.ws.readyState<this.ws.CLOSING)this.ws.close();web_sockets[this.url]=undefined};E.ws.prototype.is_ready=function(){return this.ws&&this.ws.readyState==this.ws.OPEN};E.ws.prototype.send=function(cmd,route,data,onmessage){if(!this.ws||this.ws.readyState>=this.ws.CLOSING)return;if(this.ws.readyState<this.ws.OPEN){this.pending.push({cmd:cmd,route:route,data:data,onmessage:onmessage});return}if(typeof data=="string")data=JSON.parse(data);if(Array.isArray(data))data={data:data};var msg={__id:this.id++,cmd:cmd,route:route,data:data||{}};if(onmessage)this.once(msg.__id,onmessage);msg=JSON.stringify(msg);try{this.ws.send(msg)}catch(e){this.log.info("error in websocket send: state "+this.ws.readyState+" "+" msg "+e.message+" url "+this.url)}return msg.length};E.ws.prototype.onopen=function(){var _this=this;if(this.timer){clearTimeout(this.timer);this.timer=undefined}this.pending.forEach(function(item){_this.send(item.cmd,item.route,item.data,item.onmessage)});this.pending=[];this.emit("open")};E.ws.prototype.onclose=function(){if(!this.ws)return;if(this.timer){clearTimeout(this.timer);this.timer=undefined}this.ws=undefined;this.log.info("closed websocket "+this.url);this.emit("close")};E.ws.prototype.onerror=function(e){this.log.info("error websocket "+this.url+" "+e.type);if(this.minor){this.log.info("Note: WebSockets only transmit auxilliary information "+"between clients and servers. WebSocket errors do not impact "+"HolaCDN functionality in any way.")}this.emit("error",e);this.close()};function dv2str(dv,start){var len=dv.getUint32(start);var str="",end=start+len+4;for(var i=start+4;i<end;i+=2)str+=String.fromCharCode(dv.getUint16(i));return str}function bin2json(msg){if(typeof msg=="string")return JSON.parse(msg);if(!msg.byteLength||msg.byteLength<9)throw new Error("bad message");var ctrl=new DataView(msg);var ver=ctrl.getUint8(0);if(ver!=2)throw new Error("unsupported version");var str_part=dv2str(ctrl,4);var obj=JSON.parse(str_part);var offset=str_part.length*2+8;while(offset<msg.byteLength){var id_str=dv2str(ctrl,offset);offset+=id_str.length*2+4;var bin_len=ctrl.getUint32(offset);var bin_data=new Uint8Array(msg,offset+4,bin_len);offset+=bin_len+4;zutil.set(obj,id_str,bin_data)}return obj}E.ws.prototype.onmessage=function(ev){if(typeof ev.data.byteLength=="number"){if(ev.data.byteLength<9)return this.emit("message",{err:"bad message"});var ctrl=new DataView(ev.data,0,8);var ver=ctrl.getUint8(0);if(ver!=1&&ver!=2)return this.emit("message",{err:"unsupported version"});if(ver==1){var bid=ctrl.getUint32(4);var data=new Uint8Array(ev.data,8);return this.emit(bid,{body:data})}}var json;try{json=bin2json(ev.data)}catch(e){json={err:e}}this.emit(json.__id===undefined?"message":json.__id,json.res||json)};E.ws.prototype.ontimedout=function(){if(this.timer){clearTimeout(this.timer);this.timer=undefined}if(!this.ws)return;this.timedout=true;this.close()};E.ms_since=function(since){return Math.round(date.monotonic()-(since||0))};E.origin_is_allowed=function(origin,origins){return E._origin_is_allowed(origins||E.gconf_get("agent.origins"),origin)};E.origin_is_allowed_url=function(url,origins){var o=zurl.parse(url);if(!o||!o.hostname)return;return E.origin_is_allowed(o.hostname,origins)};E.get_api=function(){var g=typeof window!="undefined"?window:typeof global!="undefined"?global:self;return(g.hola_cdn||(g.hola_cdn={api:{}})).api};var mp4_suffix=/\.(mp4|m4p|m4v|mov)\/?$/i;var hls_suffix=/\.m3u8\/?$/;var hds_suffix=/\.f4m\/?$/;var dash_suffix=/\.mpd\/?$/;var flv_suffix=/\.flv\/?$/;var webm_suffix=/\.webm\/?$/;function is_rx_link(v,rx){return!!v&&rx.test(zurl.parse(v).pathname.split(";")[0])}E.is_mp4_link=function(v){return is_rx_link(v,mp4_suffix)};E.is_hls_link=function(v){return is_rx_link(v,hls_suffix)};E.is_hds_link=function(v){return is_rx_link(v,hds_suffix)};E.is_dash_link=function(v){return is_rx_link(v,dash_suffix)};E.is_flv_link=function(v){return is_rx_link(v,flv_suffix)};E.is_webm_link=function(v){return is_rx_link(v,webm_suffix)};E.is_youtube_link=function(v){return v&&/^(.*\.)?youtube.com$/.test(zurl.get_host(v))};E.get_video_type=function(v){if(E.is_youtube_link(v))return"yt";if(E.is_mp4_link(v))return"mp4";if(E.is_flv_link(v))return"flv";if(E.is_webm_link(v))return"webm";if(E.is_hls_link(v))return"hls";
if(E.is_hds_link(v))return"hds";if(E.is_dash_link(v))return"dash";return null};E.is_adaptive=function(type){return["hls","hds","dash"].indexOf(type)>-1};E.is_progressive=function(type){return["mp4","flv","webm"].indexOf(type)>-1};E.get_method_type=function(type){if(E.is_progressive(type))return"progressive";if(E.is_adaptive(type))return type;return"unknown"};E.get_adaptive_by_type=function(type){if(E.is_adaptive(type)||type=="yt")return type;return null};E.get_adaptive_type=function(v){var type=E.get_video_type(v);return E.get_adaptive_by_type(type)};E.is_blob_url=function(u){return!!(u&&(u.startsWith("blob:")||u.startsWith("mediasource:")))};E.is_proxy_url=function(u){var o=zurl.parse(u);return o.hostname==require.zdot("host")};E.is_ad_url=function(u){var ad_sources=E.gconf_get("ad_sources",[]);return ad_sources.length&&E.check_url(u,{include:ad_sources})};E.get_proxy_url=function(customer,zone,src){return"//"+require.zdot("host")+"/api/zagent_get?customer="+customer+"&zone="+zone+"&url="+encodeURIComponent(src)};E.proxy2origin=function(src){return decodeURIComponent(src.replace(/.*?&url=(.*)$/,"$1"))};function check_re(lst,s){if(!lst)return false;for(var i=0;i<lst.length;i++){var re=lst[i];if(re===s||re instanceof RegExp&&re.test(s))return true}return false}E._origin_is_allowed=function(origins,origin){return origins=="*"||check_re(origins,origin)};E.video_filtered_out=function(video_url,filter_out_js){if(!filter_out_js)return;var u=E.get_location_urls();var filter_opt={url:u.frame_url||u.top_url,video_url:video_url};try{var filter_fn=new Function("opt",filter_out_js);if(filter_fn(filter_opt))return true}catch(e){log.err(e.stack||""+e)}};E.video_format_is_enabled=function(video_url,media_filter_in){if(!media_filter_in)return true;for(var i=0;i<media_filter_in.length;i++){var test_func=E["is_"+media_filter_in[i]+"_link"];if(test_func&&test_func(video_url))return true}return false};E.check_url=function(url,filter){if(!filter)return true;var include=filter.include||[];var exclude=filter.exclude||[];function match(glob){if(!glob)return false;try{return new RegExp("^"+zurl.http_glob_url(glob)).test(url)}catch(e){return void log.err(e.stack||""+e)}}if(exclude.find(match))return false;if(!include.length||include.find(match))return true;return false};E.get_perr_link_msg=function(customer,bugid){return"report sent id "+bugid+"\nbug location url "+"http://holaspark.com/cp/admin/debug/err_problem_report?"+zescape.qs({cust:customer,filter:"info.bugid=="+bugid})};E.get_resp_hdrs=function(xhr){if(!xhr||!xhr.getAllResponseHeaders)return{};var hdrs=xhr.getAllResponseHeaders();if(!hdrs)return{};hdrs=hdrs.split("\n");var ret={},count=1;hdrs.forEach(function(h){if(!h.length||h=="\r")return;var args=h.split(/:(.+)/);var key=args[0].trim().toLowerCase();if(ret[key])key+="_dup"+count++;ret[key]=args[1]&&args[1].trim()});return ret};E.close_to_end=function(cur,dur){return Math.floor(dur)-Math.round(cur)<=0};E.try_wrapper=function(opt,func){if(typeof opt=="function"){func=opt;opt={}}var throttle=opt.throttle||5;var prefix=opt.prefix||"util";return function(){try{return func.apply(this,arguments)}catch(e){if(opt.silent)return;E.cdn_perr({id:prefix+"_try_wrapper_err",err:e.message,throttle:throttle,bt:e.stack,opt:opt});if(log)log.err(prefix+"_try_wrapper_err "+e+" "+e.stack)}}};E.try_wrapper_silent=function(func){return E.try_wrapper({silent:true},func)};E.inject_hook=function(object,prop,opt){function get_property_descriptor_data(o,p){while(o&&!o.hasOwnProperty(p))o=Object.getPrototypeOf(o);return{obj:o,pd:o&&Object.getOwnPropertyDescriptor(o,p)}}function can_install(o,p){var pd=Object.getOwnPropertyDescriptor(o,p);return!pd||pd.configurable}function throw_wrapper(error){if(opt.exit_on_failure)return;throw new Error(error)}if(!object)return throw_wrapper("injecting hook, but no object");if(!can_install(object,prop))return throw_wrapper("injecting hook on unconfigurable property");if(typeof opt=="function")opt={exec:opt};var setup={func_hook:{get_hook:function(){return typeof object[prop]=="function"&&object[prop].hook},install:function(hook){var _hook=function(){return hook("exec",this,arguments)};_hook.hook=hook;hook._orig_handler=object[prop];hook._orig_handler_inherited=!object.hasOwnProperty(prop);Object.defineProperty(object,prop,{configurable:true,writable:true,enumerable:true,value:_hook});if(typeof hook._orig_handler!="function")return{exec:function(){}};return{exec:hook._orig_handler}},uninstall:function(hook){if(hook._orig_handler_inherited||!hook._orig_handler)delete object[prop];else object[prop]=hook._orig_handler}},value_hook:{get_hook:function(){var data=get_property_descriptor_data(object,prop);return data.pd&&(data.pd.get||data.pd.set||{}).hook},install:function(hook){var data=hook._orig_desc_data=get_property_descriptor_data(object,prop);var pd=data.pd;if(!pd||!pd.set&&!pd.get){var v=pd?pd.value:undefined;pd={get:function(){return v},set:function(_v){v=_v}}}var _hook=function(type){var h=function(){return hook(type,this,arguments)};h.hook=hook;return h};Object.defineProperty(object,prop,{configurable:true,enumerable:true,set:pd.set&&_hook("set"),get:pd.get&&_hook("get")});return{get:pd.get,set:pd.set}},uninstall:function(hook){var pd=hook._orig_desc_data.pd||{configurable:true,writable:true,enumarable:true};if(pd.writable)pd.value=object[prop];var target=hook._orig_desc_data.obj||object;if(target!=object)delete object[prop];Object.defineProperty(target,prop,pd)}}};var oh,hook,is_exec=opt.exec||opt.post_exec;var hook_method=is_exec?setup.func_hook:setup.value_hook;if(!(hook=hook_method.get_hook())){hook=function(origin,owner,args){var e={set_handled:function(){e._handled=true},is_intercepted:function(){return!!e._handled}};var iterate_listeners=function(is_post){var ret,listener,_origin=is_post?"post_"+origin:origin;for(var i=0;i<hook.listeners.length;i++){listener=hook.listeners[i];if(!listener[_origin])continue;try{ret=listener[_origin].call(owner,e,args)}catch(e){E.cdn_perr({id:"hook_fail",info:{err:e},add_log:true});throw e}if(!is_post&&e.is_intercepted())return ret}};e.retval=iterate_listeners();if(!e.is_intercepted()&&hook.original_handlers[origin])e.retval=hook.original_handlers[origin].apply(owner,args);iterate_listeners(true);return e.retval};hook.listeners=[];hook.original_handlers=hook_method.install(hook);hook.uninstall=function(){if(hook_method.get_hook()!=hook)return;hook_method.uninstall(hook)}}hook.listeners.push(opt);oh=hook.original_handlers;return{count:function(){return hook.listeners.length},remove:function(){var index=hook.listeners.indexOf(opt);if(index<0)return;hook.listeners.splice(index,1);if(!hook.listeners.length)hook.uninstall()},original_handlers:{exec:is_exec&&oh.exec&&oh.exec.bind(object),get:!is_exec&&oh.get&&oh.get.bind(object),set:!is_exec&&oh.set&&oh.set.bind(object)}}};E.on_window_message=function(cb,async){function is_postm_modifiable(){var d=Object.getOwnPropertyDescriptor(window,"postMessage");var is_modifiable=!d||d.configurable;if(!is_modifiable)E.cdn_perr({id:"postm_non_modifiable"});return is_modifiable}if(!E.gconf_get("loader.post_message_wrapper")||!is_postm_modifiable()){window.addEventListener("message",cb);return window.removeEventListener.bind(window,"message",cb)}var queue=[];function call_async(d){queue.push(d);setTimeout(function(){cb({data:queue.shift()})},0)}var hfunc=async?call_async:function(d){cb({data:d})};var hook=E.inject_hook(window,"postMessage",function(e,a){try{hfunc(a[0])}catch(e){E.cdn_perr({id:"overload_fail",info:{failed_method:"window.postMessage",err:e},add_log:true})}});return hook.remove.bind(hook)};E.absolute_uri=function(s,unwrap_empty){if(!s&&!unwrap_empty)return s;var el=document.createElement("source");el.src=s||"";return el.src};E.set_url_param=function(name,value,delim){return E.set_param(name,value&&encodeURIComponent(value),delim)};E.set_param=function(name,value,delim){if([false,undefined].includes(value))return"";delim=delim||"&";return delim+name+([null,true].includes(value)?"":"="+value)};E.parse={};E.parse.cache_control=function(s){var cc=zescape.parse.http_words(s),ret={};for(var i=0;i<cc.length;i++)ret[cc[i][0]]=cc[i][1]||true;return ret};E.get_spark_uri=function(location,key,def_val){var loc=typeof window!="undefined"&&window.location;if(typeof location!="object"){def_val=key;key=location;location=loc}else if(!location)location=loc;if(!key||!loc)return def_val;var o_url=zurl.parse(window.top===window?location.href:document.referrer);var o_qs=zurl.qs_parse((o_url.search||"").substr(1));var o_hash=zurl.qs_parse((o_url.hash||"").substr(1));return o_qs[key]||o_hash[key]||def_val};E.get_uri_conf=function(){var conf={};E.uri_opts_list.forEach(function(key){var value=E.get_spark_uri("hola_"+key);if(value!==undefined)conf[key]=value});return conf};E.load_script=function(url,onload,attrs){var script=document.createElement("script");script.src=E.fix_url(url);script.onload=onload;if(attrs)Object.assign(script,attrs);if(document.getElementsByTagName("head").length)document.getElementsByTagName("head")[0].appendChild(script);else if(document.getElementsByTagName("body").length)document.getElementsByTagName("body")[0].appendChild(script);else if(document.head)document.head.appendChild(script)};E.script_exists=function(url){return!!E.dom_query('script[src="'+E.fix_url(url)+'"]')};E.max_qid_by_resolution=function(playlists,res){var max_level=playlists.length-1,chosen;if(!res||!res.width||!res.height)return 0;for(var i=max_level;i>=0;i--){var _res=playlists[i].attributes.resolution;var bandwidth=playlists[i].attributes.bandwidth;if(!_res||!_res.width||!_res.height||bandwidth<=64e3)continue;chosen=i;if(_res.width==res.width&&_res.height==res.height)break;if(+_res.width<+res.width&&+_res.height<+res.height){chosen=Math.min(i+1,max_level);break}}return chosen};E.fnv1a=function(chunk){var hash=2166136261,arr=new Uint8Array(chunk);for(var i=0;i<arr.length;i++){hash^=arr[i];hash=hash+(hash<<1)+(hash<<4)+(hash<<7)+(hash<<8)+(hash<<24)>>>0}return hash};E.create_fake_xhr=function(opt){var fake_xhr={setup:{},req_headers:[]};opt.log=opt.log.set_module("util");fake_xhr.open=function(verb,url){fake_xhr.verb=verb;fake_xhr.url=url};fake_xhr.setRequestHeader=function(header,value){fake_xhr.req_headers.push([header,value])};fake_xhr.getAllResponseHeaders=function(){return""};fake_xhr.send=function(){fake_xhr.sent=true;opt.onsend()};fake_xhr.abort=function(){if(!fake_xhr.req||fake_xhr.req.error===E.ERR.aborted||fake_xhr.req.info.rate){return}fake_xhr.req.abort();if(opt.onabort)opt.onabort();opt.log.notice("req aborted",fake_xhr.req.name);if(fake_xhr.onabort)fake_xhr.onabort();if(fake_xhr.onloadend)fake_xhr.onloadend()};return fake_xhr};E.update_fake_xhr=function(req){var fake_xhr=req.info.segment.fake_xhr,err=req.error;fake_xhr.response=err?null:req.res.data;fake_xhr.status=err?404:200;fake_xhr.responseURL=fake_xhr.url;fake_xhr.resp_hdrs=(req.resp||{}).hdrs;if(!err){var ev={loaded:req.res.size,total:req.res.size,target:fake_xhr,lengthComputable:true};if(fake_xhr.onload)fake_xhr.onload(ev)}if(fake_xhr.onloadend)fake_xhr.onloadend();return fake_xhr};E.parse_range_header=function(hdr){var r=hdr.split("=").pop().split("-");return{from:+r[0],to:+r[1]}};E.module_fn=function(module,target){var name=typeof target=="function"?target.name:target;function get_orig(){var s=module.Player.super_,proto_fn=s&&s.prototype[name];return typeof target=="string"&&proto_fn?proto_fn:target}module.Player.prototype[name]=function(a1,a2,a3){var len=arguments.length,mod_fn=this.module&&this.module[name];var fn=mod_fn||get_orig(),fn_this=mod_fn?this.module:this;if(typeof fn!="function")return;switch(len){case 0:return fn.call(fn_this);case 1:return fn.call(fn_this,a1);case 2:return fn.call(fn_this,a1,a2);case 3:return fn.call(fn_this,a1,a2,a3);default:var args=new Array(len);for(var i=0;i<len;i++)args[i]=arguments[i];return fn.apply(fn_this,args)}};module.Player.prototype[name].orig=get_orig};E.call_super=function(module,pl,name){var in_len=arguments.length,s,fn,out_len=in_len-3;if(!(s=module.Player?module.Player.super_:module.super_))return;var a=new Array(out_len>0?out_len:0);for(var i=3;i<in_len;i++)a[i-3]=arguments[i];return name?(fn=s.prototype[name])&&fn.apply(pl,a):s.apply(pl,a)};E.create_forwarding_emit=function(player){var events=(player.module||{}).event_list,_events,in_call=false;if(!events)return;function forward_fn(e){return function(o1,o2){if(in_call)return;in_call=true;try{player.old_emit(e,o1,o2)}finally{in_call=false}}}player.old_emit=player.old_emit||player.emit;player.emit=function(e,o1,o2){return!events.includes(e)&&player.old_emit(e,o1,o2)};_events=events.map(function(e){return{name:e,cb:forward_fn(e)}});_events.forEach(function(e){player.module.on(e.name,e.cb)});return function(){delete player.old_emit;delete player.emit;_events.forEach(function(e){player.module.off(e.name,e.cb)})}};E.resolve_url=function(base_url,path){var m=path.match(/^([^:\/?#]+:)?(?:\/\/(?:([^:@\/?#]*)(?::([^:@\/?#]*))?@)?((?:[^:\/?#]*)(?::(?:\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);var protocol=m[1]||"";var user=m[2]||"";var password=m[3]||"";var host=m[4]||"";var pathname=m[5]||"";var search=m[6]||"";var hash=m[7]||"";if(!/(\w+:)?\/\//.test(base_url))base_url=E.resolve_url(location.href,base_url);var base=zurl.parse(base_url);var is_full=!!protocol||!!host||!!user;if(!is_full&&!pathname&&!search)search=base.search||"";if(!is_full&&pathname.charAt(0)!="/"){pathname=pathname?((base.host||base.user)&&!base.pathname?"/":"")+base.pathname.slice(0,base.pathname.lastIndexOf("/")+1)+pathname:base.pathname}var output=[];pathname.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(p){if(p=="/..")output.pop();else output.push(p)});pathname=output.join("").replace(/^\//,pathname.charAt(0)=="/"?"/":"");if(!is_full){host=base.host;password=base.password;user=base.user}if(!protocol)protocol=base.protocol;return protocol+"//"+(user?user+(password?":"+password:"")+"@":"")+host+pathname+search+hash};var swf_versions=[{match:{jwplayer_version:[7,11,0]},expected:[1,0,37]},{match:{jwplayer_version:[7,10,1]},expected:[1,0,36]},{match:{jwplayer_version:[7,7]},expected:[1,0,35]},{match:{jwplayer_version:[7]},expected:[1,0,34]},{match:{jwplayer_version:[6]},expected:[1,0,28]}];var min_hola_player_version=[5,10];function check_ver(version,exp){if(exp=="*")return true;var actual=(version||"").split(".");for(var i=0,l=exp.length;i<l;i++){var act_i=actual[i]|0;if(exp[i]<act_i)return true;if(exp[i]>act_i)return false}return true}E.is_old_hola_player=function(ver){return ver&&!check_ver(ver,min_hola_player_version)};E.is_old_swf=function(ver){if(!ver)return;for(var i=0,l=swf_versions.length;i<l;i++){var rule=swf_versions[i];var matches=Object.keys(rule.match);function check_player(p){return ver[p]&&check_ver(ver[p],rule.match[p])}if(matches.some(check_player))return!check_ver(ver.patch_version,rule.expected)}};E.is_enabled=function(module){return!!module&&!module.__stub};E.assert_enabled=function(module,message){if(!E.is_enabled(module))throw new Error(message||"module is disabled")};E.log_report=function(opt){var bws=opt.video_ctx&&opt.video_ctx.attached_bws;var stats=opt.video_ctx&&opt.video_ctx.attached_stats;if(!opt.zone&&!bws&&!stats||!opt.id)return;if(!opt.add_unittest&&!opt.add_log&&!opt.load_perf&&!opt.exception)return;var zone=(bws||stats||opt).zone;if(!zone)return;var zperr=zone.perr_get();var o={id:opt.id+"_report",delay:false,info:{only_stats:!bws},extra:assign({},opt.extra,!opt.exception&&stats&&stats.get_stats_all()),use_beacon:true,add_log:opt.add_log,log_types:opt.log_types,log_modules:opt.log_modules,analysis_tag:opt.analysis_tag,log_obj:opt.log_obj,full:opt.full,player_logs:opt.player_logs};if(zone.CG("log.full"))o.full=true;if(opt.add_unittest&&bws)o.filehead="last test:\n"+bws.unittest.gen_test();if(bws&&bws.serve_log_arr.length)o.info.serve_log=bws.serve_log_arr;if(opt.load_perf){o.filehead=(o.filehead?o.filehead+"\n":"")+"Load perf:\n";o.filehead+=opt.load_perf;o.info.load_perf=true}if(opt.exception)o.info.exception=opt.exception;zperr(o)};E.get_random=function(salt){var key="hola_random_"+salt;var force=+E.get_spark_uri(key,false);if(force){log.notice("force %s random %s",salt,force);return force}if(E.gconf_get("loader.real_random")){var saved=storage.get_int(key);if(saved)return saved;var random=rand.rand("random_from_storage");storage.set(key,random);return random}E.get_random.salt=E.get_random.salt||{};var ip=E.geoip&&E.geoip.ip;if(E.get_random.salt[salt])return E.get_random.salt[salt];if(!ip){log.info("no ip, using random");if(!E.get_random.salt[salt])E.get_random.salt[salt]=rand.rand("random_by_ip")}else{E.get_random.salt[salt]=parseInt(md5(ip+salt).slice(-4),16)/Math.pow(2,16)}return E.get_random.salt[salt]};E.is_hola_hls_js=function(hls){return!!zutil.get(hls,"streamController.onFragChunkLoaded")};E.is_hola_hls_js_constructor=function(Hls){if(Hls.is_hola_hls===undefined){var test=new Hls;Hls.is_hola_hls=E.is_hola_hls_js(test);test.destroy()}return Hls.is_hola_hls};E.get_hls_sc=function(hls){return hls.streamController||hls.mediaController};E.def_hola_hls_config=function(conf_get){var ret={fragLoadingLoopThreshold:1e3,manifestLoadingTimeOut:20*date.ms.SEC,manifestLoadingMaxRetry:4,levelLoadingTimeOut:20*date.ms.SEC,levelLoadingMaxRetry:4};conf_get=conf_get||E.gconf_get;assign(ret,conf_get("loader.dailymotion.config")||{});return ret};E.get_size_name=function(width,height){if(!isFinite(width)||!isFinite(height))return"unknown";return Math.round(width/100)*100+"x"+Math.round(height/100)*100};E.get_width_name=function(width){return!isFinite(width)||width<=0?"width_unknown":width<300?"width_300":width<600?"width_600":width<900?"width_900":width<1200?"width_1200":"width_over_1200"};E.get_height_name=function(height){return!isFinite(height)||height<=0?"height_unknown":height<300?"height_300":height<600?"height_600":height<900?"height_900":height<1200?"height_1200":"height_over_1200"};E.get_top_name=function(){if(typeof window=="undefined")return;var ret={name:window.name};if(window.top!=window)try{ret.root_name=window.top.name}catch(e){}ret.name=ret.root_name||ret.name;return ret.name};E.get_top_url=function(loaded_in_debug){return E.get_location_urls(loaded_in_debug).top_url};E.get_location_urls=function(loaded_in_debug){if(typeof window=="undefined")return{};var ret={top_url:loaded_in_debug||location.href};if(window.top!=window){ret.referrer=document.referrer;ret.frame_url=location.href;try{ret.root_top_url=window.top.location.href}catch(e){}}ret.top_url=ret.root_top_url||ret.referrer||ret.top_url;return ret};E.referrer_type=function(url,ref,regex){if(!ref)return"none";var url_host=zurl.get_host(url),ref_host=zurl.get_host(ref);if(!url_host||!ref_host)return"invalid";return(regex?regex.test(ref_host):url_host==ref_host)?"internal":"external"};E.data_snapshot=function(data,fields){var past=zutil.clone_deep(data);fields=fields||Object.keys(data);return{diff:function(now){var res=zutil.clone_deep(now);fields.forEach(function(path){var val_past=zutil.get(past,path);var val_now=zutil.get(now,path);var val_res=typeof val_past=="number"&&typeof val_now=="number"?val_now-val_past:val_now;zutil.set(res,path,val_res)});return res}}};function read_i32(s){return parseInt(s.slice(0,2),16)|parseInt(s.slice(2,4),16)<<8|parseInt(s.slice(4,6),16)<<16|parseInt(s.slice(6,8),16)<<24}E.hrw_get=function(url){var hash=md5(url);return{a:read_i32(hash.slice(0,8))|0,b:read_i32(hash.slice(8,16))|0}};function hrw_rand(v){return 1103515245*(v|0)+12345|0}E.hrw_rank=function(shard_md5_int,key_md5_int){var v=hrw_rand(shard_md5_int.a);v=hrw_rand(v+key_md5_int.a);v=hrw_rand(v+shard_md5_int.b);v=hrw_rand(v+key_md5_int.b);return v};E.def_url2cache=function(_url){return _url.replace(/([^?#]+).*/,"$1")};E.page2cache=function(url,zone){url=url.replace(/\/\/www\./,"//");if((!zone||!zone.is_agent)&&E.CG("transform.page2cache")){url=E.gconf_apply("transform.page2cache",[url,{mobile:E.is_mobile}],E.def_url2cache(url))}else if(zone){url=zone.conf_apply("agent.page2cache",[url,{mobile:E.is_mobile}],E.def_url2cache(url))}return url.replace(/^((?:http|https):)?(\/\/)?/i,"http://")};E.def_page2domain=function(url){return url&&(zurl.parse(url).hostname||"").replace(/^www\./,"")};E.page2domain=function(url){return E.gconf_apply("transform.page2domain",[url],E.def_page2domain(url))};E.page2link=function(url){return E.gconf_apply("transform.page2link",[url],url)};E.url2videotype=function(url){return E.gconf_apply("transform.url2videotype",[url])};E.player2offset=function(player){return E.gconf_apply("transform.player2offset",[player],0)};E.url2category=function(url){return E.gconf_apply("transform.url2category",[url])};E.show_url2category=function(url){return E.gconf_apply("transform.show_url2category",[url])||E.url2category(url)};E.url2lang=function(url){return E.gconf_apply("transform.url2lang",[url])};E.video2cache=function(url,zone,adaptive){if((!zone||!zone.is_agent)&&E.CG("transform.url2cache")){url=E.gconf_apply("transform.url2cache",[url],E.def_url2cache(url))}else{url=zone.conf_apply(adaptive?"agent.manifest2cache":"agent.url2cache",[url],E.def_url2cache(url))}return E.strip_hostname(url)};E.segment2cache=function(url){return E.strip_hostname(E.gconf_apply("transform.segment2cache",[url],E.def_url2cache(url)))};E.video2type=function(url){return E.gconf_apply("transform.video2type",[url],url)};E.game_title=function(url){return E.gconf_apply("transform.game_title",[url],function(u){return u.replace(/ -.*$/,"")})};E.strip_hostname=function(url){return url.replace(/^(https?:)?\/\/([^\/]+)/,"")};E.err_ex=function(err,opt){var e=new Error(err);assign(e,opt);return e};E.parse_segment_url=function(s,opt){var url=zurl.parse(s);if(!opt.proxy)return url;var proxy_path_re=new RegExp(url.hostname+"/"+E.conf.customer+"/"+opt.zone+"/");var hola_param_re=/[?&]hola.*$/;var hola_playlist_re=/.*[?&]hola.*playlist=([^&]*).*/;var hola_manifest_re=/.*[?&]hola.*manifest=([^&]*)$/;url=zurl.parse(s.replace(proxy_path_re,"").replace(hola_param_re,""));var force=url.force_params={};if(hola_playlist_re.test(s))force.playlist=decodeURIComponent(s.replace(hola_playlist_re,"$1"));if(hola_manifest_re.test(s))force.manifest=decodeURIComponent(s.replace(hola_manifest_re,"$1"));return url};E.get_stylesheet=function(styles){var res=[];for(var selector in styles){var keys=Object.keys(styles[selector]).filter(function(key){return!!styles[selector][key]});var css=keys.map(function(key){return"    "+key+": "+styles[selector][key]+";\n"});if(css.length)res.push(selector+" {\n"+css.join("")+"}")}return res.join("\n")};E.stack_to_pprint=function(str){return str&&str.replace(/^Error/,"")};E.debounce=function(func,wait){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;func.apply(context,args)};clearTimeout(timeout);timeout=setTimeout(later,wait)}};E.throttle=function(func,wait){var ctx,args,rtn,timeout;var last=0;var call=function(){timeout=null;last=new Date;rtn=func.apply(ctx,args);ctx=null;args=null};return function(){ctx=this;args=arguments;var delta=new Date-last;if(!timeout){if(delta>=wait)call();else timeout=setTimeout(call,wait-delta)}return rtn}};E.clone_class=function(c){var n=function(){return c.apply(this,arguments)};n.prototype=c.prototype;return Object.assign(n,c)};E.wrap_onclick=function(el,cb,opt){opt=opt||{};function get_touch_pos(e,coord){return e.changedTouches?e.changedTouches[0][coord]:e[coord]}function is_same_coord(c1,c2){return Math.abs(c1-c2)<10}function on_touchstart(e){ctx.starts=date.monotonic();ctx.startx=get_touch_pos(e,"pageX");ctx.starty=get_touch_pos(e,"pageY")}function on_touchend(e){var dur=E.ms_since(ctx.starts);var click_ival=opt.click_ival||{from:0,to:700};if(is_same_coord(ctx.startx,get_touch_pos(e,"pageX"))&&is_same_coord(ctx.starty,get_touch_pos(e,"pageY"))&&dur>click_ival.from&&dur<click_ival.to){cb(e)}}var ctx={};el.on("touchstart",on_touchstart);el.on("touchend",on_touchend);return function(){el.off("touchstart",on_touchstart);el.off("touchend",on_touchend)}};E.wrap_play=function(v){var p=v.play();if(p&&p.catch)return p;if(v.paused)return etask.reject("play refused");var ret=etask.wait();var listener=function(e){v.removeEventListener("playing",listener);v.removeEventListener("error",listener);v.removeEventListener("abort",listener);v.removeEventListener("pause",listener);if(e.type=="playing")return ret.return();var err="not playing: "+e.type,msg;if(e.type=="error"&&(msg=v.error&&v.error.message))err+=", "+msg;ret.throw(err)};v.addEventListener("playing",listener);v.addEventListener("error",listener);v.addEventListener("abort",listener);v.addEventListener("pause",listener);return ret};var script_timing;E.get_script_timing=function(){if(script_timing)return script_timing;if(!window||!window.performance)return;var timing={};if(window.performance.timing){var t=window.performance.timing;timing.nav_start=t.navigationStart;timing.page_load_ms=t.domContentLoadedEventEnd-t.navigationStart}if(window.performance.now)timing.script_load_ms=window.performance.now();if(window.performance.getEntries){var entries=window.performance.getEntries();var m=new RegExp("//player.h-cdn.com/(loader_[^/]+.js|"+"loader.js\\?.*customer=)");for(var i=0;i<entries.length;i++){var e=entries[i];if(!m.test(e.name))continue;timing.connect_ms=e.connectEnd-e.connectStart;timing.dns_ms=e.domainLookupEnd-e.domainLookupStart;timing.duration_ms=e.duration;timing.redirect_ms=e.redirectEnd-e.redirectStart;timing.response_ms=e.responseEnd-e.responseStart;timing.response_end_ms=e.responseEnd;if(timing.script_load_ms&&timing.response_end_ms)timing.init_ms=timing.script_load_ms-timing.response_end_ms;break}}return script_timing=timing};E.t={bin2json:bin2json,ws_onmessage:E.ws.prototype.onmessage};return E})})();
define("/svc/cdn/pub/watermark.js",["cash","/util/util.js","/svc/cdn/pub/util.js"],function($,zutil,util){var E=Watermark;var def_styles={".hola_watermark.hola_hidden":{visibility:"hidden",opacity:"0"},".hola_watermark":{position:"absolute !important","z-index":"999","max-width":"50px","max-height":"50px","min-width":"20px","min-height":"20px",width:"30%",height:"40%",opacity:"1",transition:"opacity 0.5s ease-in-out","pointer-events":"auto","background-size":"contain","background-repeat":"no-repeat","background-image":"url(//ve.h-cdn.com/svc/preview/pub/img/watermark-contour.svg)"},".hola_watermark.rel_x":{},".hola_watermark.rel_y":{},".hola_watermark:hover":{"background-image":"url(//ve.h-cdn.com/svc/preview/pub/img/watermark-contour.svg)"},".hola_watermark:hover .hola_hint":{visibility:"visible"},".hola_watermark:hover .hola_hint.hola_hidden":{visibility:"hidden"},".hola_watermark .hola_hint::after":{display:"inline-block","align-self":"center",content:"''",width:"0",position:"absolute",height:"0","border-style":"solid"},".hola_watermark .hola_hint::before":{display:"inline-block","align-self":"center",content:"''",width:"0",position:"absolute",height:"0","border-style":"solid"},".hola_watermark .hola_hint":{visibility:"hidden","box-shadow":"0 2px 2px 0 rgba(17, 42, 52, 0.69)","text-align":"center",display:"inline-block","align-self":"center","line-height":"20px","font-size":"14px",position:"relative","border-radius":"4px","border-style":"solid","border-width":"1px",padding:"8px 15px","white-space":"nowrap"}};var def_settings={corner:"top-right",max_icon_shift:{x:"8px",y:"8px"},icon_shift:{x:"2%",y:"4%"},hint_shift:{x:"0px",y:"auto"},hint_bg:"white",hint_fg:"rgba(0, 82, 113, 0.82)",hint_pointer_shift:"auto",hint_pointer_size:"10px",hint_text:"Powered by Hola Spark"};function Watermark(spark,opt){opt=zutil.extend_deep({},zutil.clone_deep(def_settings),zutil.clone_deep(opt));if(!(this instanceof Watermark)){if(!opt.enable&&!/show_hola_icon/.test(window.location.href))return;return new Watermark(spark,opt)}var _this=this;this.spark=spark;this.customer=opt.customer;this.module=opt.module;this.css_name=opt.module+"_watermark";this.stats=_this.spark.stats.alloc(_this.module+".watermark");var styles={},style;var conf_styles=zutil.extend_deep({},zutil.clone_deep(def_styles),opt.extra_css,opt.extra_css_fn?opt.extra_css_fn():undefined);for(style in conf_styles){styles[style.replace(".hola_watermark","."+this.css_name)]=conf_styles[style]}var fix_px=function(size){return/\d$/.test(""+size)?size+"px":size};var wm_style=styles["."+this.css_name];if(opt.static){opt.delay=function(duration,pos){return 0};Object.assign(wm_style,{height:"10%",width:"auto","max-height":"140px","max-width":"140px",transition:null})}this.delay=opt.delay;if(opt.icon_url)wm_style["background-image"]="url("+opt.icon_url+")";if("icon_hover_url"in opt){styles["."+this.css_name+":hover"]["background-image"]=opt.icon_hover_url?"url("+opt.icon_hover_url+")":null}if(typeof opt.corner=="string"){opt.corner={topright:0,bottomright:1,bottomleft:2,topleft:3,tr:0,br:1,bl:2,tl:3}[opt.corner.toLowerCase().replace(/[-_]+/g,"")]}opt.corner=Math.min(3,Math.max(0,opt.corner||0))|0;opt.max_icon_shift=opt.max_icon_shift||{};var x_shift=opt.corner==0||opt.corner==1?"right":"left";var y_shift=opt.corner==0||opt.corner==3?"top":"bottom";var iy_shift=opt.corner==0||opt.corner==3?"bottom":"top";wm_style[x_shift]=fix_px(opt.max_icon_shift.x);wm_style[y_shift]=fix_px(opt.max_icon_shift.y);opt.icon_shift=opt.icon_shift||{};styles["."+this.css_name+".rel_x"][x_shift]=fix_px(opt.icon_shift.x);styles["."+this.css_name+".rel_y"][y_shift]=fix_px(opt.icon_shift.y);var icon_shift={rel_x:/%$/.test(opt.icon_shift.x),rel_y:/%$/.test(opt.icon_shift.y),x:parseInt(opt.icon_shift.x),y:parseInt(opt.icon_shift.y),max_x:parseInt(opt.max_icon_shift.x),max_y:parseInt(opt.max_icon_shift.y)};this.use_rel=function(cont,axis){var shift=1;if(icon_shift["rel_"+axis])shift=(axis=="x"?$(cont).width():$(cont).height())/100;return icon_shift["max_"+axis]>shift*icon_shift[axis]};wm_style["background-position-x"]=x_shift=="right"?"100%":"0%";wm_style["background-position-y"]=y_shift=="bottom"?"100%":"0%";var hint_style=styles["."+this.css_name+" .hola_hint"];var hint_style_a=styles["."+this.css_name+" .hola_hint::after"];var hint_style_b=styles["."+this.css_name+" .hola_hint::before"];hint_style_a[iy_shift]="100%";hint_style_b[iy_shift]="100%";var color_rotate=function(c){return y_shift=="top"?"transparent transparent "+c:c+" transparent transparent"};hint_style_a["border-color"]=color_rotate(opt.hint_bg);hint_style_b["border-color"]=color_rotate(opt.hint_fg);hint_style.background=opt.hint_bg;hint_style["border-color"]=opt.hint_fg;hint_style.color=opt.hint_fg;if(opt.hint_pointer_shift=="auto"){this.hint_pointer_shift="auto";delete opt.hint_pointer_shift}opt.hint_pointer_shift=parseInt(opt.hint_pointer_shift||"8px");hint_style_a[x_shift]=opt.hint_pointer_shift+"px";hint_style_b[x_shift]=opt.hint_pointer_shift-1+"px";opt.hint_pointer_size=this.hint_pointer_size=parseInt(opt.hint_pointer_size);hint_style_a["border-width"]=opt.hint_pointer_size+"px";hint_style_b["border-width"]=opt.hint_pointer_size+1+"px";opt.hint_shift=opt.hint_shift||{};if(opt.hint_shift.y=="auto"){opt.hint_shift.y=y_shift=="top"?"calc(100% + "+(opt.hint_pointer_size+1)+"px)":(parseInt(hint_style["line-height"])||0)+(parseInt(hint_style.padding)||0)*2+(parseInt(hint_style["border-width"])||0)*2+opt.hint_pointer_size+1+"px"}hint_style[y_shift]=fix_px(opt.hint_shift.y);this.hint_shift=parseInt(opt.hint_shift.x);if(x_shift=="left"){hint_style[x_shift]=this.hint_shift+"px";delete this.hint_shift}this.hint_text=opt.hint_text;this.doc=opt.doc||document;this.x_shift=x_shift;var old_fallback=this.x_shift=="top"?"."+this.css_name+" .hola_hint {\n    top: 110%;\n}\n":"";$(this.doc).find("head").append("<style>"+old_fallback+util.get_stylesheet(styles)+"</style>")}Watermark.prototype.pause=function(){this.paused=true};Watermark.prototype.resume=function(after){var _this=this;this.rm_resume=setTimeout(function(){_this.rm_resume=clearTimeout(_this.rm_resume);_this.paused=false;if(_this.last_duration_change)_this.last_duration_change()},after)};Watermark.prototype.apply=function(opt){if(this.container)this.remove(this.container);this.container=opt.container;var hint=this.hint=this.doc.createElement("div");$(hint).addClass("hola_hint hola_top_element");$(hint).html(this.hint_text);var pic=this.pic=this.doc.createElement("div");pic.appendChild(hint);$(pic).addClass(this.css_name);$(pic).addClass("hola_hidden");this.style=this.doc.createElement("style");pic.appendChild(this.style);this.link=this.doc.createElement("a");var cam="wm_"+this.module+"_"+this.customer;$(this.link).attr("href","http://holaspark.com?cam="+cam);$(this.link).attr("target","_blank");$(this.link).attr("style","position: static !important;");this.link.appendChild(pic);opt.container.appendChild(this.link);var _this=this;this.rm_dur=on_duration_change(opt.v,function(duration){var _pic=_this.pic;if(!duration||!_pic||!$(_pic).hasClass("hola_hidden"))return;var cb=_this.last_duration_change=function(){_this.rm_dur=clearTimeout(_this.rm_dur);if(_this.paused)return;delete _this.last_duration_change;var pos=opt.v.currentTime||opt.v.get_pos&&opt.v.get_pos()||0;var opt_delay=_this.delay&&_this.delay(duration,pos)||0;var delay=Math.max(0,opt_delay)*1e3;_this.rm_dur=setTimeout(function(){$(_pic).removeClass("hola_hidden")},delay)};var html5=opt.v.html5||window.HTMLMediaElement&&opt.v instanceof window.HTMLMediaElement&&opt.v;if(html5){$(html5).on("playing",cb);$(html5).on("seeked",cb)}cb()});$(pic).one("mouseenter",this.on_size_known.bind(this,opt));this.rm_size=setTimeout(this.on_size_known.bind(this,opt),0);this.rm_size_ensure=setTimeout(this.on_size_known.bind(this,opt),5e3);this.stats.inc("apply_n")};Watermark.prototype.on_size_known=function(opt){if(!this.hint||!this.pic)return;var hint=this.hint,pic=this.pic;var small_for_hint=$(opt.container).innerWidth()<=$(hint).outerWidth()||$(opt.container).innerHeight()<=$(hint).outerHeight()+$(pic).height();ensure_class(hint,small_for_hint,"hola_hidden");ensure_class(pic,this.use_rel(opt.container,"x"),"rel_x");ensure_class(pic,this.use_rel(opt.container,"y"),"rel_y");if(this.hint_pointer_shift=="auto"){var hint_pointer_shift=Math.max(1,(Math.min($(pic).innerWidth(),$(pic).innerHeight())>>1)-this.hint_pointer_size);var styles={},elements=["after","before"];for(var i=0;i<elements.length;i++){var s=styles["."+this.css_name+" .hola_hint::"+elements[i]]={};s[this.x_shift]=hint_pointer_shift-i+"px"}$(this.style).text(util.get_stylesheet(styles))}if(!("hint_shift"in this))return;$(hint).css("right",$(hint).innerWidth()+this.hint_shift-$(pic).innerWidth()+"px")};Watermark.prototype.remove=function(container){if(container&&container!=this.container)return;this.container=null;this.rm_size=clearTimeout(this.rm_size);this.rm_size_ensure=clearTimeout(this.rm_size_ensure);this.rm_dur=clearTimeout(this.rm_dur);this.rm_resume=clearTimeout(this.rm_resume);if(this.hint){$(this.hint).remove();this.hint=null}if(this.pic){$(this.pic).remove();this.pic=null}if(this.link){$(this.link).remove();this.link=null}if(this.style){$(this.style).remove();this.style=null}this.stats.inc("remove_n")};function ensure_class(elem,cond,c){$(elem)[cond?"addClass":"removeClass"](c)}function on_duration_change(player,cb,sync){var html5=player.html5||window.HTMLMediaElement&&player instanceof window.HTMLMediaElement&&player;var duration=html5&&html5.duration||player.get_duration&&player.get_duration()||0;if(duration||sync)return void cb(duration==Infinity?60:duration);if(html5){return void $(html5).on("durationchange",on_duration_change.bind(null,player,cb,true))}return setTimeout(on_duration_change.bind(null,player,cb),1e3)}return E});
define("/svc/cdn/pub/dom_util.js",["cash"],function($){var E={};function class_re(cls){return new RegExp("(^|\\s)"+cls+"($|\\s)")}E.get_elm_resolution=function(elm){var st=elm&&getComputedStyle(elm);if(!st||isNaN(parseInt(st.width))||isNaN(parseInt(st.height)))return;var full_screen=!(document.fullScreenElement===null||document.msFullscreenElement===null||document.mozFullScreen!==undefined&&!document.mozFullScreen||document.webkitIsFullScreen!==undefined&&!document.webkitIsFullScreen);return{width:parseInt(st.width,10),height:parseInt(st.height,10),full_screen:full_screen}};E.get_full_elm_selector=function(elm,skip_class){return elm.tagName.toLowerCase()+(elm.id?"#"+elm.id:"")+(skip_class||!elm.className?"":(" "+elm.className).replace(/\s+/g,"."))};E.get_elm_selector_path=function(elm,skip_class){return $(elm).add($(elm).parents()).map(function(el){return E.get_full_elm_selector(el,skip_class)}).reverse().join(">")};E.closest=function(elm,selector){if(elm.closest)return elm.closest(selector);if(elm.matches){if(!document.documentElement.contains(elm))return null;do{if(elm.matches(selector))return elm;elm=elm.parentElement}while(elm)}return null};E.matches=function(elm,selector){var method=["matches","matchesSelector","mozMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector"].find(function(m){return typeof elm[m]=="function"});if(method)return elm[method](selector);var matches=(elm.document||elm.ownerDocument).querySelectorAll(selector);var i=matches.length;while(--i>=0&&matches.item(i)!=elm);return i>-1};E.remove=function(elm){if(elm.parentNode)elm.parentNode.removeChild(elm)};E.has_class=function(elm,cls){if(elm.classList)return elm.classList.contains(cls);return class_re(cls).test(elm.className)};E.is_visible=function(elem){return!!(elem&&(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length))};E.detect_direction=function(elem){var dir="ltr",w=window;for(;;){var styles=getComputedStyle(elem);if(!styles)break;var d=styles.direction;if(d!=dir){dir=d;break}try{if(!(elem=w.frameElement))break;elem=elem.parentElement;w=w.parent;continue}catch(e){break}}return dir};E.space_occupied=function(container,element){var top=Math.max(container.top,element.top);var right=Math.min(container.right,element.right);var bottom=Math.min(container.bottom,element.bottom);var left=Math.max(container.left,element.left);if(top>=bottom||left>=right)return 0;return(bottom-top)*(right-left)/((element.bottom-element.top)*(element.right-element.left))};E.visual_viewport=function(){var vp;if(vp=window.visualViewport){return{top:vp.offsetTop,bottom:vp.offsetTop+vp.height,left:vp.offsetLeft,right:vp.offsetLeft+vp.width,height:vp.height,width:vp.width}}var root_rect=document.documentElement.getBoundingClientRect();return{top:root_rect.top+window.pageYOffset,bottom:root_rect.top+window.pageYOffset+window.innerHeight,left:root_rect.left+window.pageXOffset,right:root_rect.left+window.pageXOffset+window.innerWidth,height:window.innerHeight,width:window.innerWidth}};E.client_rect2page_rect=function(rect){var root_rect=document.documentElement.getBoundingClientRect();return{top:rect.top-root_rect.top,bottom:rect.bottom-root_rect.bottom,left:rect.left-root_rect.left,right:rect.right-root_rect.right,height:rect.height,width:rect.width}};E.in_front=function(el,rect){rect=rect||$(el)[0].getBoundingClientRect();var w=rect.width||rect.right-rect.left;var h=rect.hight||rect.bottom-rect.top;var p=$(document.elementFromPoint(rect.left+w/2,rect.top+h/2));return p.closest(el).length||$(el).closest(p.parent()).length};return E});
define("/svc/cdn/pub/play_icon.js",["cash","/svc/cdn/pub/util.js","/util/date.js","/util/etask.js","/svc/cdn/pub/dom_util.js"],function($,util,date,etask,dom_util){var E={};var svg_shadow='<defs><filter id="shadow%id%">'+'<feDropShadow dx="0" dy="0" stdDeviation="2"/></filter></defs>';var max_logo_size=30;var def_styles={".hola_preview_icon":{position:"absolute","pointer-events":"none"},".hola_preview_icon svg":{width:"100%",height:"100%",fill:"#ffffff",stroke:"#ffffff"},".hola_preview_icon_countdown .icon-bg":{filter:"url(#shadow)"},".hola_preview_playing .hola_preview_icon":{visibility:"hidden"},".hola_preview_no_icon .hola_preview_icon":{visibility:"hidden"},".hola_preview_playing .hola_preview_icon_countdown":{visibility:"visible","z-index":"9999999"},".hola_preview_playing.hola_preview_blur .hola_preview_icon":{visibility:"visible","z-index":"9999999"},".hola_preview_icon .hola_preview_icon_cancel":{display:"block !important",height:"auto !important",width:"auto !important","line-height":"normal !important",margin:"0 -100% !important",padding:"0 1px !important","text-align":"center !important",color:"#fff !important","text-shadow":"0 0 2px #000 !important","transform-origin":"50% 0 !important","font-size":"12px !important","white-space":"nowrap !important","pointer-events":"auto !important",cursor:"pointer !important"},".hola_preview_icon .hola_preview_icon_cancel:hover":{transform:"scale(1.1)"},".hola_preview_icon .hola_preview_icon_cancel:after":{content:"",display:"none !important"},".hola_preview_icon .hola_preview_icon_cancel:before":{content:"",display:"none !important"}};function on_img_load(img,cb){var off,unwatch;var on_load=function(){off();if(img.style.display!="none")return void cb();unwatch=util.attr_watch(img,{attr:"style",watch_fn:function(){if(img.style.display=="none")return;unwatch();unwatch=null;cb()}})};off=function(){$(img).off("load",on_load)};$(img).on("load",on_load);return function(){off();if(unwatch)unwatch($(img).off("load",on_load))}}function is_img_loaded(img){return img.width>1&&img.naturalWidth>1}function get_icon_pos_size(opt){var pos=opt.pos;if(typeof pos=="function")pos=pos();var size=opt.size_px?opt.size_px:(opt.size||.25)*pos.height+(opt.shadow?10:0);var top,left,loc=(opt.location||"center").split("-");var margin=opt.get_margin?opt.get_margin(size):opt.margin||10;if(loc[0]=="center"){left=(pos.width-size)/2;top=(pos.height-size)/2}else{top=loc[0]=="top"?margin:pos.height-size-margin;left=loc[1]=="left"?margin:pos.width-size-margin}return{pos:pos,top:top,left:left,size:size}}var logo_svg=[["M34,82.4c0,20.2,16.1,36.6,36,36.6s36-16.3,36-36.6c0-24.6-28-32.8-36-"+"61.4C62,49.7,34,57.8,34,82.4z M57,69 c2.7,0,5,3.1,5,7s-2.1,7-5,7c-2.6,"+"0-5-3.1-5-7S54.3,69,57,69z M98,83c0,15.4-12.6,28-28,28S42,98.4,42,"+"83h4c1,14,11.4,23.7,24,24 c12.7-0.3,23-10,24-24H98z M83,69c2.7,0,5,3.1,"+"5,7s-2.3,7-5,7s-5-3.1-5-7S80.3,69,83,69z","97,28 93,24 90,21 86,25 83,28 87,32 90,35 94,31","27.5,56 24.3,59.2 21,62.5 24.2,65.7 27.5,69 30.8,65.7 34,62.5 30.8,59.2","109.9,38.1 105,29 100.1,38.1 91,43 100,48 105,57 109.9,47.9 119,43","38,55 44,44 55,38 44,32 38,21 32,32 21,38 31.9,44.1"],["M34,82.4c0,20.2,16.1,36.6,36,36.6s36-16.3,36-36.6c0-24.6-28-32.8-36-"+"61.4C62,49.7,34,57.8,34,82.4z M90,69 c2,0,3.7,3.1,3.7,7S92,83,90,"+"83s-3.7-3.1-3.7-7S88,69,90,69z M98.1,83h2.9c0,15.4-9.2,28-20.5,28S60,"+"98.4,60,83h2.9 c0.7,14,8.4,23.7,17.6,24C89.8,106.7,97.3,97,98.1,83z "+"M74.7,76c0,3.9-1.6,7-3.7,7c-1.9,0-3.7-3.1-3.7-7s1.7-7,3.7-7 S74.7,72.1,"+"74.7,76z","101,30 96,25 92,21 87,26 83,30 88,35 92,39 97,34","29.5,50 25.3,54.2 21,58.5 25.3,62.8 29.5,67 33.8,62.7 38,58.5 33.7,54.2","111.2,40.8 107,33 102.8,40.8 95,45 102.7,49.3 107,57 111.2,49.2 119,45","40,51 45.3,41.3 55,36 45.3,30.7 40,21 34.7,30.7 25,36 34.6,41.4"],["M33.9,82.5c0,20.2,16.1,36.6,36,36.6c10.8,0,20.4-4.8,27-12.3C92.8,101.7,"+"90,92.9,90,83h2.1c0.4,9.6,3.1,17.1,6.9,21.1 c4.4-6,6.9-13.5,6.9-21.6"+"c0-24.6-28-32.8-36-61.4C61.9,49.8,33.9,57.9,33.9,82.5z M98,69c1.5,0,2.7,"+"3.1,2.7,7s-1.1,7-2.7,7 c-1.4,0-2.7-3.1-2.7-7S96.6,69,98,69z","112,43 108,47 105,50 109,54 112,57 116,53 119,50 115,46","44,47 48.6,38.6 57,34 48.6,29.4 44,21 39.4,29.4 31,34 39.4,38.6","43,54 35.9,50.1 32,43 28.1,50.1 21,54 28.1,57.9 32,65 35.9,57.9","95,49 99.9,39.9 109,35 99.9,30.1 95,21 90.1,30.1 81,35 90,40"],["M34,82.4c0,20.2,16.1,36.6,36,36.6s36-16.3,36-36.6c0-24.6-28-32.8-36-"+"61.4C62,49.7,34,57.8,34,82.4z","113,48 110,51 107,54 110,57 113,60 116,57 119,54 116,51","57,28 53,24 50,21 46,25 43,28 47,32 50,35 54,31","99,53 104.7,42.7 115,37 104.7,31.3 99,21 93.3,31.3 83,37 93.3,42.7","39.3,50.3 48,45.5 39.3,40.7 34.5,32 29.7,40.7 21,45.5 29.7,50.3 34.5,59"],["M34,82.4c0,20.2,16.1,36.6,36,36.6s36-16.3,36-36.6c0-24.6-28-32.8-36-"+"61.4C62,49.7,34,57.8,34,82.4z","114,48 111,51 109,53 112,56 114,58 117,55 119,53 116,50","55,27 52,24 49,21 46,24 43,27 46,30 49,33 52,30","106.7,32.3 100.5,21 94.3,32.3 83,38.5 94.2,44.8 100.5,56 106.7,44.7 118,"+"38.5","41.3,49.3 51,44 41.3,38.7 36,29 30.7,38.7 21,44 30.6,49.4 36,59"],["M34,82.4c0,20.2,16.1,36.6,36,36.6s36-16.3,36-36.6c0-24.6-28-32.8-36-"+"61.4C62,49.7,34,57.8,34,82.4z","113,48 110,51 107,54 110,57 113,60 116,57 119,54 116,51","57,28 53,24 50,21 46,25 43,28 47,32 50,35 54,31","99,53 104.7,42.7 115,37 104.7,31.3 99,21 93.3,31.3 83,37 93.3,42.7","39.3,50.3 48,45.5 39.3,40.7 34.5,32 29.7,40.7 21,45.5 29.7,50.3 34.5,59"],["M34,82.4c0,8.1,2.6,15.6,6.9,21.6c3.8-3.9,6.6-11.5,6.9-21.1H50c0,10-2.8,"+"18.8-7,23.8c6.6,7.6,16.2,12.3,27,12.3 c19.9,0,36-16.3,36-36.6c0-24.6-28-"+"32.8-36-61.4C62,49.7,34,57.8,34,82.4z M42,83c-1.5,0-2.7-3.1-2.7-7s1.2-7,"+"2.7-7s2.7,3.1,2.7,7 S43.4,83,42,83z ","112,43 108,47 105,50 109,54 112,57 116,53 119,50 115,46","44,47 48.6,38.6 57,34 48.6,29.4 44,21 39.4,29.4 31,34 39.4,38.6","43,54 35.9,50.1 32,43 28.1,50.1 21,54 28.1,57.9 32,65 35.9,57.9","95,49 99.9,39.9 109,35 99.9,30.1 95,21 90.1,30.1 81,35 90,40"],["M34,82.4c0,20.2,16.1,36.6,36,36.6s36-16.3,36-36.6c0-24.6-28-32.7-36-"+"61.4C62,49.7,34,57.8,34,82.4z M50,69 c2,0,3.7,3.1,3.7,7S52,83,50,"+"83s-3.7-3.1-3.7-7S48,69,50,69z M80,83c0,15.4-9.2,28-20.5,28S39,98.4,39,"+"83h2.9 c0.7,14,8.2,23.7,17.6,24c9.2-0.3,16.8-10,17.6-24H80z M72.7,76c0,"+"3.9-1.8,7-3.7,7c-2.1,0-3.7-3.1-3.7-7s1.7-7,3.7-7 S72.7,72.1,72.7,76z ","101,30 96,25 92,21 87,26 83,30 88,35 92,39 97,34","29.5,50 25.2,54.3 21,58.5 25.2,62.7 29.5,67 33.7,62.8 38,58.5 33.7,54.2","111.2,40.8 107,33 102.8,40.8 95,45 102.7,49.3 107,57 111.2,49.2 119,45","40,51 45.3,41.3 55,36 45.3,30.7 40,21 34.7,30.7 25,36 34.6,41.4"]];function Logo(opt,conf){this.opt=opt;this.conf=conf;this.index=0;var svg_frame=logo_svg[this.index];this.opacity=conf.opacity||opt.logo_loader_opacity;var svg='<svg viewBox="0 0 140 140"><g>'+'<path class="logo_path" d="'+svg_frame[0]+'"/>'+'<polygon class="logo_path" points="'+svg_frame[1]+'"/>'+'<polygon class="logo_path" points="'+svg_frame[2]+'"/>'+'<polygon class="logo_path" points="'+svg_frame[3]+'"/>'+'<polygon class="logo_path" points="'+svg_frame[4]+'"/>'+"</g></svg>";var $logo=this.logo=$("<div>"+svg+"</div>");$logo.addClass(conf.css_class||"hola_preview_loader_logo");$logo.css({position:"absolute",opacity:conf.hide?0:this.opacity});if(conf.pos)this.update_position(conf.pos);this.path_el=$logo.find(".logo_path");this.start_hiding=false;if(conf.watermark)conf.watermark.pause();if(conf.animate){$logo.addClass("hola_preview_loader_init");this.animate()}}Logo.prototype.update_position=function(pos){var size=Math.min(max_logo_size,Math.max(20,pos.width*.1))*(pos.scale||1);var margin=this.opt.icon_loader_margin===undefined?size/4:this.opt.icon_loader_margin;var pos_size=get_icon_pos_size({pos:pos,shadow:true,margin:margin,get_margin:this.conf.get_margin,size_px:size,location:pos.location||this.conf.location||"top-right"});this.logo.css({width:size+"px",height:size+"px",top:pos.top+pos_size.top+"px",left:pos.left+pos_size.left+"px"});if(pos.opacity)this.logo.css({opacity:this.opacity=pos.opacity})};Logo.prototype.animate=function(){if(this.animating)return;this.animating=true;this._animate()};Logo.prototype._animate=function(ts){if(!this.animating)return;var _this=this;function next(){_this.rm_anim=requestAnimationFrame(_this._animate.bind(_this))}if(!this.start){this.rm_t=setTimeout(function(){_this.logo.removeClass("hola_preview_loader_init");_this.start=ts;next()});return}if(ts-this.start<60)return next();this.start=ts;this.index++;this.redraw();if(!this.start_hiding||this.index>0)return next();if(this.hiding)return;this.hiding=true;this.rm_t=setTimeout(function(){_this.logo.addClass("hola_preview_loader_hide");_this.rm_t=clearTimeout(_this.rm_t);next();if(_this.conf.watermark)_this.conf.watermark.resume(_this.conf.logo_loader_hide_duration)},1e3)};Logo.prototype.pause=function(){this.rm_anim=cancelAnimationFrame(this.rm_anim);this.animating=false;this.index=0;this.redraw()};Logo.prototype.redraw=function(){if(this.index>=logo_svg.length){this.index=0;if(this.conf.animate_once)return this.pause()}var svg_frame=logo_svg[this.index];svg_frame.forEach(function(data,i){if(!this.path_el||!this.path_el[i])return;var attr=i==0?"d":"points";this.path_el[i].setAttribute(attr,data)}.bind(this))};Logo.prototype.show=function(){this.start_hiding=false;this.logo.css({opacity:this.opacity,display:""})};Logo.prototype.hide=function(quick){if(quick)return void this.logo.css({display:"none"});this.start_hiding=true};Logo.prototype.remove=function(){this.rm_anim=cancelAnimationFrame(this.rm_anim);this.rm_t=clearTimeout(this.rm_t);this.logo.remove()};function Icon(opt){this.opt=opt;this.tr=opt.tr||function(){};this.container=opt.container;this.update();this._countdown=this.opt.countdown_on_hover*date.ms.SEC}Icon.prototype.is_allowed=function(){if(this.opt.is_allowed)return this.opt.is_allowed()};Icon.prototype.update=function(){if(this.is_allowed())this.show();else this.hide()};Icon.prototype.show=function(){if(this.elem||this.off_img_load)return;var img,_this=this,opt=this.opt;if((img=$(opt.img)[0])&&!opt.icon_countdown&&img.tagName=="IMG"&&!is_img_loaded(img)){this.off_img_load=on_img_load(img,function(){_this.off_img_load=null;_this.show()});return}if(opt.on_show)opt.on_show();var icon='<g><path d="M 0,0 0,20 14,10 Z"/></g>';var stroke_width=3;var r=40/2-stroke_width/2;var cir=this.cir=Math.ceil(2*Math.PI*r);var circle="",class_name=util.is_ie?"":'class="icon-bg" ';var bg_circle="<g><circle "+class_name+'cx="5" cy="10" fill="#333" '+'fill-opacity="0.7" r="'+r+'" stroke-width="0"></circle></g>';class_name=opt.class||"hola_preview_icon";if(opt.icon_countdown){class_name+=" "+(opt.cd_class||"hola_preview_icon_countdown")+" hola_top_element";circle='<g><circle class="icon-progress" cx="-10" cy="5" '+'fill-opacity="0" r="'+r+'" stroke="#FFFFFF" stroke-dasharray="'+cir+'" stroke-dashoffset="0" stroke-width="'+stroke_width+'" transform="rotate(-90)"></circle></g>'}var svg='<svg viewBox="-20 -15 50 50">'+svg_shadow.replace("%id%","")+bg_circle+icon+circle+"</svg>";var elem=this.elem=$('<div class="'+class_name+'">'+svg+"</div>").css({"z-index":opt.z_index});this.update_pos();if(opt.on_countdown_cancel){class_name=opt.cl_class||"hola_preview_icon_cancel";var cancel=$('<span class="'+class_name+'">'+this.tr("countdown_cancel")+"</span>");var on_cancel=function(e){e.stopImmediatePropagation();e.preventDefault();_this.cancel()};cancel.on("click",on_cancel);cancel.on("touchstart",on_cancel);var cancel_event=function(e){e.stopImmediatePropagation();e.preventDefault()};cancel.on("mouseup",cancel_event);cancel.on("mousedown",cancel_event);cancel.on("pointerup",cancel_event);elem.append(cancel)}var info,c=this.container;if(c&&(info=$(c.info)[0]))$(info).before(elem);else{if(opt.icon_countdown&&c)$(c).append(elem);else if(img)$(img).after(elem);else $(c).append(elem)}if(opt.icon_countdown){this.update_countdown_fn=this.update_countdown.bind(this);this.rm_anim=requestAnimationFrame(this.update_countdown_fn)}};Icon.prototype.update_pos=function(opt){opt=opt?Object.assign(this.opt,opt):this.opt;var pos=opt.img_pos;if(typeof pos=="function")pos=pos();var pos_size=get_icon_pos_size({shadow:opt.shadow,location:opt.icon_location,size:opt.icon_size,pos:pos,margin:opt.icon_margin,size_px:opt.size_px});var top=(opt.icon_countdown?0:pos.top)+pos_size.top;var left=(opt.icon_countdown?0:pos.left)+pos_size.left;var size=pos_size.size;this.elem.css({position:"absolute",width:size+"px",height:size+"px",top:top+"px",left:left+"px"});clearTimeout(this.update_pos_to);this.update_pos_to=setTimeout(this.update_pos.bind(this),200)};Icon.prototype.cancel=function(){if(this.opt.on_countdown_cancel)this.opt.on_countdown_cancel();this.hide()};Icon.prototype.hide=function(){if(!this.elem)return;if(this.opt.on_hide)this.opt.on_hide();if(this.rm_anim)this.rm_anim=cancelAnimationFrame(this.rm_anim);if(this.off_img_load)this.off_img_load();if(this.update_to)this.update_to=clearTimeout(this.update_to);if(this.update_pos_to)this.update_pos_to=clearTimeout(this.update_pos_to);this.off_img_load=null;this.elem.remove();this.elem=null};Icon.prototype.get_el_params=function(el){var size,frect,rect=$(el)[0].getBoundingClientRect();if(this.fr_pos){frect={top:rect.top+this.fr_pos.top,left:rect.left+this.fr_pos.left};frect.right=frect.left+rect.width;frect.bottom=frect.top+rect.height;size=this.fr_pos.win}else size={width:window.innerWidth,height:window.innerHeight};rect=frect||rect;var opt=this.opt;if(opt.is_top||this.fr_et||!opt.msg)return{rect:rect,size:size};var _this=this;this.fr_et=etask([function(){return opt.msg.get_frame_pos()},function(pos){_this.fr_pos=pos},function finally$(){_this.fr_et=undefined}]);return{rect:rect,size:size}};Icon.prototype.is_on_screen=function(el){var margin=5;function is_in(side,len){return rect[side]>=-margin&&rect[side]<=len+margin}var p=this.get_el_params(el),rect=p.rect;var h=p.size.height,w=p.size.width;var top_in=is_in("top",h),bottom_in=is_in("bottom",h);var left_in=is_in("left",w),right_in=is_in("right",w);var y_in=top_in&&bottom_in||rect.top<=0&&rect.bottom>=h;var x_in=left_in&&right_in||rect.left<=0&&rect.right>=w;return y_in&&x_in&&(!this.opt.check_z_index||dom_util.in_front(this.container))};Icon.prototype.update_countdown=function(ts){if(!this.opt.disable_visibility_check&&!this.is_on_screen(this.opt.visibility_check_icon?this.elem[0]:this.container)){this.update_to=setTimeout(this.update_countdown_fn,200);this._countdown_ts=undefined;return}if(!this._countdown_ts)this._countdown_ts=ts;var elapsed=Math.min(1,(ts-this._countdown_ts)/this._countdown);this._update_countdown(elapsed);if(elapsed==1){if(this.opt.on_navigate)this.opt.on_navigate();return}this.rm_anim=requestAnimationFrame(this.update_countdown_fn)};Icon.prototype._update_countdown=function(val){if(!this.elem)return;var $circle=$(this.elem).find(".icon-progress");if(!$circle||!$circle.length)return;$circle.css("stroke-dashoffset",-val*this.cir)};E.Icon=Icon;E.Logo=Logo;E.init=function(){if(!E.styles){E.styles=util.get_stylesheet(def_styles);$("head").append("<style>"+E.styles+"</style>")}};return E});
define("/svc/preview/pub/image_preview_lib.js",["/svc/cdn/pub/config.js","cash","/util/es6_shim.js","/util/events.js","/util/util.js","/util/etask.js","/util/ajax_lite.js","/svc/cdn/pub/watermark.js","/util/user_agent.js","/util/url.js","/util/escape.js","/util/date.js","/svc/cdn/pub/play_icon.js","/svc/cdn/pub/util.js"],function(config,$,shim,events,zutil,etask,ajax,watermark,user_agent,zurl,zescape,date,play_icon,util){var E={inited:false},assign=Object.assign;var loc=window.location.host,storage_host="ve.h-cdn.com";var pages_to_images={},links=[],uniq_id=0,previews={};E.BEFOREUNLOAD=typeof navigator!="undefined"&&navigator.userAgent.match(/iPad|iPhone|iPod/)?"pagehide":"beforeunload";function browser_name(){var browser=user_agent.guess_browser();return browser.opera?"opera":browser.ucbrowser?"ucbrowser":browser.browser}function build_info(){var b={platform:typeof navigator!="undefined"&&navigator.platform,user_agent:typeof navigator!="undefined"&&navigator.userAgent};b.ver=E.ver;b.browser=user_agent.browser_to_string(user_agent.guess_browser());b.browser_build=typeof window!="undefined"&&window.conf&&window.conf.browser&&window.conf.browser.name;b.guess=JSON.stringify(user_agent.guess());return b}function build(){var info=build_info(),s="";for(var f in info)s+=(s&&"\n")+f+": "+info[f];return s}E.perr=function(opt){opt=typeof opt=="string"?{id:opt}:opt||{};var top_url=window.top==window?location.href:document.referrer;var p={id:opt.id,customer:E.customer,zone:"gen",info:Object.assign({},opt.info),build:build(),browser:browser_name(),bt:opt.bt,filehead:opt.filehead};p.info.customer=E.customer;p.info.url=top_url;p.info.location_url=location.href;p.info.site=zurl.get_host(top_url);p.info.referer=document.referer;p.info.referrer=document.referrer;p.info.tag=E.tag;p.info.mvp_marker="image_preview_mvp";p.info.hola_mode="unknown";E.perr.send(p)};E.perr.send=function(p){p.info.perr_method="http";var _qs={id:"cdn_ve_image_preview_"+p.id,browser:p.browser,customer:p.customer,ver:E.ver,zone:p.zone,tag_id:E.tag.id,tag_date:+E.tag.date};var data={is_json:1,build:p.build,info:JSON.stringify(p.info),bt:p.bt&&""+p.bt,filehead:p.filehead};var u="//perr.h-cdn.com/be_client_cgi/perr?"+zescape.qs(_qs);ajax.raw({url:u,data:data,method:"POST"})};E.default_conf={links_selector:"a",imgs_selector:"img",container:{max_width:500,max_height:500},animation:{slide_duration:1500,swap_duration:500,start_duration:0},countdown_on_hover:5,navigate_on_hover_sec:2,play_icon_size:.25,count:5,get_href:null,strings:{countdown_cancel:"Cancel"}};var cached_images={};function cached_image(src){return cached_images[src]||(cached_images[src]=new CachedImage(src))}zutil.inherits(CachedImage,events.EventEmitter);function CachedImage(src){this.image=new Image;this.image.onload=this._onload.bind(this);this.image.src=src}CachedImage.prototype._onload=function(){this.width=this.image.width;this.height=this.image.height;this.ready=true;this.emit("ready")};CachedImage.prototype.onready=function(cb){if(this.ready)cb();this.once("ready",cb)};zutil.inherits(Icon,events.EventEmitter);function Icon(preview){this.preview=preview;this.icon=cached_image("//ve-cdn.h-cdn.com/svc/preview/pub/img/ic_gallery.svg");this.show()}Icon.prototype.get_img=function(){var img=img_of_elem(this.preview.elem);if(!img.length){if(!E.conf.unite_img_and_link)return;console.log(this.preview.id,"has no own image");img=$(this.preview.elem).closest(E.conf.unite_img_and_link).find('a[href="'+this.preview.href+'"] img');if(!img.length)return}return img};Icon.prototype.show=function(){if(this.elem||!pages_to_images[this.preview.href]||!E.conf.icon_location||this.preview.has_video_preview()||!this.img&&!(this.img=this.get_img())){return}var img=this.img;if(img.width<2||img.naturalWidth<2){var _this=this;$(img).on("load",function on_load(){$(img).off("load",on_load);_this.show()});return}var size=$(img).height()*(E.conf.icon_size||25)/100;var elem=document.createElement("div");$(elem).addClass("hola_image_preview_icon");$(elem).attr("hola-image-preview-id",this.preview.id);$(elem).css({position:"absolute",width:size+"px",height:size+"px","background-image":'url("'+this.icon.image.src+'")',"background-position":"center","background-repeat":"no-repeat"});var img_pos=$(img).jqPosition();var pos={top:img_pos.top,left:img_pos.left,width:$(img).width(),height:$(img).height()};var top,left,iloc=E.conf.icon_location.split("-");var margin=E.conf.icon_margin||10;if(iloc[0]=="center"){left=(pos.width-size)/2;top=(pos.height-size)/2}else{top=iloc[0]=="top"?margin:pos.height-size-margin;left=iloc[1]=="left"?margin:pos.width-size-margin}$(elem).css({width:size+"px",height:size+"px",top:pos.top+top+"px",left:pos.left+left+"px"});$(img).after(elem);this.elem=elem};Icon.prototype.hide=function(){if(!this.elem)return;$(this.elem).remove();this.elem=null};zutil.inherits(Preview,events.EventEmitter);function Preview(elem){this.id=++uniq_id;$(elem).prop("hola-image-preview-id",this.id);this.elem=elem;this.href=get_href(elem);this.on_show=this.emit.bind(this,"show");this.on_hide=this.emit.bind(this,"hide");this.on("show",this.show.bind(this));this.on("hide",this.hide.bind(this));this.on("loaded",this.update.bind(this));this.is_playing=false;this.previews_requested=false;this.hide_requested=false;this.animation=new Animation(this);this.bind_events()}Preview.prototype.get_id=function(){return this.id};Preview.prototype.bind_events=function(){var container=$(this.elem).closest(E.conf.unite_img_and_link).get(0);if(container&&($(container).width()>E.conf.container.max_width||$(container).height()>E.conf.container.max_height)){return}this.icon=new Icon(this);$(container||this.elem).on("mouseenter",this.on_show);$(container||this.elem).on("mouseleave",this.on_hide)};Preview.prototype.show=function(){if(this.hide_requested)this.hide_requested=clearTimeout(this.hide_requested);if(this.is_playing||this.has_video_preview())return;this.is_playing=this.href in pages_to_images;if(this.is_playing)return void this._show();if(!this.previews_requested){this.previews_requested=true;get_previews([this.href],this.emit.bind(this,"loaded"))}};Preview.prototype.hide=function(){if(this.hide_requested)return;var _this=this;this.hide_requested=setTimeout(function(){if(_this.watermark_container)$(_this.watermark_container).remove();_this.animation.stop();$(_this.elem).removeClass("hola_preview_playing");_this.is_playing=false;_this.hide_requested=null;_this.countdown_cancel();if(_this.countdown){_this.countdown.hide();_this.countdown=null}_this.icon.show()},300)};Preview.prototype.update=function(){if(this.is_playing||!this.icon)return;if(this.has_video_preview())return void this.icon.hide();if(pages_to_images[this.href])this.icon.show()};function img_of_elem(elem){if(typeof E.conf.imgs_selector=="function")return E.conf.imgs_selector($,$(elem))||[];return $(elem).find(E.conf.imgs_selector)}Preview.prototype.img_elem=function(){var img=img_of_elem(this.elem);if(!img.length){if(!E.conf.unite_img_and_link)return;img=$(this.elem).closest(E.conf.unite_img_and_link).find('a[href="'+this.href+'"] img');if(!img.length)return}if(E.conf.skip_inivisible_images){img=img.filter(function(e){var im=$(e);return im.width()>0&&im.height()>0})}if(!img.length)return;img=img.first();return img};Preview.prototype._show=function(){var src=pages_to_images[this.href];if(!src)return;var img=this.img_elem();if(!img)return;$(this.elem).addClass("hola_preview_playing");this.animation.play(img,src);this.add_watermark(img);this.emit("played");this.icon.hide();if(!E.conf.navigate_on_hover_enabled)return;if(typeof E.conf.navigate_on_hover_sec=="number"){this.rm_navigate=setTimeout(this.countdown_show.bind(this),E.conf.navigate_on_hover_sec*date.ms.SEC)}else if(typeof E.conf.countdown_on_hover=="number")this.countdown_show()};Preview.prototype.countdown_show=function(){if(!E.conf.countdown_on_hover)return this.navigate();var img=this.img_elem();if(!img)return;this.emit("countdown_show");this.rm_navigate=setTimeout(this.navigate.bind(this),E.conf.countdown_on_hover*date.ms.SEC);var pos={top:$(img).jqPosition().top,left:$(img).jqPosition().left,height:$(img).height(),width:$(img).width()};this.countdown=new play_icon.Icon({tr:function(text){return E.conf.strings[text]},is_allowed:function(){return true},shadow:true,icon_location:E.conf.play_icon_location,icon_size:E.conf.play_icon_size,icon_countdown:true,img:img,img_pos:pos,container:$(img).parent(),countdown_on_hover:E.conf.countdown_on_hover,on_countdown_cancel:this.countdown_cancel.bind(this,true)})};Preview.prototype.navigate=function(){this.emit("navigate");window.location.href=this.href};Preview.prototype.countdown_cancel=function(manual){if(manual)this.emit("countdown_cancel");if(this.rm_navigate)this.rm_navigate=clearTimeout(this.rm_navigate)};Preview.prototype.add_watermark=function(img){if(!E.watermark)return;var container=this.watermark_container=document.createElement("div");var pos_el=$(img);var water_cont=$(img).parent();if(E.conf.custom_watermark_pos_func){try{var fn=new Function("$","img",E.conf.custom_watermark_pos_func);var r=fn($,img);water_cont=r.water_cont||water_cont;pos_el=r.pos_el||pos_el}catch(e){console.log("invalid custom_watermark_pos_func function: "+(e&&e.toString())||"JS Error")}}var img_pos=pos_el.jqPosition();$(container).css({position:"absolute",width:Math.ceil(pos_el.width())+"px",height:Math.ceil(pos_el.height())+"px",top:img_pos.top+"px",left:img_pos.left+"px","z-index":pos_el.css("z-index")});water_cont.append(container);E.watermark.apply({v:{html5:{duration:1}},container:container})};Preview.prototype.has_video_preview=function(){return $(this.elem).prop("hola-video-preview-has-video")};function Animation(preview){this.preview=preview;this.stop_animation_fn=null;this.stop_fn=null;this.last_idx=0;this.duration=E.conf.animation.swap_duration}Animation.prototype.stop_animation=function(){if(!this.stop_animation_fn)return;this.stop_animation_fn();this.stop_animation_fn=null};function get_img(elem){if($(elem).is("img"))return $(elem).get(0);var m=$(elem).css("background-image").match(/\(\"(.*?)\"\)|\(\'(.*?)\'\)/);var img=new Image($(elem).width(),$(elem).height());img.src=m[1]||m[2];return img}Animation.prototype.play=function(img,src){var _this=this;this.play_animation_t=setTimeout(function(){_this.play_animation_t=null;_this.play_animation(img,src)},E.conf.animation.start_duration)};Animation.prototype.play_animation=function(img,src){this.stop_animation();var img_w=Math.ceil($(img).width()),_this=this;var img_h=Math.ceil($(img).height());src=(src.thumbs||[]).slice(0,E.conf.count);var scale=1;if(util.is_mobile&&window.screen){var scr_w=screen.availWidth||screen.width;var doc_w=document.documentElement.clientWidth||document.body.clientWidth;scale=Math.max(1,scr_w/doc_w||0)*(window.devicePixelRatio||1)}var w=Math.round(img_w*scale);var h=Math.round(img_h*scale);var c=document.createElement("canvas");$(c).attr("width",w);$(c).attr("height",h);var extra_css=typeof E.conf.extra_css=="function"?E.conf.extra_css({img:img},$):E.conf.extra_css;var img_pos=$(img).jqPosition();$(c).css(assign({position:"absolute",top:img_pos.top+"px",left:img_pos.left+"px",width:img_w+"px",height:img_h+"px","z-index":$(img).css("z-index"),"background-color":"transparent","pointer-events":"none",margin:$(img).css("margin")},extra_css||{}));var ctx=c.getContext("2d"),idx=this.last_idx,i;var stop_animation=false;this.last_img=get_img(img);ctx.drawImage(this.last_img,0,0,w,h);var first_image_shown=false;var draw=function(){if(stop_animation)return;_this.last_idx=idx;i=cached_image(src[idx]);i.onready(function(){_this.draw_image(ctx,i.image,w,h,false,function(progress){if(progress>=1){_this.last_img=i.image;if(!first_image_shown){first_image_shown=true;_this.preview.emit("image_shown")}}});setTimeout(draw,E.conf.animation.slide_duration)});idx=(idx+1)%src.length;cached_image(src[idx])};draw();$(img).after(c);this.stop_fn=function(){stop_animation=true;_this.stop_animation();if(!i||!i.ready)return void $(c).remove();if(i.image==_this.last_img)_this.last_img=get_img(img);_this.draw_image(ctx,i.image,w,h,true,function(){$(c).remove()})}};Animation.prototype.stop=function(){if(this.play_animation_t){clearTimeout(this.play_animation_t);this.play_animation_t=null}if(!this.stop_fn)return;this.stop_fn();this.stop_fn=null};Animation.prototype.draw_image=function(ctx,img,w,h,reverse,cb){if(E.conf.draw=="full")return this.draw_image_full(ctx,img,w,h,reverse,cb);return this.draw_image_fill(ctx,img,w,h,reverse,cb)};Animation.prototype.draw_image_fill=function(ctx,img,w,h,reverse,cb){var iw=img.naturalWidth,ih=img.naturalHeight,_this=this;var dsr=w*ih/h/iw;if(dsr>1)dsr=1/dsr;var sw=iw*dsr,sh=sw*h/w,sx=(iw-sw)/2,sy=(ih-sh)/2;var start=Date.now(),add=0,stop=false,dx;if(this.animation_state){add=this.animation_state.progress*this.duration;if(this.animation_state.reverse!=reverse)add=this.duration-add;this.animation_state=null}function step(){var progress=(Date.now()-start+add)/_this.duration;if(stop){if(cb)cb(progress);return}if(progress>=1)dx=0;else dx=Math.floor(w*Math.asin(1-progress)*2/Math.PI);if(reverse){dx=w-dx;ctx.clearRect(0,0,w,h);if(_this.last_img){ctx.save();ctx.globalAlpha=1-progress;ctx.drawImage(_this.last_img,0,0,w,h);ctx.restore()}}ctx.drawImage(img,sx,sy,sw,sh,dx,0,w,h);_this.animation_state={progress:progress,reverse:reverse};if(progress<1)return void requestAnimationFrame(step);_this.animation_state=null;if(cb)cb(progress)}requestAnimationFrame(step);this.stop_animation_fn=function(){stop=true}};Animation.prototype.draw_image_full=function(ctx,img,w,h,reverse,cb){var iw=img.naturalWidth,ih=img.naturalHeight,_this=this;var sx=0,sy=0,sw=iw,sh=ih;var rx,ry,rw,rh;if(w<h){rh=ih*w/iw;rw=w}else{rw=iw*h/ih;rh=h}rx=(w-rw)/2;ry=(h-rh)/2;var start=Date.now(),add=0,stop=false,dx;if(this.animation_state){add=this.animation_state.progress*this.duration;if(this.animation_state.reverse!=reverse)add=this.duration-add;this.animation_state=null}function step(){var progress=(Date.now()-start+add)/_this.duration;if(stop){if(cb)cb(progress);return}if(progress>=1)dx=0;else dx=Math.floor(w*Math.asin(1-progress)*2/Math.PI);if(reverse){dx=w-dx;ctx.clearRect(0,0,w,h);if(_this.last_img){ctx.save();ctx.globalAlpha=1-progress;ctx.drawImage(_this.last_img,0,0,w,h);ctx.restore()}}var c=E.conf.background_color||$(document.body).css("background-color");if(c&&c.startsWith("rgba(")&&c.match(/,\s*0\)$/))c=null;ctx.fillStyle=c&&c!="transparent"?c:"white";ctx.fillRect(dx,0,w,h);ctx.drawImage(img,sx,sy,sw,sh,rx+dx,ry,rw,rh);_this.animation_state={progress:progress,reverse:reverse};if(progress<1)return void requestAnimationFrame(step);_this.animation_state=null;if(cb)cb(progress)}requestAnimationFrame(step);this.stop_animation_fn=function(){stop=true}};function get_previews(pages,cb){var i=0;etask([function(){return etask.for(function(){return i<pages.length},function(){i+=3},[function(){return ajax.json({url:"//"+storage_host+"/image_previews/get_previews",method:"POST",data:{image_pages:pages.slice(i,i+3),host:loc,customer:E.customer}})},function(r){assign(pages_to_images,r)}])},function(){if(cb)cb()}])}function get_new_links(){var cur_links=[],conf_links=E.conf.links_selector;if(!E.conf.links_selector)return[];conf_links=Array.isArray(conf_links)?conf_links:[conf_links];conf_links.forEach(function(sel){if(typeof sel=="function")sel=sel($);var a=$(sel).filter(function(e){return img_of_elem(e).length>0}).get();if(!a.length)return;cur_links=cur_links.concat(a)});return cur_links.filter(function(a){if($(a).prop("hola-image-preview-id"))return false;var u=get_href(a);var scheme=(u||"").match(/^\s*(\w+):/);if(!scheme||scheme[1]=="http"||scheme[1]=="https")return true})}function get_href(a){return E.conf.get_href?E.conf.get_href(a,loc,$):a.href}function update_links(){var nl=get_new_links();var submit_update=function(){setTimeout(update_links,Date.now()-E.start_ts<15e3?1e3:3e3)};if(nl.length){var np=nl.map(get_href);get_previews(np,function(){nl.forEach(function(t){var p=new Preview(t);E.stats.add_preview(p);p.emit("loaded");previews[p.id]=p});submit_update()});Array.prototype.push.apply(links,nl)}else submit_update();for(var id in previews)previews[id].update()}function pre_cache(href){var src=pages_to_images[href];if(src&&src[0])cached_image(src[0])}function throttle(fn,wait){var last,defer_timer;return function(){var context=this,now=Date.now(),args=arguments;if(last&&now<last+wait){clearTimeout(defer_timer);defer_timer=setTimeout(function(){last=now;fn.apply(context,args)},wait)}else{last=now;fn.apply(context,args)}}}var link_img_cache={};function in_area(a,area){var uid=$(a).prop("hola-image-preview-id");if(!uid)$(a).prop("hola-image-preview-id",uid=++uniq_id);var data=link_img_cache[uid],offset;if(!data){var img=img_of_elem(a);if(!img||!img.length)return!(link_img_cache[uid]={});img=img[0];offset=$(img).offset();data=link_img_cache[uid]={img:img,top:offset.top,height:$(img).height(),left:offset.left,width:$(img).width()}}if(!data.img)return;data.height=$(data.img).height();data.width=$(data.img).width();if(!data.height||!data.width)return;offset=$(data.img).offset();data.top=offset.top;data.left=offset.left;var xwin=data.left-window.pageXOffset;if(area=="c"){var xmid=window.innerWidth/2;return xwin<=xmid&&xwin+data.width>=xmid}if(xwin<0||xwin+data.width>window.pageXOffset+window.innerWidth)return;var ywin=data.top-window.pageYOffset;if(area=="m"){var active=assign({from:.5,to:.5},E.conf.active_area);return ywin<=window.innerHeight*active.to&&ywin+data.height>=window.innerHeight*active.from}return ywin>=0&&data.top<=window.pageYOffset+window.innerHeight}function get_preview(elem){return previews[+$(elem).prop("hola-image-preview-id")]}function mobile_nav(){if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){return}var canvas=E.conf.mobile_scroll_node||window;var active_links=[];var update=function(){links.filter(in_area).forEach(function(a){pre_cache(get_href(a))});var new_links=links.filter(function(a){return in_area(a,"m")&&!!get_preview(a)});if(new_links.length>1){var center=new_links.filter(function(a){return in_area(a,"c")});if(center.length)new_links=center}new_links=new_links.slice(0,1);var old=active_links.filter(function(a){return!new_links.includes(a)}).map(get_preview);var nn=new_links.filter(function(a){return!active_links.includes(a)}).map(get_preview).filter(Boolean);old.forEach(function(p){p.emit("hide")});nn.forEach(function(p){p.emit("show")});active_links=new_links};var resize_fn=function(){link_img_cache={};$(active_links).trigger("mouseleave");update()};$(canvas).on("resize",resize_fn);$(canvas).on("orientationchange",resize_fn);$(canvas).on("scroll",throttle(update,100));if(E.conf.update_trigger)E.conf.update_trigger($,throttle(update,500));setTimeout(update,1e3)}E._init=function(){update_links();mobile_nav()};E.init=function(customer,conf,ver_info){E.start_ts=Date.now();E.customer=customer;E.conf=zutil.defaults_deep(conf||{},E.default_conf);E.tag=ver_info.tag;E.ver=ver_info.ver;E.watermark=watermark(assign({customer:customer,module:"image_preview",delay:function(duration,pos){return 0},extra_css:{".hola_watermark":{"background-image":"url(//ve-cdn.h-cdn.com/svc/preview/pub/img/"+"watermark-transparent.svg)"},".hola_watermark:hover":{"background-image":"url(//ve-cdn.h-cdn.com/svc/preview/pub/img/"+"watermark-transparent.svg)"}}},E.conf.watermark));if(conf.extra_css_fn){try{var extra_css_fn=conf.extra_css_fn;if(typeof extra_css_fn=="string")extra_css_fn=new Function("conf",extra_css_fn);var styles=util.get_stylesheet(extra_css_fn(conf));$("head").append("<style>"+styles+"</style>")}catch(e){console.error('invalid extra_css_fn function in "image_previews": '+(e&&e.toString())||"JS Error")}}play_icon.init();E.stats=new Stats;window.addEventListener(E.BEFOREUNLOAD,function(){E.stats.send_perr()});$(E._init)};function Stats(){this.prefix="image_preview_";this.init()}Stats.prototype.init=function(reset){if(!reset&&this.stats&&!zutil.is_mocha())return;this.stats={};if(reset){this.hovers=this.hovers.map(function(){return{}});this.inc("stats_reset_n")}else{this.hovers=[];this.inc("init_n")}this.total_hover_ms=0;this.total_load_ms=0;this.total_play_ms=0;this.played_hover_ms=0;this.played_load_ms=0;this.loaded_not_played_hover_ms=0};Stats.prototype.add_preview=function(preview){var id=preview.get_id();preview.on("show",this.hover.bind(this,id));preview.on("hide",this.unhover.bind(this,id));preview.on("loaded",this.loaded.bind(this,id));preview.on("played",this.played.bind(this,id));preview.on("image_shown",this.image_shown.bind(this,id));preview.on("countdown_show",this.countdown_show.bind(this,id));preview.on("countdown_cancel",this.countdown_cancel.bind(this,id));preview.on("navigate",this.navigate.bind(this,id));this.hovers[id]={}};Stats.prototype.inc=function(s,v){return this.set(s,(this.get(s)||0)+(v||1))};Stats.prototype.set=function(s,v){return this.stats[this.prefix+s]=v};Stats.prototype.get=function(s){return this.stats[this.prefix+s]};Stats.prototype.get_stats=function(){var _this=this;this.hovers.forEach(function(h,id){if(h.active)_this.unhover(id)});function set_avg(key,total,count){if(total&&count)_this.set(key,total/count)}set_avg("hover_ms",this.total_hover_ms,this.get("hover_n"));set_avg("load_ms",this.total_load_ms,this.get("loaded_n"));set_avg("play_ms",this.total_play_ms,this.get("played_n"));set_avg("played_hover_ms",this.played_hover_ms,this.get("played_n"));set_avg("played_load_ms",this.played_load_ms,this.get("loaded_n"));set_avg("loaded_not_played_hover_ms",this.loaded_not_played_hover_ms,this.get("loaded_n")-(this.get("played_n")||0));return this.stats};Stats.prototype.hover=function(id){if(this.hovers[id].active)return;this.hovers[id]={active:true,start:date.monotonic()};this.inc("hover_n")};Stats.prototype.unhover=function(id){if(!this.hovers[id].active)return;var now=date.monotonic();var time=now-this.hovers[id].start;var loaded=this.hovers[id].loaded;var played=this.hovers[id].played;if(played){this.total_play_ms+=now-this.hovers[id].play_start;this.played_load_ms+=this.hovers[id].load_ms||0}if(loaded&&!played)this.loaded_not_played_hover_ms+=time;this.hovers[id].active=false;this.total_hover_ms+=time;if(loaded)return;if(time<300)this.inc("hover_under_300ms_n");else if(time<500)this.inc("hover_under_500ms_n")};Stats.prototype.loaded=function(id){if(this.hovers[id].loaded)return;this.hovers[id].loaded=true;this.hovers[id].load_ms=date.monotonic()-this.hovers[id].start;this.total_load_ms+=this.hovers[id].load_ms;this.inc("loaded_n")};Stats.prototype.image_shown=function(id){if(!this.hovers[id].active)return;this.inc("image_shown_n")};Stats.prototype.navigate=function(id){if(!this.hovers[id].active||this.hovers[id].navigate)return;this.hovers[id].navigate=true;this.inc("auto_navigate_on_hover_n")};Stats.prototype.countdown_show=function(id){if(!this.hovers[id].active||this.hovers[id].countdown_show)return;this.hovers[id].countdown_show=true;this.inc("countdown_show_n")};Stats.prototype.countdown_cancel=function(id){if(!this.hovers[id].active||this.hovers[id].countdown_cancel)return;this.hovers[id].countdown_cancel=true;this.inc("countdown_cancel_n")};Stats.prototype.played=function(id){if(!this.hovers[id].active||this.hovers[id].played)return;this.hovers[id].played=true;this.hovers[id].play_start=date.monotonic();this.played_hover_ms+=this.hovers[id].play_start-this.hovers[id].start;this.inc("played_n")};Stats.prototype.send_perr=function(){if(!this.total_hover_ms)return;E.perr({id:"stats",info:{stats:this.get_stats()},delay:false,use_beacon:true});this.init(true)};return E});
define("json_stable_stringify",[],function(){var json=JSON;var E=function(obj,opts){if(!opts)opts={};if(typeof opts==="function")opts={cmp:opts};var space=opts.space||"";if(typeof space==="number")space=Array(space+1).join(" ");var cycles=typeof opts.cycles==="boolean"?opts.cycles:false;var replacer=opts.replacer||function(key,value){return value};var cmp=opts.cmp&&function(f){return function(node){return function(a,b){var aobj={key:a,value:node[a]};var bobj={key:b,value:node[b]};return f(aobj,bobj)}}}(opts.cmp);var seen=[];return function stringify(parent,key,node,level){var indent=space?"\n"+new Array(level+1).join(space):"";var colonSeparator=space?": ":":";if(node&&node.toJSON&&typeof node.toJSON==="function"){node=node.toJSON()}node=replacer.call(parent,key,node);if(node===undefined){return}if(typeof node!=="object"||node===null){return json.stringify(node)}if(Array.isArray(node)){var out=[];for(var i=0;i<node.length;i++){var item=stringify(node,i,node[i],level+1)||json.stringify(null);out.push(indent+space+item)}return"["+out.join(",")+indent+"]"}else{if(seen.indexOf(node)!==-1){if(cycles)return json.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}else seen.push(node);var keys=Object.keys(node).sort(cmp&&cmp(node));var out=[];for(var i=0;i<keys.length;i++){var key=keys[i];var value=stringify(node,key,node[key],level+1);if(!value)continue;var keyValue=json.stringify(key)+colonSeparator+value;out.push(indent+space+keyValue)}seen.splice(seen.indexOf(node),1);return"{"+out.join(",")+indent+"}"}}({"":obj},"",obj,0)};return E});
define("/svc/cdn/pub/zone_match.js",["json_stable_stringify"],function(json_stable_stringify){var matchers={url:function url(opt,match){return new RegExp(match.url).test(opt.url)},url_or_frame:function url_or_frame(opt,match){var re=new RegExp(match.url);return re.test(opt.url)||re.test(opt.frame_url)},frame_url:function frame_url(opt,match){return opt.frame_url&&new RegExp(match.frame_url).test(opt.frame_url)},no_mse:function no_mse(opt,match){return match.no_mse?!!opt.no_mse:false},no_h264:function no_h264(opt,match){return match.no_h264?!!opt.no_h264:false},player_n:function player_n(opt,match){return match.player_n?match.player_n==opt.player_n:true},video_check_n:function video_check_n(opt,match){return match.video_check_n?match.video_check_n==opt.video_check_n:true},video_url:function video_url(opt,match){return new RegExp(match.video_url).test(opt.video_url)},browser:function browser(opt,match){if(typeof match.browser=="string")return match.browser=="*"||opt.browser==match.browser;return match.browser.includes(opt.browser)},os:function os(opt,match){return match.os.includes(opt.os)},rand:function rand(opt,match){return opt.random<opt.rand_percent},country:function country(opt,match){var whitelisted,blacklisted;if(match.country.include&&match.country.include.length)whitelisted=match.country.include.includes(opt.country);else whitelisted=true;if(match.country.exclude&&match.country.exclude.length)blacklisted=!match.country.exclude.includes(opt.country);else blacklisted=true;return whitelisted&&blacklisted},hours:function hours(opt,match){if(!opt.date)return true;var day_msec=24*3600*1e3;var current_date=+opt.date;return!!match.hours.find(function(time){var from=time.from.split(":");var date_from=new Date(current_date);date_from.setUTCHours(from[0],from[1],0,0);date_from=+date_from;var to=time.to.split(":");var date_to=new Date(current_date);date_to.setUTCHours(to[0],to[1],0,0);date_to=+date_to;if(date_to<date_from){if(current_date<date_to)date_from-=day_msec;else date_to+=day_msec}return current_date>=date_from&&current_date<date_to})},tech:function tech(opt,match){return!opt.player||!opt.player.tech||opt.player.tech==match.tech}};function parse_rules(rules){var result={browser:[],os:[]};if(!rules||!rules.length)return result;function set_value(rule_value,list){if(!result[list])return;if(rule_value=="*"){result[list]=false;return}if(rule_value&&result[list].indexOf(rule_value)==-1)result[list].push(rule_value)}rules.forEach(function(rule){set_value(rule.browser,"browser");set_value(rule.os,"os")});if(!result.browser)result.browser=[];if(!result.os)result.os=[];return result}function make_match_fn(match,opt){opt=opt||{};var full_match=opt.full_match;var use_or=opt.use_or;var criterias=[];if(match.zone!="gen"&&match.rules){var parsed_rules=parse_rules(match.rules);match.browser=parsed_rules.browser;match.os=parsed_rules.os}for(var name in matchers){var match_opt=match[name];if(name=="rand"&&match_opt==0)return"return false;";if(typeof matchers[name]!="function"||!match_opt)continue;if(Array.isArray(match_opt)){if(!match_opt.length)continue;if(["url","frame_url","video_url"].includes(name)){match_opt=match_opt.filter(String);if(!match_opt.length)continue;if(match_opt.length==1)match_opt=match[name]=match_opt[0];else match_opt=match[name]="("+match_opt.join(")|(")+")"}}if(name=="country"&&(!match_opt.exclude||!match_opt.exclude.length)&&(!match_opt.include||!match_opt.include.length)){continue}criterias.push(name)}if(!criterias.length)return"return false;";var match_var=full_match?match:criterias.reduce(function(r,c){return r[c]=match[c],r},{});if(match_var.country){if(!match_var.country.include)match_var.country.include=[];if(!match_var.country.exclude)match_var.country.exclude=[]}var url_idx;if(match.allow_frame_match&&(url_idx=criterias.indexOf("url"))!=-1)criterias[url_idx]="url_or_frame";var fn_body="";var mse_h264=criterias.indexOf("no_mse")>-1&&criterias.indexOf("no_h264")>-1;if(mse_h264)fn_body+="(no_mse(opt, match) || no_h264(opt, match)) && ";fn_body+=criterias.map(function(c){if(mse_h264&&(c=="no_mse"||c=="no_h264"))return"true";return c+"(opt, match)"}).join(use_or?" || ":" && ");return"var match = "+json_stable_stringify(match_var)+";\n"+criterias.map(function(c){return(""+matchers[c]).replace(/\n?\n?/,"")}).join("\n")+"\nreturn "+fn_body+";"}return{make_fn:make_match_fn}});
require(["/util/es6_shim.js","/util/conv.js","/util/url.js","/util/util.js","/svc/preview/pub/image_preview_lib.js","/svc/cdn/pub/zone_match.js","/svc/cdn/pub/util.js"],function(shim,conv,url,zutil,image_preview_lib,zone_match,util){var zdot_json=conv.JSON_parse(require.zdot("json"))||{};var tag=zdot_json.test&&zdot_json.test.tag||{};var ver=require.zdot("version");var log_level=zutil.get(zdot_json,"loader.log.log_level");var is_debug=log_level!="crit"&&log_level!="no";var log=is_debug?console.log.bind(console):function(){};function get_conf(){var conf=zutil.get(zdot_json,"spark.image_previews");if(!conf)return{};if(!conf.conf)conf=[conf];else conf=conf.conf;conf=conf.find(function(c){c=c||{};if(!c.match)return c;var match=c.match;var url_frame=util.get_location_urls();var match_opt={url:url_frame.top_url,browser:util.browser_rule_s,os:util.guess.os,frame_url:url_frame.frame_url};if(!match.js)match.js=zone_match.make_fn(match);var matched=false;try{var match_fn=new Function("opt",match.js);matched=match_fn(match_opt)}catch(e){log(e)}if(matched)return c});return util.get_platform_conf(conf)}var cust=zdot_json.customer;var conf=get_conf()||{};if(!Object.keys(conf).length)return log("image preview: no conf, skip loading");image_preview_lib.init(cust,conf,{tag:tag,ver:ver})});define("/svc/preview/pub/image_preview.js",function(){});

}());
//# sourceMappingURL=/image_preview.js?customer=tom&md5=314409-72933403&map=true